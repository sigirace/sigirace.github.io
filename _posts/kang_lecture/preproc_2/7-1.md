## Warm up

- 지금부터는 데이터 전처리 및 분석 과정을 실습하도록 하겠습니다.
- 두가지 주제가 있는데요
- 모두 제가 실제 현업에서 수행했던 두가지 프로젝트를 토이프로젝트로 재구성한 내용입니다.
- 그룹내 DT 과제를 수행하던 당시 가장 많이 했던 일이 계열사를 찾아가서 인터뷰를 수행하고
- 그 과정에서 도출된 비즈니스 니즈를 데이터 기반 과제로 수행하는 일이었습니다.
- 그래서 각 실습마다 약간의 현장감을 살리기 위해서 인터뷰도 구성했는데요.
- 그냥 재밌게 한번 봐주셨으면 좋겠습니다.

- 처음 실습 주제는 호텔 객실 취소 예측입니다.
  - 읽기

- 인터뷰를 통해 도출한 프로젝트 개요는 아래와 같습니다.

- 취소 건수 예측을 통해 정확한 오버부킹 객실 수를 산정하여 공실 수를 줄일 수 있도록 하는 것이 목표구요

- 이를 통해 호텔 계열사의 매출을 증대시킨다.. 는 약간은 진부한 내용입니다.

- 아무튼!
- 실습을 시작해보도록 하겠습니다.
- 모두 제가 전달한 url 링크를 열어주시구요.

- 실습을 진행함에 있어 코드를 길게 작성하는 일은 없을 것입니다.
- 다만, 결과를 해석하는 부분에 시간을 드릴 예정이며,
- 데이터를 어떤 방식으로 처리해야할지 데이터 분석에 대한 흐름에 대해 감을 잡아보시길 바랍니다.

🗣️ 강의 : [2:30]

## 전처리 미션

### 1. 데이터 확인

- 먼저 계열사로부터 이러한 데이터를 받았다고 가정하겠습니다.
- 실제로는 디스크립션이 달려있을 확률이 적지만 토이프로젝트이기에 이렇게 친절하게 달려있다고 생각해주세요.
  - 변수 읽기

### 2. EDA

- 다음으로는 해당 데이터를 통해 EDA를 수행해 보도록 하겠습니다.
- 코드
  - 데이터를 불러오는 과정을 수행하고 간단히 상위 5개의 행만을 먼저 살펴보도록 할게요
- 데이터
  - 벌써부터 이상치들이 보이고, 범주형 변수들이 확인되는 것 같습니다.

- 이제 데이터의 개요를 확인해 볼것인데요
- 앞서 배운 info와 describe를 데이터 프레임에 적용하고 분석에 어떤 정보가 필요한지를 작성해 보시길 바랍니다.
- 시간은 5분 정도면 적당할 것 같습니다.

🗣️ 강의: [3:00 / 5:30]

🐥 실습: [10:00 / 15:30]

- 다들 잘 수행 하셨나요?
- 코드는 어렵지 않으나 해석 부분에 시간을 많이 쓰셨을 것 같습니다.
- 제가 수행한 내역들과 비교하여서 어떤 부분에 차이점이 있는지 확인해보시면 좋을것 같아요

````
🔬 **데이터 요약 결과 해석**

📌 **종속변수**

1. **is_canceled**
   - (값) 0-예약이 취소되지 않음/ 1-예약이 취소 됨
   - (평균값) 0.12
   - ☞ **전체 예약 중 약 12%가 취소됨을 의미하고 이는 target 데이터의 불균형을 뜻함**

📌 **독립변수**

2. **lead_time**

   - (결측치) 5개
   - (평균) 85.98일/ (최소값)0일/ (최대값) 629일
   - ☞ **의미상 2년전 예약하는 경우는 없을 것 같기에 이상치 판단 필요**

3. **stays_in_weekend_nights**

   - (평균) 0.89일/ (최대값) 13일

4. **stays_in_week_nights**

   - (평균) 2.38일/ (최대값) 30일

5. **is_repeated_guest**

   - (값) 0-첫 고객/ 1-기존 고객
   - (결측치) 358개
   - (평균) 3.8
   - ☞ **예약 고객 중 약 3.8%가 기존 고객임을 의미하고 이는 feature 데이터의 불균형을 뜻함**

6. **previous_cancellations**

   - (평균) 0.03회/ (최대값) 26회
   - ☞ **취소를 26번한 것은 의미적으로도 어색하고 평균과 차이가 많이 나기 때문에 이상치인지 판단 필요**

7. **previous_bookings_not_canceled**

   - (평균) 0.17회/ (최대값) 66회

8. **booking_changes**

   - (평균) 0.27회/ (최대값) 17회

9. **days_in_waiting_list**

- (평균) 1.98일/ (최대값) 379일
- ☞ **평균과 차이가 많이 나기 때문에 이상치인지 판단 필요**

10. **adr (Average Daily Rate)**

- (결측치) 1063개
- (평균) 101.41/ (최소값) -6.38/ (최대값) 451.50
- ☞ **요금이 음수일 수 없으니 이상치 확실함**

11. **deposit_type**

- ☞ **범주형 데이터이기에 고유값 확인 필요**

✅ **분석 목표**

- 예측 목적인 is_cancled가 범주형이기에 분류(classificiation) 분석을 수행함
````

🔑 해석: [7:30 / 23:00]



**2.1.3 시각화**

**1. 수치형**

🗣️ 강의: [2:30/ 25:30]

- 시간은 5분 드리도록 하겠습니다.

🐥 실습: [5:00 / 30:30]

- 네, 그럼 저도 수행해 보도록 하겠습니다.

````python
# 수치형
continuous_columns = [
    "lead_time",
    "stays_in_weekend_nights",
    "stays_in_week_nights",
    "previous_cancellations",
    "previous_bookings_not_canceled",
    "booking_changes",
    "days_in_waiting_list",
    "adr",
]
````

- 데이터가 총 8개이기에 2행 4열로 각각의 히스토그램을 표현해 보았습니다.

- [그림2]
- 특징으로는 대부분의 데이터의 범위가 굉장히 넓다라는 점이 보이는데요
- 이상치 개념으로 설명하기

- [코드3]
- 따라서 히스토그램 보다 이상치를 더 정확히 판단할 수 있는 상자그림도 그려보겠습니다.
- 동일하게 2행 4열로 그려볼 것이구요
- 결과를 보니 가관이네요
- 데이터가 대부분 다 이상치 영역에 속하는 것으로 나타납니다.
- 그래서 저는 해석을 이렇게 작성해 보도록 하겠습니다.

````
- 상자 그림으로 표현시 모든 변수에서 이상치를 포함하고 있음
- 데이터 상으로는 이상치로 보이나 연속적으로 나타나있기 때문에 업무적으로는 이상치가 아닐 수 있음
- 각 변수에서 너무 동떨어진 몇개의 포인트만을 제거하는 보수적인 이상치 제거 방식 적용
````

🔑 해석: [3:00/ 33:30]

**2. 범주형**

🗣️ 강의: [1:00/ 34:30]

- 시간은 3분 드리도록 하겠습니다.

🐥 실습: [3:00 / 37:30]

- 네 그럼 저도 수행해 보도록 하겠습니다.

````python
categorical_columns = ["is_canceled", "deposit_type", "is_repeated_guest"]
````

```
💥 **MISSION**

> **범주형 변수 시각화 결과 해석**

- 모든 범주형 변수가 불균형이기에 샘플링 필요함
- deposit_type은 범주형 변수처리 필요
```

🔑 해석: [1:30 / 39:00]

**3. 그룹별 평균 시각화**

- 우리가 지금 수행하고 있는 분류 문제와 같은 경우
- 예측을 수행할 종속변수의 그룹별 평균 등으로 데이터를 시각화하여 파악하는 것이
- 독립변수가 종속변수에 미치는 영향을 파악하는데 큰 도움이 될 수 있습니다.
- 단, 이때 평균이라고 하면 수치형 변수들이 대상이 되겠죠
- 따라서 수치형 변수들과 is_cancled를 갖는 데이터프레임을 만들어 주시고 is_cancled 를 기준으로 그룹화를 진행해 주세요
- 그런다음 역시 시각화를 진행한 뒤, 결과를 해석해 주시면 되겠습니다.
- 시간은 5분 드리도록 하겠습니다.

🗣️ 강의: [1:00/ 40:00]

```
# is_cancled를 포함한 수치형 컬럼만 가지는 새로운 타겟 DF
target_hotel = hotel[continuous_columns + ["is_canceled"]]

# 그룹별 평균 DF
is_canceled = target_hotel.groupby(by="is_canceled").mean()

# 그룹별 평균 DF 확인
is_canceled
```

🐥 실습: [5:00 / 45:00]

- 그래프를 확인해보면 가장 극단적으로 차이나는 부분이 이전에 취소를 했냐 안했냐에 따라
  - previous_cancellations, previous_bookings_not_canceled
- 최종적으로 취소에 미치는 영향이 가장 많이 나타나는 것으로 보입니다.
- 그런데 이 둘은 트레이드 오프관계처럼도 보이기에 굳이 둘 다 모델에 넣을 필요는 또 없어 보이네요
- 더해서 adr과 같이 결과에 큰 차이가 없는 변수도 존재하는데요
- 저는 사실 이 부분이 조금 의외였던 게, 요금이 저렴할수록 취소를 많이 했을 것 같다라는 생각이 있었거든요
- 아무튼 요금이 노쇼를 구분하는데 큰 영향을 주지 않는 것 같습니다.
- 따라서 모델 성능이 원하는만큼 나오지 않는다면 이러한 변수를 제거해 보는 것도 방법이 될 수 있을 것 같습니다.
- 모델이 이런 영향 없는 변수들을 고려하지 않게끔 말이죠.
- 그래서 저는 해석을 다음과 같이 적어보았습니다.

```
💥 **MISSION**

> **그룹별 평균 시각화 결과 해석**

- 예약 취소하지 않음/ 예약 취소 간의 그룹별 평균이 차이가 클 수록 분류에 영향을 많이 미칠 것으로 보임
- 모델의 성능이 좋지 못하면 그룹간 평균 차이가 없는 데이터를 피쳐에서 삭제해보는 방법 고려
```

🔑 해석 : [3:30 / 48:30]

[마무리]

