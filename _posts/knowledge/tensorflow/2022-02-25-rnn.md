---
layout: single
title:  'RNN'
toc: true
categories: [TensorFlow]
tags: [RNN Layer]
---

ë³¸ ê²Œì‹œë¬¼ì€ tensorflowì˜ [í¬ìŠ¤íŠ¸](https://www.tensorflow.org/api_docs/python/tf/keras/layers/RNN)ë¥¼ ë³´ê³  ì •ë¦¬í•˜ëŠ” ê¸€ì´ë‹¤.
{: .notice}

```python
tf.keras.layers.RNN(
    cell,
    return_sequences=False,
    return_state=False,
    go_backwards=False,
    stateful=False,
    unroll=False,
    time_major=False,
    **kwargs
)
```

### ğŸ“Œ Args

- cell: RNN, LSTM ë“±ì˜ instance í˜¹ì€ instance listì´ë©° ì´ë“¤ì€ ì•„ë˜ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•œë‹¤.
  - `call`: (input_at_t1, states_at_t1)ë¥¼ ì¸ìë¡œ ë°›ëŠ” methodë¡œ (output_t1, states_t2)ì„ return í•œë‹¤. 
  - `state_size`: hidden sizeì˜ í¬ê¸°ì´ë‹¤.
  - `output_size`: outputì˜ í¬ê¸°ì´ë‹¤.
  - `get_initial_state(inputs=None, batch_size=None, dtype=None)`: ë§Œì•½ ì‚¬ìš©ìê°€ initail stateë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ì„ ë•Œ, call methodì— ì´ˆê¸°í™”ëœ tensorë¥¼ ê³µê¸‰í•˜ëŠ” methodì´ë‹¤. ì´ˆê¸°í™”ëœ tensorì˜ shapeëŠ” [batch_size, cell.state_size]ì—¬ì•¼ í•œë‹¤.
- return_sequences: Trueì¼ ê²½ìš° output sequence ì „ì²´ë¥¼ ë°˜í™˜í•˜ë©°, Falseì¼ ê²½ìš° ë§ˆì§€ë§‰ time stepì˜ outputë§Œì„ ë°˜í™˜í•œë‹¤.(default False)
- return_state: output ì™¸ì— ë§ˆì§€ë§‰ hidden sateë¥¼ ë°˜í™˜ í•  ì§€ì— ëŒ€í•œ ì—¬ë¶€ì´ë‹¤.(default False)
- go_backwards: Trueì´ë©´ input sequenceë¥¼ ê±°ê¾¸ë¡œ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. Bidirectional layerë¥¼ custom í•  ë•Œ(=ì •ë°©í–¥, ì—­ë°©í–¥ì„ ë”°ë¡œ ì§€ì •í• ë•Œ), ì‚¬ìš©í•œë‹¤.(default False)
- stateful: Trueì¼ ê²½ìš°, batchì˜ ë§ˆì§€ë§‰ hidden stateê°€ ë‹¤ìŒ batchì˜ ì´ˆê¸°ê°’ìœ¼ë¡œ ì ìš©ëœë‹¤.(default False)
- unroll: ë©”ëª¨ë¦¬ë¥¼ ë” ë§ì´ ì‚¬ìš©í•˜ë‚˜ RNNì˜ ì†ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆë‹¤. ì§§ì€ sequenceì— ì‚¬ìš©ëœë‹¤.(default False)
- time_major: Trueì¸ ê²½ìš° input ë° outputì˜ ëª¨ì–‘ì´ (timesteps, batch, ...), Falseì¸ ê²½ìš° (batch, timesteps, ...)
- zero_output_for_mask: ë°˜í™˜ëœ output sequence ì¤‘ maskingëœ timestep outputì— 0ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì—¬ë¶€ì´ë‹¤. ì´ëŠ” return_sequencesê°€ Trueì´ê³  maskê°€ ì ìš©ëœ ê²½ìš°ì—ë§Œ ì‚¬ìš©ëœë‹¤.

### ğŸ“Œ Input shape

time_majorê°€ Trueì¼ ê²½ìš° `[timesteps, batch_size, ...]`, ì¼ë°˜ì ìœ¼ë¡œëŠ” `[batch_size, timesteps, ...]`

### ğŸ“Œ Output shape

- return_stateê°€ Trueì¼ ê²½ìš° tensor listë¥¼ returní•œë‹¤. listì˜ ì²«ë²ˆì§¸ ìš”ì†ŒëŠ” outputì´ë©° ë‘ë²ˆì§¸ ìš”ì†ŒëŠ” [batch_size, state_size] í˜•íƒœì˜ ë§ˆì§€ë§‰ stateì´ë‹¤. 
- return_sequencesê°€ Trueì¼ ê²½ìš° [batch_size, timesteps, output_size]ì„ returní•œë‹¤.

### ğŸ“Œ Masking

RNN layerëŠ” ê°€ë³€ì ì¸ inputì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ maskingì„ ì§€ì›í•œë‹¤. ì´ë¥¼ ì ìš©í•˜ë ¤ë©´ mask_zeroë¥¼ Trueë¡œ ì„¤ì •í•œ Embedding layerë¥¼ ì‚¬ìš©í•´ì•¼í•œë‹¤.

### ğŸ“Œ Example

````python
import tensorflow as tf

# single cell
cell = tf.keras.layers.LSTMCell(4)
x = tf.keras.Input((None, 5))
layer = tf.keras.layers.RNN(cell)
y = layer(x)

print(y.shape)
````

````
(None, 4)
````

````python
# stacked RNN
cells = [tf.keras.layers.LSTMCell(32), tf.keras.layers.LSTMCell(64)]
x = tf.keras.Input((None, 5))
layer = tf.keras.layers.RNN(cells)
y = layer(x)

print(y.shape)
````

````
(None, 64)
````

