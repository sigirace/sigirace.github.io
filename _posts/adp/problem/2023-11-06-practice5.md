---
layout: single
title:  'ADP ì‹¤ê¸° ì—°ìŠµë¬¸ì œ (5)'
toc: true
categories: [ADP]
tags: []


---

ë³¸ ê²Œì‹œë¬¼ì€ ADP ì‹¤ê¸°ì˜ ì—°ìŠµë¬¸ì œ í’€ì´ì— ëŒ€í•œ ê²ƒì´ë‹¤.
{: .notice}

# ë¨¸ì‹ ëŸ¬ë‹

## 1. ë°ì´í„° ì „ì²˜ë¦¬

### 1.1 ë°ì´í„°ì˜ íŠ¹ì§•ì„ íŒŒì•… (EDA)

â˜€ï¸ **ë°ì´í„° ê°œìš”**

````python
import pandas as pd
import numpy as np 
df= pd.read_csv("https://raw.githubusercontent.com/ADPclass/ADP_book_ver01/main/data/27_problem1.csv")
df.head()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/1.png?raw=true" width="900" height="150"></p>

````python
df_desc = df.describe()
df_desc
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/2.png?raw=true" width="900" height="200"></p>

````python
pd.DataFrame(df_desc.loc['std',:]).sort_values(by=['std'], ascending=False)
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/3.png?raw=true" width="200" height="500"></p>

````
df.info()
````

````
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Time    1193 non-null   float64
 1   V1      1193 non-null   float64
 2   V2      1193 non-null   float64
 3   V3      1193 non-null   float64
 4   V4      1193 non-null   float64
 5   V5      1193 non-null   float64
 6   V6      1193 non-null   float64
 7   V7      1193 non-null   float64
 8   V8      1193 non-null   float64
 9   V9      1193 non-null   float64
 10  V10     1193 non-null   float64
 11  V11     1193 non-null   float64
 12  V12     1193 non-null   float64
 13  V13     1193 non-null   float64
 14  V14     1193 non-null   float64
 15  V15     1193 non-null   float64
 16  V16     1193 non-null   float64
 17  V17     1193 non-null   float64
 18  Amount  1193 non-null   float64
 19  Class   1193 non-null   int64 
````

ğŸ“ **ë°ì´í„° íƒìƒ‰ ê²°ê³¼**

1. target: Class
2. missing value: ê²°ì¸¡ì¹˜ ì—†ìŒ
3. outlier: amountë¥¼ ì œì™¸í•œ í‘œì¤€í¸ì°¨ ë˜í•œ ì¼ì •í•¨ìœ¼ë¡œ ì´ìƒì¹˜ëŠ” ì—†ì–´ ë³´ì„, amountëŠ” ì†ì„± ìƒ ì°¨ì´ê°€ ë§ì´ ë‚  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹œê°í™”ë¥¼ í†µí•´ í™•ì¸
4. scaling: amountì˜ ë²”ì£¼ê°€ ë‹¤ë¥¸ ë³€ìˆ˜ë“¤ ë³´ë‹¤ í¬ê¸°ì— ìŠ¤ì¼€ì¼ë§ ê³ ë ¤í•´ì•¼í•¨
5. feature type: ëª¨ë‘ float typeì´ë©° targetì¸ classëŠ” categorical type

â˜€ï¸ **ë°ì´í„° ì‹œê°í™”**

ğŸ‘€ **ì‹œê³„ì—´-êº¾ì€ì„  ê·¸ë˜í”„**

````python
import matplotlib.pyplot as plt

plt.plot(df.index, df['Time'])
plt.xlabel('Time')
plt.ylabel('Value')
plt.title('Line Chart')
plt.xticks(rotation=45)
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/4.png?raw=true" width="600" height="400"></p>

- Timeì€ Indexì— ë”°ë¼ ì¦ê°€í•˜ëŠ” ë‹¨ìˆœ ì‹œê°„ ì§€í‘œì´ë¯€ë¡œ ë³€ìˆ˜ì—ì„œ ì‚­ì œ

````python
df.drop(columns=['Time'], inplace=True)
````

ğŸ‘€ **ìˆ˜ì¹˜í˜•-íˆìŠ¤í† ê·¸ë¨**

````python
import seaborn as sns

fig, axes = plt.subplots(nrows=3, ncols=6, figsize=(16, 5))

columns = df.columns.to_list()
columns.remove('Class')

for i, column in enumerate(columns):
    row = i // 6
    col = i % 6
    axes[row, col].hist(df[column], bins=20, color='skyblue', alpha=0.7)
    axes[row, col].set_title(f'Histogram of {column}')
    axes[row, col].set_xlabel(column)
    axes[row, col].set_ylabel('Frequency')

plt.tight_layout()

plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/5.png?raw=true" width="900" height="400"></p>

ğŸ‘€ **ìˆ˜ì¹˜í˜•-ë°•ìŠ¤í”Œë¡¯**

````python
fig, axes = plt.subplots(nrows=3, ncols=6, figsize=(16, 5))

for i, column in enumerate(columns):

    row = i // 6
    col = i % 6
    sns.boxplot(x=df[column], ax=axes[row, col], color='skyblue')
    axes[row, col].set_title(f'Box plot of {column}')
    axes[row, col].set_xlabel(column)
    axes[row, col].set_ylabel('Frequency')

plt.tight_layout()
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/6.png?raw=true" width="900" height="400"></p>

ğŸ‘€ **ë²”ì£¼í˜•-ë§‰ëŒ€ê·¸ë˜í”„**

````python
fig, axes = plt.subplots(nrows=1, ncols=1, figsize=(3, 3))
target = ['Class']
for i, column in enumerate(target):

    df[column].value_counts().sort_index().plot(kind='bar', ax=axes, color='skyblue')
    axes.set_title(f'Bar Plot of {column}')
    axes.set_xlabel(column)
    axes.set_ylabel('Frequency')

plt.tight_layout()
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/7.png?raw=true" width="300" height="300"></p>

ğŸ‘€ **ê·¸ë£¹ë³„ ë°ì´í„°**

- classification ë¬¸ì œì´ê¸° ë•Œë¬¸ì— ê·¸ë£¹ë³„ë¡œ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ íŒŒì•…

````python
group_class = df.groupby('Class').mean()
group_class
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/8.png?raw=true" width="900" height="80"></p>

````python
fig, axes = plt.subplots(3, 6, figsize=(16, 10))

columns = group_class.columns.to_list()

for i, column in enumerate(columns):
    row = i // 6
    col = i % 6
    sns.barplot(x=group_class.index, y=column, data=group_class, ax=axes[row, col])
    axes[row, col].set_title(f'Average {column}')
    axes[row, col].set_xlabel("class")
    axes[row, col].set_ylabel(f'Average {column}')

plt.tight_layout()
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/9.png?raw=true" width="900" height="600"></p>

ğŸ“**ì‹œê°í™” ê²°ê³¼**

- íˆìŠ¤í† ê·¸ë¨ ë° ë°•ìŠ¤í”Œë¡¯ì„ í™•ì¸í•œ ê²°ê³¼ ì´ìƒì¹˜ê°€ ìˆì„ ìˆ˜ ìˆìŒ
- ê·¸ëŸ¬ë‚˜ ì´ìƒì¹˜ê°€ ë¹„ì •ìƒ ê±°ë˜ì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì œê±°í•  ìˆ˜ ì—†ìŒ
- í˜„ì—…ì˜ ì˜ê²¬ ì—†ì´ ì‰½ê²Œ ì œê±°í•  ìˆ˜ ì—†ì„ ê²ƒìœ¼ë¡œ íŒë‹¨
- ì •ìƒ/ ë¹„ì •ìƒ ê±°ë˜ì— ë”°ë¼ ê°’ì˜ í‰ê·  ë¶„í¬ê°€ ë‹¤ë¦„
- ê° classì— ë”°ë¼ ì–‘ìˆ˜ì™€ ìŒìˆ˜ë¡œ êµ¬ë¶„ë˜ëŠ” íŠ¹ì§•ì´ ìˆìŒ

### 1.2 ìƒê´€ê´€ê³„ë¥¼ ì‹œê°í™”í•˜ê³  ì „ì²˜ë¦¬ê°€ í•„ìš”í•¨ì„ ì„¤ëª…

ğŸ‘€ **ìƒê´€ê´€ê³„-scatter matrix**

````python
from pandas.plotting import scatter_matrix

scatter_matrix(df, alpha=0.5, figsize=(15,10), diagonal='hist')
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/10.png?raw=true" width="900" height="900"></p>

ğŸ‘€ **ìƒê´€ê´€ê³„-pairplot**

````python
sns.pairplot(df, diag_kind='auto', hue='Class')
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/11.png?raw=true" width="900" height="900"></p>

ğŸ‘€ **ìƒê´€ê´€ê³„-íˆíŠ¸ë§µ**

````python
plt.figure(figsize=(15, 10))
df_corr = df.corr(method='pearson')
sns.heatmap(df_corr,
             xticklabels = df_corr.columns,
             yticklabels = df_corr.columns,
             cmap='RdBu_r',
             annot=True, 
             linewidth=3,
             fmt=".2f")
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/12.png?raw=true" width="900" height="900"></p>

````python
df_corr[df_corr>0.9]
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/13.png?raw=true" width="900" height="500"></p>

ğŸ“ **ìƒê´€ê´€ê³„ ì‹œê°í™” í•´ì„**
- ëŒ€ë¶€ë¶„ classì™€ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ê°€ì§€ê³  ìˆìŒ
- ì„¤ëª…ë³€ìˆ˜ì¸ V16ê³¼ V17ì€ ì„œë¡œ ê°•í•œ ìƒê´€ê´€ê³„ë¥¼ ê°€ì§€ê³  ìˆê¸°ì— ë‹¤ì¤‘ê³µì„ ì„±ì„ ì œê±°í•˜ê¸° ìœ„í•´ ì „ì²˜ë¦¬ê°€ í•„ìš”í•¨
- ì„ í˜• ëª¨ë¸ì„ ì‚¬ìš©í•  ê²½ìš° ë‹¤ì¤‘ê³µì„ ì„±ì€ ëª¨ë¸ ì„±ëŠ¥ì˜ ì €í•˜ë¥¼ ê°€ì ¸ì˜´
- íŠ¸ë¦¬ ëª¨ë¸ì¼ ê²½ìš° í¬ê²Œ ë¬¸ì œê°€ ë˜ì§€ ì•Šìœ¼ë‚˜ ì»´í“¨íŒ… íŒŒì›Œë¥¼ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆìŒ

â˜€ï¸ **ì°¨ì› ì¶•ì†Œë¥¼ í†µí•œ ëŒ€ì²´**
- ìƒê´€ê´€ê³„ê°€ ë†’ì€ V16ê³¼ V17ì„ PCAë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ ë³€ìˆ˜ë¡œ ëŒ€ì²´í•¨

````python
from sklearn.decomposition import PCA

pca = PCA(n_components=1)

pca.fit(df[['V16', 'V17']])
new_V = pca.transform(df[['V16', 'V17']])
df.drop(columns=['V16', 'V17'], inplace=True)
df['V16'] = new_V

df_corr = df.corr(method='pearson')
df_corr[df_corr>0.9]
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/14.png?raw=true" width="900" height="500"></p>

- ì°¨ì› ì¶•ì†Œë¥¼ í†µí•´ ì„¤ëª…ë³€ìˆ˜ê°„ ë†’ì€ ìƒê´€ê³„ìˆ˜ê°€ ìˆëŠ” ê²ƒì„ ë°©ì§€í•¨

â˜€ï¸ **VIF**

- VIF ê°’ì„ í™•ì¸í•´ 10ì´ ë„˜ëŠ” ë³€ìˆ˜ë“¤ì€ ì œê±°

````python
from statsmodels.stats.outliers_influence import variance_inflation_factor


def calculate_vif(data):
    vif_data = pd.DataFrame()
    vif_data["Variable"] = data.columns
    vif_data["VIF"] = [variance_inflation_factor(data.values, i) for i in range(data.shape[1])]
    return vif_data

vif_result = calculate_vif(df)

print(vif_result)
````

````
   Variable       VIF
0        V1  3.264282
1        V2  4.463299
2        V3  6.598955
3        V4  3.113218
4        V5  5.472737
5        V6  1.576476
6        V7  9.686757
7        V8  1.601987
8        V9  2.407308
9       V10  6.922507
10      V11  3.791752
11      V12  7.588225
12      V13  1.027083
13      V14  7.195011
14      V15  1.046278
15   Amount  3.160966
16    Class  4.141382
17      V16  4.942999
````

ğŸ“ **ìƒê´€ê´€ê³„ë¥¼ í†µí•œ ì „ì²˜ë¦¬ ê²°ê³¼**

- ì„¤ëª…ë³€ìˆ˜ê°„ ìƒê´€ê´€ê³„ê°€ 0.9 ì´í•˜
- ëª¨ë“  VIFê°€ 10 ì´í•˜

## 2. ì°¨ì›ì¶•ì†Œ

### 2.1 ì°¨ì›ì¶•ì†Œ ë°©ë²•ì„ ì„ íƒí•˜ê³  ì´ìœ ë¥¼ ì„¤ëª…

â˜€ï¸ **ì£¼ì„±ë¶„ ë¶„ì„**

- ë°ì´í„°ë¥¼ ì •í™•íˆ ì•Œì§€ ëª»í•  ë•Œ, ì£¼ê´€ì ì¸ ê²¬í•´ê°€ í•„ìš”í•œ ìš”ì¸ë¶„ì„ì„ ì‚¬ìš©í•˜ê¸° ì–´ë ¤ì›€
- ì£¼ì„±ë¶„ ë¶„ì„ì€ ë°ì´í„°ì˜ ì„ í˜•ê´€ê³„ë§Œì„ ì‚¬ìš©í•˜ê¸°ì— ê°€ëª… ì²˜ë¦¬ëœ ë°ì´í„°ì— ì í•©í•œ ê¸°ë²•

````python
X = df[df.columns.difference(['Class', 'Amount'])].copy()

from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA

scaler = StandardScaler()
scaled_amount = scaler.fit_transform(df[['Amount']])
X['Amount'] = scaled_amount

pca = PCA(n_components=10)  # ì£¼ì„±ë¶„ 10ê°œ ì„ íƒ
pca.fit(np.array(X))

# ì£¼ì„±ë¶„ê³¼ ì£¼ì„±ë¶„ì˜ ì„¤ëª…ëœ ë¶„ì‚° ë¹„ìœ¨ í™•ì¸
print("\nì£¼ì„±ë¶„ì˜ ì„¤ëª…ëœ ë¶„ì‚° ë¹„ìœ¨ (Explained Variance Ratio):")
print(pca.explained_variance_ratio_)

print("ì£¼ì„±ë¶„ 2ê°œ ê¹Œì§€ì˜ ë¶„ì‚° ì„¤ëª…ë ¥: ", pca.explained_variance_ratio_[:2].sum()*100)
print("ì£¼ì„±ë¶„ 3ê°œ ê¹Œì§€ì˜ ë¶„ì‚° ì„¤ëª…ë ¥: ", pca.explained_variance_ratio_[:3].sum()*100)

# ê³ ìœ ê°’(eigenvalues)ì„ xì¶•ì— ëŒ€í•œ ê·¸ë˜í”„ë¡œ í”Œë¡¯íŠ¸í•©ë‹ˆë‹¤.
plt.figure(figsize=(8, 6))
plt.plot(range(1, len(pca.explained_variance_) + 1), pca.explained_variance_, marker='o', linestyle='--')
plt.xlabel('num of eigen value')
plt.ylabel('value')
plt.title('scree plot')
plt.grid()
plt.show()
````

````
ì£¼ì„±ë¶„ì˜ ì„¤ëª…ëœ ë¶„ì‚° ë¹„ìœ¨ (Explained Variance Ratio):
[0.66178089 0.07876812 0.05260773 0.04012797 0.0368832  0.02135704
 0.01614583 0.01582915 0.01262278 0.01155196]
ì£¼ì„±ë¶„ 2ê°œ ê¹Œì§€ì˜ ë¶„ì‚° ì„¤ëª…ë ¥:  74.05490151252522
ì£¼ì„±ë¶„ 3ê°œ ê¹Œì§€ì˜ ë¶„ì‚° ì„¤ëª…ë ¥:  79.31567489552914
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/15.png?raw=true" width="600" height="500"></p>

ğŸ“ **ì£¼ì„±ë¶„ ë¶„ì„ í•´ì„**

- scree plotì„ í†µí•´ í™•ì¸í•œ ì ì ˆí•œ ì°¨ì› ìˆ˜ëŠ” 2ë¡œ ë‚˜íƒ€ë‚¨
- ê·¸ëŸ¬ë‚˜ 2ì°¨ì›ìœ¼ë¡œ ì¤„ì¼ì‹œ ë¶„ì‚°ì€ ì „ì²´ ë°ì´í„°ì˜ 80%ë¥¼ ì„¤ëª…í•˜ì§€ ëª»í•¨
- ë”°ë¼ì„œ ì£¼ì„±ë¶„ ë¶„ì„ì„ ì‚¬ìš©í•œ ë°ì´í„°ëŠ” ì ì ˆí•˜ì§€ ì•ŠìŒ

## 3. ëª¨ë¸ë§

### 3.1 ë¶„ë¥˜ ëª¨ë¸ ìƒì„± ë° ì„±ëŠ¥ ì¸¡ì •

â˜€ï¸ **Random Forest**

````python
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import roc_curve, roc_auc_score, classification_report
from sklearn.model_selection import train_test_split

y = df['Class']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, stratify=y, random_state=20)
clf = RandomForestClassifier()
clf.fit(X_train, y_train)
print('train ì •í™•ë„ :', clf.score(X_train, y_train), '\n')
pred=clf.predict(X_test)
print(classification_report(y_test, pred))
print('test ì •í™•ë„ :', clf.score(X_test, y_test), '\n')
````

````
train ì •í™•ë„ : 1.0 

              precision    recall  f1-score   support

           0       0.96      0.99      0.98       298
           1       0.96      0.82      0.88        60

    accuracy                           0.96       358
   macro avg       0.96      0.90      0.93       358
weighted avg       0.96      0.96      0.96       358

test ì •í™•ë„ : 0.9636871508379888 
````

````python
fpr, tpr, thresholds = roc_curve(y_test, clf.predict_proba(X_test)[:,1])
roc_auc = roc_auc_score(y_test, clf.predict_proba(X_test)[:,1])

plt.figure()
plt.plot(fpr, tpr, color='darkorange', lw=2, label='Classifer (AUC = %0.2f)' % roc_auc)
plt.plot([0,1],[0,1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('FPR')
plt.ylabel('TPR')
plt.title('ROC')
plt.legend(loc='lower right')
plt.show()

print("score:", roc_auc)
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/16.png?raw=true" width="600" height="500"></p>

````
score: 0.9812080536912751
````

ğŸ“ **ëª¨ë¸ë§ ê²°ê³¼ í•´ì„**
- AUCê°€ 0.96ìœ¼ë¡œ ë§¤ìš° ë†’ì€ ê°’(=ì •í™•ë„)ì„ ë‚˜íƒ€ëƒ„
- ê·¸ëŸ¬ë‚˜ classê°€ 1ì¸ ì‚¬ê¸°ì— ëŒ€í•´ recallì´ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŒ
- ë°ì´í„° ë¶ˆê· í˜•ì— ë”°ë¼ ì •í™•ë„ê°€ ë†’ì€ ê²ƒìœ¼ë¡œ ë‚˜ì˜¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì˜¤ë²„ìƒ˜í”Œë§ì„ í†µí•´ í™•ì¸ í•„ìš”


### 3.2 ì˜¤ë²„ìƒ˜í”Œë§ì„ ì ìš©í•œ ë¶„ë¥˜ ëª¨ë¸ ìƒì„± ë° ì„±ëŠ¥ ì¸¡ì •

â˜€ï¸ **Random Over Sampling**

````python
from imblearn.over_sampling import RandomOverSampler 

ros = RandomOverSampler()
X_ro, y_ro = ros.fit_resample(X_train,y_train)
print('ê¸°ì¡´ì˜ íƒ€ê¹ƒ ë¶„í¬')
print(y_train.value_counts()/len(y_train))
print('-'*10)
print('upsamplingì˜ íƒ€ê¹ƒ ë¶„í¬')
print(y_ro.value_counts()/len(y_ro))
````

````
ê¸°ì¡´ì˜ íƒ€ê¹ƒ ë¶„í¬
0    0.832335
1    0.167665
Name: Class, dtype: float64
----------
upsamplingì˜ íƒ€ê¹ƒ ë¶„í¬
1    0.5
0    0.5
Name: Class, dtype: float64
````

````python
clf = RandomForestClassifier()
clf.fit(X_ro, y_ro)
print('train ì •í™•ë„ :', clf.score(X_ro, y_ro), '\n')
pred=clf.predict(X_test)
print(classification_report(y_test, pred))
print('test ì •í™•ë„ :', clf.score(X_test, y_test), '\n')
````

````
train ì •í™•ë„ : 1.0 

              precision    recall  f1-score   support

           0       0.97      0.99      0.98       298
           1       0.96      0.83      0.89        60

    accuracy                           0.97       358
   macro avg       0.96      0.91      0.94       358
weighted avg       0.97      0.97      0.97       358

test ì •í™•ë„ : 0.9664804469273743 
````

````python
fpr, tpr, thresholds = roc_curve(y_test, clf.predict_proba(X_test)[:,1])
roc_auc = roc_auc_score(y_test, clf.predict_proba(X_test)[:,1])

plt.figure()
plt.plot(fpr, tpr, color='darkorange', lw=2, label='Classifer (AUC = %0.2f)' % roc_auc)
plt.plot([0,1],[0,1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('FPR')
plt.ylabel('TPR')
plt.title('ROC')
plt.legend(loc='lower right')
plt.show()

print("score:", roc_auc)
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/17.png?raw=true" width="600" height="500"></p>

````
score: 0.9849832214765101
````

â˜€ï¸ **SMOTE**

````python
from imblearn.over_sampling import SMOTE
import warnings 
warnings.filterwarnings('ignore')

smote = SMOTE(random_state=0)
X_sm, y_sm = smote.fit_resample(X_train,y_train)

print('ê¸°ì¡´ì˜ íƒ€ê¹ƒ ë¶„í¬')
print(y_train.value_counts()/len(y_train))
print('-'*10)
print('upsamplingì˜ íƒ€ê¹ƒ ë¶„í¬')
print(y_sm.value_counts()/len(y_sm))
````

````
ê¸°ì¡´ì˜ íƒ€ê¹ƒ ë¶„í¬
0    0.832335
1    0.167665
Name: Class, dtype: float64
----------
upsamplingì˜ íƒ€ê¹ƒ ë¶„í¬
1    0.5
0    0.5
Name: Class, dtype: float64
````

````python
clf = RandomForestClassifier()
clf.fit(X_sm, y_sm)
print('train ì •í™•ë„ :', clf.score(X_sm, y_sm), '\n')
pred=clf.predict(X_test)
print(classification_report(y_test, pred))
print('test ì •í™•ë„ :', clf.score(X_test, y_test), '\n')
````

````
train ì •í™•ë„ : 1.0 

              precision    recall  f1-score   support

           0       0.97      0.99      0.98       298
           1       0.93      0.85      0.89        60

    accuracy                           0.96       358
   macro avg       0.95      0.92      0.93       358
weighted avg       0.96      0.96      0.96       358

test ì •í™•ë„ : 0.9636871508379888 
````

````python
fpr, tpr, thresholds = roc_curve(y_test, clf.predict_proba(X_test)[:,1])
roc_auc = roc_auc_score(y_test, clf.predict_proba(X_test)[:,1])

plt.figure()
plt.plot(fpr, tpr, color='darkorange', lw=2, label='Classifer (AUC = %0.2f)' % roc_auc)
plt.plot([0,1],[0,1], color='navy', lw=2, linestyle='--')
plt.xlim([0.0, 1.0])
plt.ylim([0.0, 1.05])
plt.xlabel('FPR')
plt.ylabel('TPR')
plt.title('ROC')
plt.legend(loc='lower right')
plt.show()

print("score:", roc_auc)
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/18.png?raw=true" width="600" height="500"></p>

````
score: 0.9823825503355704
````

ğŸ“ **ì˜¤ë²„ìƒ˜í”Œë§ ëª¨ë¸ë§ ê²°ê³¼ í•´ì„**
- Random Oversampling: ì „ì²´ì ì¸ ì„±ëŠ¥ì´ í–¥ìƒë¨
- SMOTE: 1(=ì‚¬ê¸°)ì¸ ë°ì´í„°ì— ëŒ€í•´ recall ì´ ì¦ê°€
- ì‚¬ê¸°ë¥¼ ì°¾ëŠ” ê²ƒì´ ì¤‘ìš”í•  ê²½ìš° SMOTEë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•  ìˆ˜ ìˆìŒ


## 4. ì´ìƒì¹˜ íƒì§€
### 4.1 ì´ìƒì¹˜ íƒì§€ ëª¨ë¸ë§ ìˆ˜í–‰

â˜€ï¸ **DBSCAN**

````python
df_new = pd.concat([X, y], axis=1)
df_outlier = df_new[df_new['Class']==1]
df_new = df_new.drop(df_outlier.index)
df_com = pd.concat([df_new, df_outlier])
X_sp = df_com[df_com.columns.difference(['Class'])]
y_sp = df_com['Class']

from sklearn.neighbors import NearestNeighbors
neigh = NearestNeighbors(n_neighbors=2)
nbrs = neigh.fit(X_sp)
distances, indices = nbrs.kneighbors(X_sp)

distances
````

````
array([[0.00000000e+00, 7.79016257e-01],
       [0.00000000e+00, 3.65444216e+00],
       [8.42936970e-08, 1.59509238e+00],
       ...,
       [0.00000000e+00, 9.80715259e+00],
       [0.00000000e+00, 2.36952563e+00],
       [0.00000000e+00, 4.12129265e+00]])
````

````python
distances = np.sort(distances, axis=0)
distances = distances[:,1]
plt.figure(figsize=(10,5))
plt.plot(distances)
plt.title('K-distance Graph')
plt.xlabel('Data Points sorted by distane')
plt.ylabel('Epsilon')
plt.show()
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/19.png?raw=true" width="600" height="500"></p>

````
- ìµœì  epslionì˜ ê°’ì€ K-distance ê·¸ë˜í”„ì—ì„œ ìµœëŒ€ ê³¡ë¥  ì§€ì 
- minPointëŠ” ë„ë©”ì¸ ì§€ì‹ì— ë”°ë¼ ë‹¤ë¦„ (=ì‹¤í—˜ì ìœ¼ë¡œ ìˆ˜í–‰)
````

````python
from sklearn.cluster import DBSCAN

db = DBSCAN(eps=6, min_samples=35).fit(X_sp)
labels = db.labels_
data = pd.DataFrame()
data['Class'] = y_sp.copy()
data['labels'] = labels
data.labels.value_counts()
````

````
 0    998
-1    195
Name: labels, dtype: int64
````

- 1ì€ ë¹„ì •ìƒ ë°ì´í„°ë¡œ íŒë³„

### 4.2 ì´ìƒì¹˜ íƒì§€ ëª¨ë¸ ì„±ëŠ¥ í‰ê°€

````python
from sklearn.metrics import confusion_matrix
from sklearn import metrics
# ì´ìƒì¹˜ë¥¼ ì°¾ìœ¼ë ¤ê³  í•˜ëŠ” Positiveë¡œ ë‘ê¸° ìœ„í•´ 1ë¡œ ëŒ€ì²´
data.loc[data.labels==-1, "labels"] = 1
confusion_matrix(data['Class'], data['labels'])
````

````
array([[967,  26],
       [ 31, 169]])
````

````python
accuracy = metrics.accuracy_score(data.Class,data.labels)
print("ì •í™•ë„:", accuracy)
precision = metrics.precision_score(data.Class,data.labels)
print("ì •ë°€ë„:", precision)
recall = metrics.recall_score(data.Class,data.labels)
print("ì¬í˜„ìœ¨:", recall)
f1 = metrics.f1_score(data.Class,data.labels)
print("f1 ì ìˆ˜:", f1)
````

````
ì •í™•ë„: 0.9522212908633697
ì •ë°€ë„: 0.8666666666666667
ì¬í˜„ìœ¨: 0.845
f1 ì ìˆ˜: 0.8556962025316455
````

ğŸ“ **ì´ìƒì¹˜ íƒì§€ ëª¨ë¸ í•´ì„**

- ëª¨ë“  ì§€í‘œê°€ Random Forest ëª¨ë¸ì— ë¹„í•´ ë–¨ì–´ì§

# í†µê³„ë¶„ì„

## 1. í‰ê· (ëŒ€í‘œê°’)

### 2ë…„ ì „ ì œí’ˆ ìƒì‚°ëŸ‰ì´ 100,000ê°œ, 1ë…„ ì „ ì œí’ˆ ìƒì‚°ëŸ‰ì´ 150,000ê°œ, ê·¸ í›„ íŒ©í† ë¦¬ ê¸°ìˆ ì˜ ìƒìŠ¹ìœ¼ë¡œ ì œí’ˆ ìƒì‚°ëŸ‰ì´ 250,000ê°œ ë˜ì—ˆì„ ë•Œ, ì—°í‰ê·  ìƒìŠ¹ë¥ ì˜ ëŒ€í‘¯ê°’ì„ êµ¬í•˜ì‹œì˜¤(ë°˜ì˜¬ë¦¼í•˜ì—¬ ì†Œìˆ˜ì  ì•„ë˜ ë‘˜ì§¸ìë¦¬ê¹Œì§€ í‘œê¸°)

````
n1 = 100000
n2 = 150000
n3 = 250000
````

â˜€ï¸ **ê¸°í•˜í‰ê· **

- 1ë…„ì°¨ ìƒìŠ¹ë¥ (r1): n2/n1
- 2ë…„ì°¨ ìƒìŠ¹ë¥ (r2): n3/n2
- í‰ê·  ìƒìŠ¹ë¥ : (r1 * r2) **(1/2)

````python
r1 = (n2)/(n1)
r2 = (n3)/(n2)
np.round(((r1 * r2)**(1/2) -1)*100, 2)
````

````
58.11
````

## 2. ê°€ì„¤ê²€ì • (1)

### 12ê±´ì˜ ê´‘ê³ ì‹œê°„ì„ ì¸¡ì •í•œ ë°ì´í„°ì—ì„œ, í‰ê· ì€ 15.5ì´ˆ, ë¶„ì‚°ì€ 3.2ì´ˆì˜€ë‹¤. ì´ë•Œ ê´‘ê³ ì‹œê°„ì˜ 90% ì‹ ë¢°êµ¬ê°„ì„ êµ¬í•˜ì‹œì˜¤.

âœï¸ **ë¬¸ì œ ì •ì˜**

- ë‹¨ì¼ ì§‘ë‹¨ ì‹ ë¢°êµ¬ê°„ ì¶”ì •
- ëª¨ë¶„ì‚°ì„ ëª¨ë¥´ëŠ” ê²½ìš°

````python
from scipy.stats import t

sample_size = 12
degrees_of_freedom = sample_size-1

confidence = 0.90

two_side_alpha = (1 - confidence)/2
two_side = 1 - two_side_alpha

two_side_value = t.ppf(two_side, df=degrees_of_freedom)

print(f"t ë¶„í¬ 95% ì–‘ì¸¡ê²€ì • ë°±ë¶„ìœ„ìˆ˜: {two_side_value}")
````

````
t ë¶„í¬ 95% ì–‘ì¸¡ê²€ì • ë°±ë¶„ìœ„ìˆ˜: 1.7958848187036691
````

````python
mu_x = 15.5
var_x = 3.2
bound = two_side_value * ((var_x **(1/2))/(sample_size**(1/2)))
upper = mu_x + bound
under = mu_x - bound

print(under, upper)
````

````
14.572609067393861 16.427390932606137
````

## 3. ê°€ì„¤ê²€ì •(2)

### ê°•ì˜ ìƒë¥˜ì™€ í•˜ë¥˜ì˜ ìƒë¬¼ ë‹¤ì–‘ì„± ì ìˆ˜ì— ì°¨ì´ê°€ ìˆëŠ”ì§€ ìœ ì˜ìˆ˜ì¤€ 0.1í•˜ì— ê²€ì •í•˜ì‹œì˜¤(ë‹¨, ê°™ì€ ê°•ì—ì„œ ìƒë¥˜ì™€ í•˜ë¥˜ëŠ” ì„œë¡œ ë…ë¦½ì ì´ì§€ ì•Šìœ¼ë©°, ì¢…ì†ì ì¸ ê´€ê³„ì— ìˆìŒ. ì •ê·œì„±ì„ ë§Œì¡±í•œë‹¤ê³  ê°€ì •).

````python
import pandas as pd
import numpy as np
df = pd.read_csv("https://raw.githubusercontent.com/ADPclass/ADP_book_ver01/main/data/27_problem7.csv")
df
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/20.png?raw=true" width="230" height="150"></p>

âœï¸ **ë¬¸ì œ ì •ì˜**
- ëŒ€ì‘ í‘œë³¸ ì§‘ë‹¨
- ì •ê·œì„± ë§Œì¡±
- ëŒ€ì‘í‘œë³¸ t-test
- ì¢…ì†ì ì´ë‹¤ -> ë…ë¦½í‘œë³¸ì´ ì•„ë‹˜

â˜€ï¸ **ê°€ì„¤ ìˆ˜ë¦½**
- H0: ë‹¤ì–‘ì„± ì ìˆ˜ì— ì°¨ì´ëŠ” ì—†ë‹¤.
- H1: ë‹¤ì–‘ì„± ì ìˆ˜ì— ì°¨ì´ëŠ” ìˆë‹¤.

````python
import numpy as np
from scipy import stats

# ëŒ€ì‘í‘œë³¸ ë°ì´í„° ì„¤ì •
before_treatment = df['up'].tolist()
after_treatment = df['down'].tolist()

result = stats.ttest_rel(a=before_treatment, b=after_treatment, alternative='two-sided')

# ê²°ê³¼ ì¶œë ¥
t_statistic = result.statistic
p_value = result.pvalue

print("ëŒ€ì‘í‘œë³¸ t-ê²€ì • í†µê³„ëŸ‰ (t-statistic):", t_statistic)
print("p-ê°’ (p-value):", p_value)

alpha = 0.05  
if p_value < alpha:
    print("ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•©ë‹ˆë‹¤. ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.")
else:
    print("ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì°¨ì´ê°€ ì—…ìŠµë‹ˆë‹¤.")
````

````
ëŒ€ì‘í‘œë³¸ t-ê²€ì • í†µê³„ëŸ‰ (t-statistic): 3.3526056764717995
p-ê°’ (p-value): 0.028499777234053288
ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•©ë‹ˆë‹¤. ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
````

## 4. ê°€ì„¤ê²€ì •(3)

### ì§€í•˜ì²  í˜¸ì„ ê³¼ ì›”ë³„ ìŠ¹ê° ìˆ˜ ê°„ ìƒê´€ê´€ê³„ í™•ì¸

````python
import pandas as pd 
df = pd.read_csv("https://raw.githubusercontent.com/ADPclass/ADP_book_ver01/main/data/27_problem9.csv")
df
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/21.png?raw=true" width="250" height="250"></p>

âœï¸ **ë¬¸ì œ ì •ì˜**
- line: ëª…ëª©í˜•/ month: ìˆ˜ì¹˜í˜• or ëª…ëª©í˜•/ total: ìˆ˜ì¹˜í˜•
- ìš”ì¸ì€ ì›”, ìŠ¹ê°ìˆ˜
  - ë”°ë¼ì„œ monthëŠ” ëª…ëª©í˜•
- ì´ì›ë°°ì¹˜ ë¶„ì‚°ë¶„ì„ ìˆ˜í–‰
- ê° í˜¸ì„ ë‹¹ ì›”ì´ 2ë²ˆì”© ë°˜ë³µë˜ê¸° ë•Œë¬¸ì— ë°˜ë³µì´ ìˆëŠ” ê²½ìš°

â˜€ï¸ **ê°€ì„¤ ìˆ˜ë¦½**
1. ìƒí˜¸ì‘ìš©
   - H0: ìš”ì¸ê°„ ìƒí˜¸ì‘ìš© ì—†ìŒ
   - H1: ìš”ì¸ê°„ ìƒí˜¸ì‘ìš© ìˆìŒ
1. ì£¼íš¨ê³¼
   - H0: í˜¸ì„ ì— ë”°ë¼ ìŠ¹ê°ìˆ˜ì˜ ì°¨ì´ëŠ” ì¡´ì¬
   - H1: í˜¸ì„ ì— ë”°ë¼ ìŠ¹ê°ìˆ˜ì˜ ì°¨ì´ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ
   - H0: ì›”ì— ë”°ë¼ ìŠ¹ê°ìˆ˜ì˜ ì°¨ì´ëŠ” ì¡´ì¬
   - H1: ì›”ì— ë”°ë¼ ìŠ¹ê°ìˆ˜ì˜ ì°¨ì´ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ

````python
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm
formula ='total ~C(line)*C(month)'
model = ols(formula, df).fit()
aov_table = anova_lm(model, typ=3)
aov_table
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/22.png?raw=true" width="600" height="300"></p>

ğŸ“ **ANOVA í•´ì„**
- ìƒí˜¸ ì‘ìš©ì— ëŒ€í•œ ê°€ì„¤ì€ p-valueê°€ 0.1ë³´ë‹¤ ì‘ê¸°ì— ê·€ë¬´ê°€ì„¤ ê¸°ê°
  - ìƒí˜¸ì‘ìš©ì´ ìˆìŒ
- ì£¼íš¨ê³¼ ê²€ì •ì— ëŒ€í•œ ê°€ì„¤ ë˜í•œ p-valueê°€ 0.1ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ ê·€ë¬´ê°€ì„¤ ê¸°ê°
  - ê° ìš”ì¸ì€ ìŠ¹ê°ìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹¨

````python
from statsmodels.graphics.factorplots import interaction_plot
import matplotlib.pyplot as plt
## Seriesë¡œ ë³€ê²½
total = df["total"]
line = df["line"]
month = df["month"]
fig, ax = plt.subplots(figsize=(6, 6))
fig = interaction_plot(month,line, total,ms=10, ax=ax)
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/adp/problem/practice5/23.png?raw=true" width="600" height="500"></p>

ğŸ‘€ **êµí˜¸ì‘ìš© ì‹œê°í™”**

- interaction ê·¸ë˜í”„ì—ì„œ Monthì™€ Lineì— ë”°ë¼ ê·¸ë˜í”„ê°€ êµì°¨í•˜ì§€ ì•Šì•„ì•¼ êµí˜¸ì‘ìš©ì´ ì—†ëŠ” ê²ƒ
- ì‹œê°í™”ë¥¼ í†µí•´ êµì°¨(=êµí˜¸ì‘ìš©ì´ ìˆìŒ)ë¥¼ í™•ì¸í•¨



