## 네트워크 계층

### 1. IP

- 허브와 스위치로 연결되어 하나의 브로드캐스트 도메인에 있는 네트워크에선 MAC 주소만으로 통신할 수 있음 -> 너무많은 브로드캐스트 발생 -> 트래픽 증가
- 논리적인 주소인 IP 주소는 모든 호스트와 라우터에 할당됨
- IP주소는 32비트로 이루어짐
- 8비트마다 10진수로 표현함

### 2. IP 클래스

- 각 자리수 0~255까지 가능 -> 43억개
- 43억개의 IP를 관리하기 위해 클래스를 나눔
- 클래스 A
  - 32비트 중에서 가장 앞에 있는 비트가 0으로 시작하는 클래스 [0]0000000.00000000.00000000.00000000
  - 가장 앞의 8비트를 네트워크 주소로 사용 나머지는 호스트 주소로 사용 [00000000].00000000.00000000.00000000
  - 네트워크 주소에서 앞의 0은 고정이기에 0부터 127까지 128개의 네트워크를 구분할 수 있음
  - 나머지 호스트는 약 1600만개의 주소 할당 가능
  - 즉, 1600만개의 IP를 지정할 수 있는 네트워크가 128개 있다는 뜻
- 클래스 B
  - 32비트 중 가장 앞에 있는 비트가 10으로 시작하는 클래스 [10]000000.0000000.0000000.0000000
  - 가장 앞의 16비트를 네트워크 주소로 사용 나머지 16비트는 호스트 주소로 사용 [1000000.0000000].0000000.0000000
  - 14비트로 표현할 수 있는 네트워크 1만 6천개
  - 나머지 호스트는 약 6만개의 주소 할당 가능
- 클래스 C
  - 32비트 중 가장 앞에 있는 비트가 110으로 시작하는 클래스 [110]00000.0000000.0000000.0000000
  - 가장 앞의 24비트를 네트워크 주소로 사용 나머지 8비트는 호스트 [11000000.0000000.0000000].0000000
  - 21비트로 표현할 수 있는 네트워크는 200만개
  - 나머지 8비트는 호스트 256개 주소 할당 가능
- 클래스 D
  - 32비트 중 가장 앞에 있는 비트가 1110으로 시작하는 클래스 [1110]0000.0000000.0000000.0000000
  - 32비트 모두를 네트워크 주소로 사용
  - 호스트를 지정할 수 없어 멀티캐스트 용도로 사용됨
  - 일반 사용자의 IP로 할당되는 일이 없음

### 3. 서브넷 마스크

- IP 주소가 낭비되는 문제를 해결하기 위해서 서브넷 마스크 등장
- 클래스로 나뉘어서 낭비되는 공간을 다시 한번 나누는 것
- 즉, 서브넷 마스크는 네트워크부를 늘리는 방식임

예시

```
할당받은 클래스 B 네트워크: 10000010.00000101.00000000.00000000 -> 130.5.0.0/16
서브넷 마스크				   : 11111111.11111111.11111110.00000000 -> 255.255.254.0
```

- 512개의 IP 주소 할당 가능
- 호스트 컴퓨터에서 서브넷 마스크를 변경할 수 있음
- 그러나 기본 게이트웨이와 약속되지 않은 IP 주소와 서브넷 마스크를 이용하면 인터넷 사용이 어려움

### 4. 라우터

- 허브와 스위치를 이용하면 콜리전 도메인과 브로드캐스트 도메인으로 통신의 한계 발생
- 라우터를 이용해 브로드캐스트를 나누게 되며 이로인해 논리적인 주소인 IP가 필요해짐
- 라우터는 IP를 다루므로 네트워크 계층에 속함
- CPU와 메모리를 가지고 있는 컴퓨터임
- 우리나라에선 라우터를 공유기라고 부름
- 스위치로 나누어진 영역을 LAN 영역이라고 함
- LAN 영역을 넘어 통신하기 위해 라우터로 연결됨
- 라우터로 넘어간 다른 영역을 WAN 영역이라고 부름
- 통신사가 가지고 있는 라우터를 코어 라우터라고 함
- 코어 라우터끼리는 광케이블로 연결되며 이러한 시스템 전체를 백본이라고 부름
- 라우팅 프로토콜을 통해 목적지로 가는 빠른 길을 탐색

### 5. 라우팅 프로토콜

- 라우팅 테이블은 각 네트워크에서 이동할 때, 어떤 인터페이스(포트)로 이동해야 하는지 적혀있는 표
- 스태틱 라우팅: 사람이 직접 표를 구성
- 다이내믹 라우팅: 라우터끼리 정보를 공유해 표를 만듦
- 디폴트 라우트: 0.0.0.0으로 표기되며, 자신이 모르는 목적지 주소는 연결된 디폴트 라우터로 보내서 목적지까지 보낼 수 있음
- 라우터를 1번 이동하는 것을 홉이라고 부름
- IP 헤더에 TTL이라는 필드가 있고, 이 필드가 0이 되면 패킷은 파괴됨
- 홉마다 TTL이 줄어들어 목적지가 없는 데이터를 파기함
- 루프백 주소: localhost, 127.0.0.1
  - 네트워크로 나가지 않고 자신이 다시 받음

### 6. ICMP

- 네트워크에서 목적지까지 데이터가 도달할 수 있는지, 도달할 수 없다면 원인이 무엇인지 알아내기 위한 프로토콜
- 개발로 말하면 디버깅 도구
- Ping은 ICMP 메세지를 전달하는 도구

### 7. ARP

- 보통 다른 컴퓨터에 데이터를 전송할 때, IP만을 사용함
- 실제로 전송할 때는 데이터 링크 계층에서 MAC주소로 변경함
- 통신하려는 목적지 IP는 알아도 MAC은 모름 -> ARP가 해결함
- ARP: IP로 MAC 주소를 알아냄
- 출발지, 목적지 IP/ 출발지, 목적지 MAC, 이때 목적지 MAC은 브로드캐스팅을 위한 FF:FF:FF:FF
- 데이터가 스위치에 도착하면 브로드캐스팅임을 파악하고 수행
- 전달받은 컴퓨터에서는 목적지 IP가 자신의 것인지 판단하고 자신의 것이면 ARP 응답 메세지를 보냄
- 통신을 수행한 컴퓨터끼리는 ARP캐시에 IP와 MAC을 테이블로 가지게 됨
- 이후 통신은 MAC주소를 정확히 적어 보내게 됨
- 다른 네트워크일 경우에는 디폴트 라우터의 MAC주소를 적어서 보냄

### NAT, PAT

- NAT: private ip를 public ip로 변환 (부족한 IP를 private ip을 사용해 늘림)
- PAT: 트랜스포트 계층의 포트까지 이용해 매핑 테이블을 작성 (private -> public)
  - dynamic pat은 IP와 port를 자동으로 지정해주어 편함
  - 그러나 단방향이기에 port forwarding이 필요함










 



