### 📍 처음 방문한 사이트의 **SSL/TLS 인증 과정**  
SSL/TLS 인증은 클라이언트(브라우저)와 서버 간의 **암호화된 연결**을 설정하기 위해 수행됩니다. 이 과정은 **TLS 핸드셰이크**를 통해 이루어지며, 암호화 키를 교환하고 인증서를 검증합니다.

---

### 1. **클라이언트와 서버 간의 초기 연결**  
1. **클라이언트 요청 (Client Hello)**:
   - 클라이언트(예: 브라우저)가 HTTPS 사이트(`https://example.com`)에 접속.
   - 클라이언트는 서버에 다음 정보를 포함한 "Hello" 메시지를 보냄:
     - **지원 가능한 암호화 방식**(Cipher Suites): AES, RSA, ECC 등.
     - **TLS 버전**: TLS 1.2, TLS 1.3 등.
     - **난수(Random Number)**: 세션 키 생성을 위한 임의 데이터.
     - **SNI(Server Name Indication)**: 어떤 도메인에 대한 연결인지 명시.

---

### 2. **서버의 응답**  
2. **서버 응답 (Server Hello)**:
   - 서버는 클라이언트의 요청에 응답하며 다음 정보를 보냄:
     - 선택된 암호화 방식(Cipher Suite).
     - TLS 버전.
     - 서버의 **난수(Random Number)**.
   
3. **서버 인증서 전송**:
   - 서버는 **SSL/TLS 인증서**를 클라이언트로 전송.
   - 인증서에는 다음 정보가 포함됨:
     - 서버의 공개 키.
     - 인증서를 발급한 **인증 기관(CA)** 정보.
     - 인증서 유효 기간.
     - 인증서에 포함된 서버의 도메인 이름.
   - 서버는 선택적으로 **DH 또는 ECDH 파라미터**를 전송할 수도 있음(TLS 1.3).

---

### 3. **클라이언트가 서버 인증서를 검증**  
4. **클라이언트가 인증서 검증**:
   클라이언트는 받은 인증서를 검증:
   - **인증서의 유효성 확인**:
     - 인증서의 도메인이 요청한 도메인과 일치하는지 확인.
     - 인증서의 유효 기간 확인.
   - **인증 기관(CA) 신뢰성 확인**:
     - 클라이언트는 로컬에 저장된 신뢰할 수 있는 **루트 인증서 목록**과 인증 기관(CA)을 비교.
     - 인증서 체인(Chain of Trust)을 따라가며 CA가 신뢰할 수 있는지 검증.
   - **서명 검증**:
     - 인증서의 전자 서명이 유효한지 확인.

   ⚠️ 검증 실패 시: 클라이언트는 경고 메시지(예: "이 사이트의 인증서는 신뢰할 수 없습니다")를 표시하고 연결을 차단.

---

### 4. **세션 키 교환**  
5. **비밀 키 교환 (Key Exchange)**:
   클라이언트와 서버가 **세션 키**를 교환하기 위해 다음 작업 수행:
   - **TLS 1.2 이하 (RSA)**:
     - 서버의 공개 키를 사용하여 클라이언트가 생성한 **프리마스터 키(Premaster Secret)**를 암호화하여 서버에 전송.
     - 서버는 개인 키로 이를 복호화해 **프리마스터 키**를 얻음.
   - **TLS 1.2 이상 (DH/ECDH)**:
     - **Diffie-Hellman(DH)** 또는 **Elliptic Curve Diffie-Hellman(ECDH)** 알고리즘을 사용해 세션 키를 교환.
     - 서버와 클라이언트는 각자 계산을 통해 동일한 세션 키를 생성.

6. **세션 키 생성**:
   - 클라이언트와 서버는 양측 난수(Random Number)와 프리마스터 키를 기반으로 **대칭 키**를 생성.
   - 이 대칭 키는 이후의 데이터 암호화에 사용.

---

### 5. **암호화된 연결 설정**  
7. **클라이언트 Finished 메시지 전송**:
   - 클라이언트는 세션 키를 사용하여 **Finished 메시지**를 암호화하고 서버로 전송.
   - 이 메시지는 클라이언트 측 핸드셰이크가 완료되었음을 나타냄.

8. **서버 Finished 메시지 전송**:
   - 서버도 세션 키를 사용해 **Finished 메시지**를 암호화하여 클라이언트로 전송.
   - 서버 측 핸드셰이크가 완료되었음을 나타냄.

---

### 6. **암호화된 데이터 교환 시작**  
9. **애플리케이션 데이터 전송**:
   - 핸드셰이크가 완료되면 클라이언트와 서버는 생성된 대칭 키를 사용해 암호화된 데이터를 교환.
   - 이후의 통신은 암호화된 상태로 진행.

---

### 요약된 과정
1. 클라이언트가 서버에 `Client Hello` 전송 (지원 가능한 암호화 방식 포함).  
2. 서버가 `Server Hello`와 인증서를 클라이언트로 전송.  
3. 클라이언트가 인증서를 검증.  
4. 클라이언트와 서버가 세션 키를 교환.  
5. 핸드셰이크 완료 후 암호화된 통신 시작.

---

### 특징 및 최적화
- **TLS 1.3**:
  - 인증서 검증 및 세션 키 교환이 간소화.
  - 보안성 및 성능 향상.
  - RSA 기반 키 교환 제거, DH/ECDH 방식 사용.

- **재방문 시**:
  - 세션 재개(Session Resumption)로 핸드셰이크 과정을 일부 생략 가능.  
  - 클라이언트와 서버는 이전에 생성된 세션 키를 재사용.  

이 과정을 통해 HTTPS 연결은 클라이언트와 서버 간의 **보안성**과 **기밀성**을 보장합니다.







### 📍 **SSL/TLS 인증 과정이 TCP 3-Way Handshake 뒤에 진행되는 이유**

1. **TCP 3-Way Handshake**:  
   클라이언트와 서버는 신뢰할 수 있는 **물리적 연결**을 설정합니다. 이는 패킷이 손실되지 않고 순서대로 전달될 것을 보장하기 위한 기반입니다.

2. **SSL/TLS Handshake**:  
   TCP 연결이 설정된 이후, 보안 계층인 SSL/TLS가 활성화됩니다. 이 과정에서는:
   - 서버와 클라이언트 간의 **암호화 설정**을 협상합니다.
   - 서버의 **SSL/TLS 인증서**를 통해 신뢰성을 검증합니다.
   - 대칭 키를 교환하여 데이터 암호화를 시작합니다.

---

### **SSL/TLS Handshake 과정**

SSL/TLS Handshake는 주로 다음 단계로 구성됩니다:

1. **ClientHello (클라이언트 → 서버)**  
   - 클라이언트가 서버에 연결을 요청하며, 다음 정보를 보냅니다:
     - 지원하는 TLS/SSL 버전
     - 지원하는 암호화 알고리즘(Cipher Suites)
     - 난수(Random Number) (키 교환에 사용)

2. **ServerHello (서버 → 클라이언트)**  
   - 서버는 클라이언트의 요청에 응답하며, 다음 정보를 보냅니다:
     - 선택된 TLS/SSL 버전
     - 선택된 암호화 알고리즘
     - 난수(Random Number)

3. **Certificate (서버 → 클라이언트)**  
   - 서버는 자신의 인증서를 클라이언트에 보냅니다.
   - 클라이언트는 이 인증서를 신뢰할 수 있는 CA(Certificate Authority)가 발급한 것인지 확인합니다.

4. **Key Exchange (클라이언트 ↔ 서버)**  
   - 클라이언트와 서버는 세션 키(Session Key)를 안전하게 교환하거나 생성합니다.  
     (예: RSA, Diffie-Hellman, ECDH 등의 키 교환 방식 사용)

5. **Finished (클라이언트 ↔ 서버)**  
   - 양측은 세션 키를 기반으로 암호화된 데이터를 주고받으며, Handshake 과정을 종료합니다.

---

### **SSL/TLS Handshake가 TCP 3-Way Handshake 이후에 일어나는 이유**

1. **기반 연결 필요**:  
   SSL/TLS는 **TCP 연결 위에서 동작**하는 프로토콜입니다. TCP 연결이 먼저 설정되어야 암호화와 인증 과정을 수행할 수 있습니다.

2. **보안 설정 준비**:  
   TCP가 데이터를 신뢰할 수 있는 방식으로 전송할 수 있는 환경을 마련한 뒤, SSL/TLS가 데이터의 **기밀성(암호화)**과 **무결성(데이터 변경 방지)**을 추가합니다.

3. **독립적 계층 구조**:  
   TCP는 네트워크 계층(4계층)에서 동작하며, SSL/TLS는 애플리케이션 계층(7계층)에서 동작합니다. 이 계층 구조에 따라 TCP가 먼저 동작하고, SSL/TLS가 그 위에서 보안을 제공합니다.

---

### **요약**

- **TCP 3-Way Handshake**: 먼저 클라이언트와 서버가 기본 연결을 설정합니다.
- **SSL/TLS Handshake**: TCP 연결 이후에 보안 인증과 암호화가 설정됩니다.
  - HTTPS와 같은 보안 프로토콜에서 암호화된 데이터 전송이 가능하게 됩니다.

따라서, SSL 인증은 TCP 3-Way Handshake 이후에 이루어지는 과정입니다.