## 6. DRF

### 6.0 Install

```
poetry add djangoresetframework
```

**settings.py**

```python
THIRD_PARTY_APPS = [
    "rest_framework",
]

INSTALLED_APPS = SYSTEM_APPS + THIRD_PARTY_APPS + CUSTOM_APPS
```

### 6.1 api_view

- *6.3 APIViewë¥¼ ìƒì†ë°›ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½ë¨*
- decoratorë¡œ ì ìš©
- web ui í™”ë©´ì„ ë§Œë“¤ì–´ ì¤Œ
- decoratorì˜ ì¸ìë¡œ Http Protocol ì „ë‹¬ (GET, POST, PUT, DELETE, ..)

### 6.2 Serializer(legacy)

- *6.4 ModelSerializerë¡œ ë³€ê²½ë¨*
- `two way door`: ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ì¥ê³  ëª¨ë¸ë¡œ ë°”ê¾¸ê±°ë‚˜ ì¥ê³  ëª¨ë¸ì„ ì‚¬ìš©ìì˜ ë°ì´í„°ë¡œ ë°”ê¿ˆ
  - Case1. django object -> json
    - CategorySerializerì— objectë¥¼ ë„˜ê¹€
  - Case2. json -> django object
    - CategorySerializerì— objectë¥¼ ë„˜ê¹€

- postì‹œì— serializerì— ì •ì˜í•œ í•­ëª©ë“¤ì„ ê²€ì¦í•¨ -> `is_valid()`
  - ê²€ì¦í•˜ì§€ ì•Šì„ í•­ëª©ì€ `read_only=True`
  - ì¦‰, `read_only`ëŠ” ìœ ì €ê°€ ë³´ë‚´ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì¤Œ
- `save` í•¨ìˆ˜
  - serializer ë‚´ì˜ `create` í•¨ìˆ˜ë¥¼ ì°¾ì•„ë´„

- `update`
  - `partial`: serializerê°€ ë°›ì§€ ëª»í•œ ë°ì´í„°ëŠ” ì›ë˜ object ì •ë³´ë¡œ ìœ ì§€í•¨


### 6.3 APIView

- *6.5 ModelViewSetìœ¼ë¡œ ë³€ê²½ë¨*

**url settings**

[urls.py]

```python
from django.urls import path
from . import views

urlpatterns = [
  path("", views.Function.as_view()),
]
```

- as_view ì‚¬ìš©

**case1. GET, POST**

```python
class Function(APIView):
  
  def get(self, request):
    objects = Model.objects.all()
    serializer = ModelSerializer(objects, many=True)
    return Response(serializer.data)
  
  def post(self, request):
    serializer = ModelSerializer(data=request.data)
    if serializer.is_valid():
      new_data = serializer.save()
    	return Response(ModelSerializer(new_data).data,)
  	# is_valid error
    	return Response(serializer.error)
```

**case2. GET, POST, DELETE**

```python
class Function(APIView):
  def get_object(self, pk):
    try:
      return Model.objects.get(pk=pk)
    except Model.DoesNotExist:
      raise NotFound

	def get(self, request, pk):
    serializer = ModelSerializer(self.get_object(pk))
    return Response(serializer.data)
  
  def put(self, request, pk):
    serializer = ModelSerializer(
    	self.get_object(pk),
      data = request.data,
      partial=True
    )
    if serializer.is_valid():
      update_data = serializer.save()
      return Response(
        Modelserializer(update_data).data,
      )
    else:
      return Response(serializer.errors)

	def delete(self, request, pk):
    self.get_object(pk).delete()
    return Response(status=HTTP_204_NO_CONTENT)
```

### 6.4 ModelSerializer

- serializerì™€ ë™ì¼í•˜ë‚˜ defaultë¡œ createì™€ updateê°€ ìˆìŒ
- meta classë¡œ ì„¤ì •

```python
from rest_framework import serializers
from .models import Model

class ModelSerializer(serializers.ModelSerializer):
  class Meta:
    model = Model
    exclude
    fields = ("name", "kind")
```

- fields = "\_\_all\_\_"
  - ëª¨ë“  field ë…¸ì¶œ
- exclude
  - ëª‡ ì»¬ëŸ¼ì„ ì œì™¸

ğŸ“Œ **validation method1**

- serializerì—ì„œ validationì€ PK ë° í•„ìˆ˜í‚¤ë¥¼ í¬í•¨í•œ fieldsì— ìˆëŠ” ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜í–‰í•¨
- modelì— blank, nullì´ trueì—¬ë„ serailizerë‚´ì— ì¬ì •ì˜ í•˜ê³ , fieldsì— í¬í•¨í•œë‹¤ë©´ ê²€ì¦ ìˆ˜í–‰

ğŸ“Œ **validation method2**

- `validate_`ë¥¼ ë¶™ì¸ í•¨ìˆ˜ë¥¼ í†µí•´ íŠ¹ì • fieldì˜ validateìš© methodë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ
- `validate` methodë¥¼ í†µí•´ ì „ì²´ fieldì˜ ê²€ì¦ í•  ìˆ˜ ìˆìŒ

### 6.5 ModelViewSet

- ë„ˆë¬´ ë§ˆë²•ê°™ì•„ì„œ ì§€ì–‘?

**1. url settings**

```python
urlpatterns = [
  path("", views.ModelViewSet.as_view({
    'get': 'list', # ì „ì²´ ê²€ìƒ‰
    'post': 'create',
  })),
  path("<int:pk>", # ê°œë³„ ì‘ì—…ì— ëŒ€í•´ì„œëŠ” pkê°€ í•„ìš”í•¨
       views.ModelViewSet.as_view({
    'get':'retrieve', # í•œê°œ ê²€ìƒ‰
    'put': 'partial_update',
    'delete': 'destroy',
  }))
]
```

**2. views**

```python
class ModelViewSet(ModelViewSet):
  
  serializer_class = ModelSerializer
  queryset = Model.objects.all()
```

