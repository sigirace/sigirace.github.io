## 8. Auth

### 8.1 Custom Authentication

ðŸ“’**settings.py**

```python
REST_FRAMEWORK = {
  'DEFAULT_AUTHENTICATION_CLASSES': [
    "config.authentication.TrustMeBroAuthentication",
  ]
}
```

- `DEFAULT_AUTHENTICATION_CLASSES`: rest frameworkê°€ userë¥¼ ì°¾ëŠ” ë°©ë²•ì´ ìžˆëŠ” list
  - `rest_framework.authentication.SessionAuthentication` (default): ì„¸ì…˜ ë² ì´ìŠ¤

ðŸ“’ **config/permissions.py**

```python
from rest_framework.authentication import BaseAuthentication
from rest_framework.exceptions import AuthenticationFailed

from users.models import User


class TrustMeBroAuthentication(BaseAuthentication):
    def authenticate(self, request):
        username = request.headers.get("Trust-Me")
        if username is None:
            return None
        try:
            user = User.objects.get(username=username)
            return (user, None)
        except User.DoesNotExist:
            raise AuthenticationFailed(f"No user {username}")
```

- auth classëŠ” ë¬´ì—‡ì´ë“  ë  ìˆ˜ ìžˆìœ¼ë©° ë§ˆì§€ë§‰ì— `user`ë§Œ ë°˜í™˜í•˜ë©´ ë¨
- auth classê°€ ë°˜í™˜í•˜ëŠ” userê°€ viewsì—ì„œ ë°›ê²Œ ë˜ëŠ” user
- ëª¨ë“  auth classëŠ” `BaseAuthentication`ë¥¼ ìƒì†í•´ì•¼í•¨
- `authenticate`ë¥¼ override í•´ì•¼í•¨
- `request`ì—ëŠ” userê°€ ë“¤ì–´ìžˆì§€ ì•ŠìŒ
  - header ë°ì´í„°ë¥¼ ë³´ê³  userë¥¼ ì°¾ì•„ ë‚´ëŠ” ê²ƒì€ ê°œë°œìžì˜ ëª«
  - `user`ë¥¼ ì°¾ì§€ ëª»í•˜ë©´ None ë°˜í™˜
- `(user, None)`ì„ ë°˜í™˜í•˜ëŠ” ê²ƒì€ ê·œì¹™



### 8.2 Token Authentication

ðŸ“’**settings.py**

```python
THIRD_PARTY_APPS = [
    "rest_framework",
  	"rest_framework.authtoken",
]

REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": [
        "rest_framework.authentication.TokenAuthentication",
    ],
}
```

- `migration` ìˆ˜í–‰ í•„ìš”
- `admin pannel`ì— token ì¶”ê°€ í™”ë©´ ìƒì„±

ðŸ“’**users/urls.py**

```python
from rest_framework.authtoken.views import obtain_auth_token

urlpatterns = [
  path("token-login", obtain_auth_token),
]
```

- `obtain_auth_token`: usernameê³¼ passwordë¥¼ ë³´ë‚´ë©´ token ë°˜í™˜ (post)
- ì–‘ë°©í–¥ ì‹œìŠ¤í…œ
  - ìœ ì €ì—ê²Œ tokenì„ ë°œê¸‰
  - tokenì„ DBì— ì €ìž¥ -> DB ìš©ëŸ‰ ì°¨ì§€
- Rule
  - Header: Authorization
  - Value: Token "token"













