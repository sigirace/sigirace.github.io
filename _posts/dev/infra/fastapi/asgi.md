[출처](https://m.blog.naver.com/pjt3591oo/222772705407)



## 1. 들어가면서

- fastapi, uvicorn을 공부하면서 ASGI인 uvicorn 때문에 비동기 처리가 가능하다는 점
- 파이썬은 race condition 문제가 발생하는 것을 방지하기 위해 GIL을 이용
- 비동기적인 특성을 구현하기 위해선 다수의 쓰레드를 활용해야 하는데 uvicorn은 비동기를 위해 멀티 프로세싱 방식을 이용
- 프로세스를 생성하는 방식은 fork, exec, spawn이 있습니다. 파이썬에서는 운영체제에 따라 multiprocessing에서 프로세스를 생성하는 기본방법을 가짐
- spawn 보단 fork가 조금 더 빠르다고 함



## 1. Web Server

> 인터넷을 통해 사용자가 보낸 요청을 받아 그에 맞는 콘텐츠를 제공하는 중간 전달자

- **웹서버는 브라우저의 HTTP 요청을 받아 정적 콘텐츠를 제공하고, 동적 처리 요청은 앱 서버(예: FastAPI)에게 연결해주는 프론트 매니저 역할** 수행



### 🖼️ 비유 시나리오

1. 👩 손님이 번화가, **인터넷 브라우저**에 나와서 식당, **웹 어플리케이션**에 들어옴
   - 만약 이상한 손님이라면 종업원이 들어오지 못하게 막을 수도 있음 
2. 손님은 종업원, **웹서버**에게 무언가를 주문, **요청**함
   - 이때 요청하는 방식은 HTTP Request method (GET/POST/PUT/DELETE)
3. 요청의 종류는 두가지
   - 이미 만들어져 있는 것들 (메뉴판, 명함 등) 👉 정적
   - 새롭게 만들어야 하는 것들 (음식) 👉 동적
4. 🧾 종업원, **웹서버**가 요청을 확인
   - 요청이 메뉴판과 같이 **정적**이면 빠르게 제공
   - 요청이 요리와 같은 **동적 처리**가 필요하면 요리사에게 요청을 전달해야함
5. 종업원, **웹서버**가 주문서 작성
   - 웹서버는 요리사, **애플리케이션 서버**에게 요청을 전달하기 위해 표준화된 주문서 작성
   - 요리사는 주문서를 보고 요리를 한 후 다시 종업원에게 전달
6. 종업원은 손님의 정적/동적 요청에 대한 응답
   - 이때 응답하는 방식은 HTTP Response





### Web Server가 필요한 이유

> 단순한 정적 파일 제공자를 넘어서, **트래픽의 분기 처리, 보안 강화, 성능 최적화, 백엔드 보호** 등 다양한 핵심 역할을 수행하는 중심 컴포넌트

1. 정적 파일을 빠르게 제공하기 위해  
   - 웹서버는 C 언어 기반의 고성능 네트워크 서버로, **CPU 자원을 적게 쓰면서 수천 개의 연결을 동시에 처리**할 수 있음
   - `sendfile`, `GZIP 압축`, `브라우저 캐시`, `keep-alive 연결` 등  **정적 콘텐츠 제공에 특화된 최적화 기능**이 내장되어 있음

2. **리버스 프록시 역할 수행**  
   - 웹서버는 단순한 파일 제공자에 그치지 않고, **애플리케이션 서버 앞단에 위치한 리버스 프록시**로서 요청을 중계하는 기능도 수행
   - 외부 클라이언트는 애플리케이션 서버와 직접 통신하지 않기 때문에 **보안적으로 보호되고**, 내부 구조가 외부에 노출되지 않음
   - 애플리케이션 서버가 여러 개일 경우, 웹서버는 **로드밸런서로서 요청을 분산**시킴
     - (예: `/api/`는 FastAPI 서버로, `/static/`은 정적 폴더로)

3. **보안 및 접근 제어**
   - 웹서버는 인증서 적용(HTTPS), IP 제한, Rate Limiting, 헤더 검사 등 **트래픽 진입단에서의 보안 정책을 전담**할 수 있음
   - 이는 애플리케이션 코드에 넣기보다는, **웹서버가 앞단에서 처리하는 것이 훨씬 효율적**





## 2. Gateway Interface

> 웹서버(예: Nginx, Apache)가 **우리가 만든 동적 프로그램(예: Python 코드)**에 요청을 전달하고, 그 결과를 다시 받아오는 **중간 연결 규칙(표준)**



### 1. CGI

> 요청이 올 때마다 새롭게 프로그램을 실행(=프로세스 생성)해서 결과를 받아오는 방식

**🖼️ CGI 비유: 주문 즉시 요리사를 새로 고용하는 식당**

1. 👩 손님이 식당에 와서 음식(동적 페이지)을 주문함
2. 👔 종업원(웹서버)은  외부 요리사(우리의 Python 프로그램)를 **즉시 새로 고용함**
3. 🧑‍🍳 새로 고용된 요리사는 요리를 완성한 후 바로 떠남 (프로세스 종료)
4. 🍽️ 종업원은 완성된 요리를 손님에게 전달

**✅ 비유 정리 문장**

CGI는 마치 손님이 올 때마다 요리사를 새로 고용해서 한 번 요리하고 바로 해고하는 식당 구조입니다. 덕분에 다양한 요리를 만들 수 있지만, 손님이 많아지면 요리사 고용비로 망할 수도 있습니다. 원하시면 CGI 이후 발전된 **WSGI, ASGI**를 각각 이 비유를 이어서 확장하는 식으로 설명해드릴 수 있어요.



### 2. WSGI



