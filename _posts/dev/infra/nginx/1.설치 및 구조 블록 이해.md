

ğŸ‘¨â€ğŸ’» [ê°•ì˜](https://www.youtube.com/watch?v=hYZ-dkz1Qrc&list=PLRUS1nW-Cfnffl6oa8u1jzgiOyeTY_cCA&index=3)

## 1. ì„¤ì¹˜

```
apt update
apt install sudo systemctl nginx -y

sudo nginx
ps -ef | grep nginx
sudo nginx -s stop

sudo systemctl start nginx
sudo systemctl status nginx
sudo systemctl stop nginx
```

## 2. ì„¤ì • íŒŒì¼

```
/etc/nginx/nginx.conf

# ë§Œì•½ ì—†ìœ¼ë©´
/usr/local/nginx/conf/nginx.conf
/usr/local/etc/nginx/nginx.conf
```

ğŸ“ **Directives**

- nginxë¥¼ êµ¬ë™í•˜ëŠ” ì§€ì‹œì–´
- nginxì˜ ëª¨ë“  ë™ì‘ì€ ì„¤ì •íŒŒì¼(.conf)ì— ì‘ì„±ëœ directiveë¥¼ í†µí•´ ìˆ˜í–‰
- simple directive: ì´ë¦„ ê°’ ì„¸ë¯¸ì½œë¡ (;) í˜•íƒœ

```
worker_process 1;
```

- block directive: simple directive ê°’ ë¶€ë¶„ì„ ì¤‘ê´„í˜¸ë¡œ ê°ì‹¸ì„œ ê·¸ ì•ˆì— directive ë˜ëŠ” block í¬í•¨
  - block ì•ˆì— ì—¬ëŸ¬ directive í¬í•¨

```
events {
        worker_connections 768;
        # multi_accept on;
}
```

ğŸ“ **Blockì˜ ì¢…ë¥˜**

- http block: HTTP ë¶€ë¶„ê³¼ ê´€ë ¨ëœ ëª¨ë“ˆì˜ ì§€ì‹œì–´ì™€ ë¸”ë¡ ì •ì˜, serverì™€ location ë£¨íŠ¸ ë¸”ë¡

```
http {

        ##
        # Basic Settings
        ##

        sendfile on;
        tcp_nopush on;
        types_hash_max_size 2048;
        # server_tokens off;
        ...
}        
```

- server block: í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸(ì›¹ì‚¬ì´íŠ¸)ë¥¼ ì„ ì–¸ì— ì‚¬ìš©, http ë¸”ë¡ ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
  - server ë¸”ë¡ì—ëŠ” í•œ ê°œ ì´ìƒì˜ location ë¸”ë¡ì„ ì„ ì–¸ ê°€ëŠ¥
- location block: íŠ¹ì • URLì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì •ì˜
  - url ìš”ì²­ì— ë”°ë¼ ì ‘ê·¼ì„ ë‹¤ë¥´ê²Œí•˜ì—¬ ì„œë¹„ìŠ¤
- event block: ë„¤íŠ¸ì›Œí¬ì˜ ì‘ë™ í™˜ê²½ì„ ì„¤ì •

ğŸ“ **HTTP í•µì‹¬ ëª¨ë“ˆ**

> ì›¹ ê´€ë ¨ ì „ì²´ êµ¬ì„±ì„ ì§€ì •

- HTTP ì„œë²„ì˜ ëª¨ë“  ë¸”ë¡, ì§€ì‹œì–´, ë³€ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” êµ¬ì„± ìš”ì†Œ
- HTTP ëª¨ë“ˆì„ ì„¤ì •ì—ì„œ ì œê±°í•˜ë©´ ì„œë²„ê°€ ì „í˜€ ì‘ë™í•˜ì§€ ì•ŠìŒ
- ì„œë²„ë¥¼ ì„¤ì •í•˜ê³  ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒì€ HTTP ëª¨ë“ˆì„ ì„¤ì •í•˜ê³  ê´€ë¦¬í•œë‹¤ëŠ” ì˜ë¯¸
- http, server, location ë¸”ë¡ 3ê°œë¡œ ë‚˜ëˆ„ì–´ì§

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/nginx/conf_archi.png?raw=true" width="300" height="400"></p>

- ê° ì„œë²„ì—ëŠ” ë¡œì¼€ì´ì…˜ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ
- server ì˜ì—­ì„ ë”°ë¡œ íŒŒì¼ë¡œ ì§€ì •í•´ ë†“ì€ ë‹¤ìŒ includeë¡œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš© ê°€ëŠ¥

```
root@a2702ca443b7:/etc/nginx/sites-enabled# ll
total 8
drwxr-xr-x 2 root root 4096 Sep 20 05:36 ./
drwxr-xr-x 8 root root 4096 Sep 23 08:28 ../
lrwxrwxrwx 1 root root   34 Sep 20 05:36 default -> /etc/nginx/sites-available/default
```

- include /etc/nginx/sites-enabled/
  - ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì§€ì •ëœ í•˜ë‚˜ì˜ íŒŒì¼
- include /etc/nginx/sites-available/
  - ì›¹ ì‚¬ì´íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” íŒŒì¼ì„ ë‘ 
  - ì‹¬ë³¼ë¦­ ë§í¬ë¡œ sites-enabledì— íŒŒì¼ì„ ì§€ì •í•¨
  - íŒŒì¼ ìŠ¤ì™‘ì„ í†µí•´ ì›¹ì‚¬ì´íŠ¸ ì„¤ì •ì„ ë³€ê²½

> /etc/nginx/sites-enabled/defaultëŠ” /etc/nginx/sites-available/default íŒŒì¼ì˜ **ì‹¬ë³¼ë¦­ ë§í¬**ë¡œ, Nginxê°€ ì´ íŒŒì¼ì„ í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ì„¤ì •ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. Nginxì—ì„œ í™œì„±í™”ëœ ì‚¬ì´íŠ¸ ì„¤ì •ì„ ê´€ë¦¬í•  ë•Œ, sites-available ë””ë ‰í„°ë¦¬ì— ìˆëŠ” ì„¤ì • íŒŒì¼ë“¤ì„ sites-enabled ë””ë ‰í„°ë¦¬ë¡œ ë§í¬í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;
        root /var/www/html;
        index index.html index.htm index.nginx-debian.html;
        server_name _;
        location / {
                try_files $uri $uri/ =404;
        }
}
```

- listen: nginxê°€ IPv4 ë° IPv6ì˜ í¬íŠ¸ 80ì—ì„œ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •, HTTP ìš”ì²­ì„ ì²˜ë¦¬í•  ê¸°ë³¸ ì„œë²„ë¡œ ì„¤ì •ë¨
- root: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì„¤ì •, nginxê°€ ì •ì  íŒŒì¼ì„ ì œê³µí•  ë””ë ‰í† ë¦¬, ì›¹ ì„œë²„ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì‚¬ìš©ë¨
- index: ìš”ì²­ëœ urlì— ëª…ì‹œëœ íŒŒì¼ì´ ì—†ì„ ë•Œ ì„œë²„ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•  ì¸ë±ìŠ¤ íŒ¡ë¦¬ ì„¤ì •

ğŸŒˆ **ì˜ˆì‹œ**

- http://server_name:port/uri ë¡œ ìš”ì²­ ë³´ëƒ„
  - server_nameì´ _ì¸ ê²½ìš° í•´ë‹¹ ì„œë²„ ipë¡œ ìš”ì²­

- nginxëŠ” root (/var/www/html) ì— uriì˜ íŒŒì¼ í˜¹ì€ í´ë”ê°€ ìˆëŠ”ì§€ ì°¾ì•„ë´„

ğŸ“ **Process**

1. client(browser)ì—ì„œ http ìš”ì²­ì„ ë³´ëƒ„
2. nginx(ws)ê°€ ë°›ìŒ
   1. nginx.conf
   2. include /etc/nginx/sites-enabled/default
   3. soft link /etc/nginx/sites-available/default
   4. server block
   5. root /var/www/html/[file_name].html
3. clientì— response
