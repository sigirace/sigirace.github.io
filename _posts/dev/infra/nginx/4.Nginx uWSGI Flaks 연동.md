ğŸ‘¨â€ğŸ’» [ê°•ì˜](https://www.youtube.com/watch?v=-f69yaiRx5E&list=PLRUS1nW-Cfnffl6oa8u1jzgiOyeTY_cCA&index=6)

## 6. Nginx uWSGI Flask ì—°ë™ Toy Project

ğŸ“Œ **Nginx Flask êµ¬ì¡°**

Flaskë¥¼ ê°œë°œìš© WAS(ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„)ë¡œ ì‚¬ìš©í•˜ì—¬ Nginxì™€ ì§ì ‘ ì—°ê²°í•˜ëŠ” ê²ƒì€ ê°œë°œ í™˜ê²½ì—ì„œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë°”ëŒì§í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. **Flaskì˜ ì„±ëŠ¥ ì œí•œ**: Flaskì˜ ë‚´ì¥ ì„œë²„ëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ëŠ” ê°œë°œìš© ì„œë²„ì´ê¸° ë•Œë¬¸ì— ê³ ë¶€í•˜ ìƒí™©ì—ì„œ ë³‘ë ¬ ì²˜ë¦¬ì— ì œí•œì´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìš´ì˜ í™˜ê²½ì— ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ ì €í•˜ì™€ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. **ì•ˆì •ì„±**: Flaskì˜ ë‚´ì¥ ì„œë²„ëŠ” ê°œë°œì— ì´ˆì ì´ ë§ì¶°ì ¸ ìˆì–´, ë‹¤ì–‘í•œ ì˜ˆì™¸ ìƒí™©ì— ëŒ€í•œ ì²˜ë¦¬ê°€ ë¯¸í¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì„œë²„ê°€ ê°‘ì‘ìŠ¤ëŸ½ê²Œ ì¢…ë£Œë˜ê±°ë‚˜ ë‹¤ìš´íƒ€ì„ì´ ê¸¸ì–´ì§ˆ ê°€ëŠ¥ì„±ì„ ë†’ì…ë‹ˆë‹¤.

3. **ë³´ì•ˆ**: Flask ìì²´ë¡œëŠ” ë³´ì•ˆì— ëŒ€í•œ ê°•í™”ëœ ê¸°ëŠ¥ì´ ë¶€ì¡±í•˜ë©°, ê³µê²©ì— ë…¸ì¶œë˜ê¸° ì‰½ìŠµë‹ˆë‹¤. Flask ë‚´ì¥ ì„œë²„ëŠ” HTTPS, ì¸ì¦, TLS ì„¤ì • ë“±ì˜ ì¤‘ìš”í•œ ê¸°ëŠ¥ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë³´ì•ˆì ì¸ ì¸¡ë©´ì—ì„œ ì·¨ì•½í•©ë‹ˆë‹¤.

4. **ë¯¸ë“¤ì›¨ì–´(ì˜ˆ: Gunicorn, uWSGI)ì˜ ì—­í• **:
   - **ë¶€í•˜ ë¶„ì‚°**: ë¯¸ë“¤ì›¨ì–´ëŠ” ì—¬ëŸ¬ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ì›Œ ë‹¤ì¤‘ ìš”ì²­ì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ ì¤ë‹ˆë‹¤. FlaskëŠ” ë‚´ì¥ ì„œë²„ë¡œëŠ” ì´ëŸ¬í•œ ë³‘ë ¬ ì²˜ë¦¬ ì§€ì›ì´ ì–´ë µìŠµë‹ˆë‹¤.
   - **ì•ˆì •ì„± ë° ê´€ë¦¬ ê¸°ëŠ¥**: ë¯¸ë“¤ì›¨ì–´ëŠ” ìš”ì²­ í ê´€ë¦¬, ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ê°ì‹œ, ìë™ ì¬ì‹œì‘, ë¡œê¹… ë“±ì„ í†µí•´ ì„œë²„ì˜ ì•ˆì •ì„±ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.
   - **ë³´ì•ˆ ê°•í™”**: ë¯¸ë“¤ì›¨ì–´ëŠ” HTTPSë‚˜ TLS ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•˜ê±°ë‚˜ ì´ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.
   

ë”°ë¼ì„œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” Nginxê°€ ìš”ì²­ì„ ë¯¸ë“¤ì›¨ì–´ (ì˜ˆ: Gunicorn)ë¡œ ë³´ë‚´ê³ , ë¯¸ë“¤ì›¨ì–´ê°€ Flask ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í†µì‹ í•˜ë„ë¡ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥, ì•ˆì •ì„±, ë³´ì•ˆì„ ëª¨ë‘ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ğŸ“Œ **ë¯¸ë“¤ì›¨ì–´ ì—†ì–´ë„ flaskê°€ nginxì™€ í†µì‹ í•˜ëŠ” ì´ìœ **

Nginxì™€ Flask ê°„ì˜ í†µì‹ ì´ **WSGI ì„œë²„ ì—†ì´ë„ ê°€ëŠ¥**í•œ ì´ìœ ëŠ” Flaskê°€ ìì²´ì ìœ¼ë¡œ **ê°œë°œìš© ì„œë²„**ë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. Flaskë¥¼ ì‹¤í–‰í•  ë•Œ ë‚´ì¥ëœ ì´ ì„œë²„ëŠ” ê°„ë‹¨í•œ ì›¹ ì„œë²„ ì—­í• ì„ í•˜ë©°, ê°œë°œ í™˜ê²½ì—ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Flaskì˜ ë‚´ì¥ ì„œë²„

FlaskëŠ” **Werkzeug**ë¼ëŠ” WSGI ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì‘í•©ë‹ˆë‹¤. Flask ìì²´ëŠ” WSGI ì• í”Œë¦¬ì¼€ì´ì…˜ì´ì§€ë§Œ, **ê°œë°œ í¸ì˜ì„±**ì„ ìœ„í•´ ê°„ë‹¨í•œ ì›¹ ì„œë²„ë¥¼ ë‚´ì¥í•˜ê³  ìˆì–´ WSGI ì„œë²„ ì—†ì´ë„ ë™ì‘í•  ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì„œë²„ëŠ” ê°œë°œ ì¤‘ì— ì‚¬ìš©í•˜ê¸°ì— ì í•©í•˜ë©°, ì„±ëŠ¥ê³¼ ë³´ì•ˆ ë©´ì—ì„œëŠ” **í”„ë¡œë•ì…˜ í™˜ê²½ì— ì í•©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ** ì£¼ë¡œ í…ŒìŠ¤íŠ¸ë‚˜ ê°œë°œ ë‹¨ê³„ì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

### í†µì‹ ì´ ê°€ëŠ¥í•œ ì´ìœ 
1. **Flaskì˜ ë‚´ì¥ ê°œë°œ ì„œë²„**:
   - FlaskëŠ” ë‚´ì¥ëœ ê°œë°œìš© ì„œë²„ë¥¼ ì œê³µí•˜ë©°, ì´ ì„œë²„ëŠ” WSGI í‘œì¤€ì„ ì¤€ìˆ˜í•˜ë©´ì„œë„ ìì²´ì ìœ¼ë¡œ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - Flask ì•±ì„ ì‹¤í–‰í•˜ë©´ ì´ ë‚´ì¥ ì„œë²„ê°€ ì‹œì‘ë˜ì–´ Nginx ì—†ì´ë„ ì§ì ‘ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - ì´ ì„œë²„ëŠ” `run()` ë©”ì„œë“œë¡œ ê°„ë‹¨í•˜ê²Œ ì‹œì‘ë©ë‹ˆë‹¤:
     ```python
     from flask import Flask
     
     app = Flask(__name__)
     
     @app.route('/')
     def home():
         return "Hello, Flask!"
     
     if __name__ == '__main__':
         app.run(debug=True)  # Flaskì˜ ë‚´ì¥ ì„œë²„ê°€ ì‹¤í–‰ë¨
     ```

2. **Nginxê°€ Flaskì˜ ë‚´ì¥ ì„œë²„ì™€ í†µì‹ **:
   - NginxëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ë™ì‘í•  ìˆ˜ ìˆìœ¼ë©°, Flaskì˜ ë‚´ì¥ ì„œë²„ì™€ ì§ì ‘ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° NginxëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ì•„ Flaskì˜ ë‚´ì¥ ì„œë²„ë¡œ ì „ë‹¬í•˜ê³ , ì‘ë‹µì„ ë‹¤ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
   - Flaskì˜ ë‚´ì¥ ì„œë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `http://127.0.0.1:5000`ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ, NginxëŠ” ì´ ì£¼ì†Œë¡œ ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
   
   Nginx ì„¤ì • ì˜ˆì‹œ:
   ```nginx
   server {
       listen 80;
       server_name your_domain.com;
   
       location / {
           proxy_pass http://127.0.0.1:5000;  # Flaskì˜ ë‚´ì¥ ì„œë²„ë¡œ í”„ë¡ì‹œ
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

### Flask ë‚´ì¥ ì„œë²„ì˜ í•œê³„
- **ì„±ëŠ¥**: Flaskì˜ ë‚´ì¥ ì„œë²„ëŠ” ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ì— ìµœì í™”ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì´ë‚˜ ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **ë³´ì•ˆ**: ë‚´ì¥ ì„œë²„ëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í•„ìš”í•œ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë©°, ì ì¬ì ì¸ ì·¨ì•½ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **í”„ë¡œë•ì…˜ í™˜ê²½**: Flaskì˜ ë¬¸ì„œì—ì„œë„ ë‚´ì¥ ì„œë²„ë¥¼ **í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ë¼**ê³  ê¶Œê³ í•˜ê³  ìˆìœ¼ë©°, Gunicorn ê°™ì€ WSGI ì„œë²„ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì œì•ˆí•˜ê³  ìˆìŠµë‹ˆë‹¤.

### ê²°ë¡ :
**Flaskì˜ ë‚´ì¥ ê°œë°œ ì„œë²„** ë•ë¶„ì— Nginxì™€ FlaskëŠ” **WSGI ì„œë²„ ì—†ì´ë„ í†µì‹ **í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì„œë²„ëŠ” ê°œë°œ ë° í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ë§Œë“¤ì–´ì¡Œìœ¼ë©°, ì„±ëŠ¥ê³¼ ë³´ì•ˆì´ ì¤‘ìš”í•œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” **Gunicorn**ì´ë‚˜ **uWSGI** ê°™ì€ **ì „ë¬¸ WSGI ì„œë²„**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ğŸ“Œ **ë™ì  í˜ì´ì§€ë¥¼ ì™„ë²½í•˜ê²Œ ì²˜ë¦¬í•˜ë ¤ë©´?**

- ì„œë²„ë¡œ ë™ì  í˜ì´ì§€ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ê²½ìš° ì„œë²„ì—ì„œ ì‘ì—…í•  íŒŒì´ì¬ í”„ë¡œê·¸ë¨ í˜¸ì¶œì´ í•„ìš”
- ì¼ë°˜ì ìœ¼ë¡œ nginxëŠ” ì–´ë–¤ programming ì–¸ì–´ë¥¼ ê°€ì§„ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¬ì§€ ëª¨ë¦„
- ë”°ë¼ì„œ íŒŒì´ì¬ì´ ì„œë²„ë¼ë©´ WSGI ì„œë²„ë¥¼ í†µí•´ í”„ë¡œê·¸ë¨ì„ í˜¸ì¶œí•´ì•¼í•¨
- WSGI: Web Server Gateway Interface

### 1. uwsgi ì„¤ì¹˜

```
pip install uswgi
sudo apt update
sudo apt install uwsgi-plugin-python3 -y
```

### 2. uwsgi ì‹¤í–‰

```
uwsgi --option
```

- ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì„¤ì • íŒŒì¼(~.ini)ì„ ì‘ì„±í•˜ì—¬ ê´€ë¦¬

```
[uwsgi]

```

### 3. uwsgi ë¡œê¹…

```
uwsgi --option --logto [path] 
```

### 4. uWSGI í…ŒìŠ¤íŠ¸

```
uwsgi --http-socket 0.0.0.0:3031 --wsgi-file toy_flask_app.py --callable app --processes 4 --threads 2
```

í•´ë‹¹ `uwsgi` ëª…ë ¹ì–´ëŠ” Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ `uWSGI`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¥¼ ì„¤ì •í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. ê° ì˜µì…˜ì˜ ì˜ë¯¸ë¥¼ ì•„ë˜ì— ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

### ëª…ë ¹ì–´ ì „ì²´
```bash
uwsgi --http-socket 0.0.0.0:3031 --wsgi-file toy_flask_app.py --callable app --processes 4 --threads 2
```

1. **`uwsgi`**: uWSGIëŠ” íŒŒì´ì¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê³ ì„±ëŠ¥ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì…ë‹ˆë‹¤. Flask, Django ë“± WSGI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. **`--http-socket 0.0.0.0:3031`**: 
   - `0.0.0.0:3031`ì€ ì„œë²„ê°€ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(IP ì£¼ì†Œ)ì—ì„œ HTTP ìš”ì²­ì„ ìˆ˜ì‹ í•˜ë©°, í¬íŠ¸ `3031`ì—ì„œ ëŒ€ê¸°í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
   - `0.0.0.0`ì€ í•´ë‹¹ í˜¸ìŠ¤íŠ¸ì˜ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ì˜ˆ: ë¡œì»¬, ì™¸ë¶€)ì—ì„œ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
   - í¬íŠ¸ ë²ˆí˜¸ëŠ” `3031`ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” uWSGI ì„œë²„ê°€ ì´ í¬íŠ¸ì—ì„œ íŠ¸ë˜í”½ì„ ìˆ˜ì‹ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

3. **`--wsgi-file toy_flask_app.py`**:
   - `toy_flask_app.py` íŒŒì¼ì„ WSGI ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì‹¤í–‰í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
   - ì´ íŒŒì¼ì—ëŠ” Flask ì•±ì´ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•˜ë©°, uWSGIëŠ” ì´ íŒŒì¼ì„ ì½ì–´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

4. **`--callable app`**:
   - `app`ì€ Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê°ì²´ ì´ë¦„ì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì€ `app = Flask(__name__)`ì™€ ê°™ì´ ì •ì˜ë˜ë©°, uWSGIëŠ” `app`ì´ë¼ëŠ” ì´ë¦„ì˜ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

5. **`--processes 4`**:
   - `4`ê°œì˜ ë…ë¦½ì ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ì—¬ëŸ¬ ìš”ì²­ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
   - ê° í”„ë¡œì„¸ìŠ¤ëŠ” ë³„ë„ì˜ ë©”ëª¨ë¦¬ë¥¼ ê°€ì§€ê³  ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ë©°, ë™ì‹œì— 4ê°œì˜ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

6. **`--threads 2`**:
   - ê° í”„ë¡œì„¸ìŠ¤ë‹¹ `2`ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
   - ì´ `4 * 2 = 8`ê°œì˜ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì‹¤í–‰ë˜ë©°, ì´ë¥¼ í†µí•´ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - ì¦‰, í•œ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ì—¬ëŸ¬ ìš”ì²­ì„ ìŠ¤ë ˆë“œ ë‹¨ìœ„ë¡œ ë³‘ë ¬ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“ **ì„¤ì •íŒŒì¼ ë“±ë¡ ë° ìˆ˜í–‰**

```Ini
[uwsgi]
http-socket = 0.0.0.0:3031
# socket = /tmp/toy_flask.sock
wsgi-file = toy_flask_app.py
callable = app
processes = 4
threads = 2
stats = 127.0.0.1:9191
```

- httpëŠ” uWSGI í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê²ƒì´ê³  Nginxì™€ í†µì‹ ì„ ìœ„í•´ socket í•„ìš”
- statsëŠ” ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ê³¼ ê°™ì€ ê°œë…
  - ì ‘ì†í•˜ë©´ ì •ë³´ í™•ì¸ ê°€ëŠ¥

```
uwsgi --ini wsgi.ini
```

### 5. Nginx ì—°ë™ ì„¤ì •

ğŸ“ **ì„œë²„ íŒŒì¼ ìƒì„±**

ğŸ“œ **/etc/nginx/sites-available/toy.server**

```
server {
	listen 80;
	server_name localhost;
	location / { try_files $uri @app; }
	location @app {
		include uwsgi_params;
		uwsgi_pass unix:/tmp/toy_flask.sock;
  }
}
```

**1. location @app**

- @appì€ Nginx ì„¤ì •ì—ì„œ **ì´ë¦„ì´ ì§€ì •ëœ location ë¸”ë¡**ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ @appì€ Nginxê°€ íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë•Œ(ì˜ˆ: try_filesê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ), ì´ ì´ë¦„ì„ í†µí•´ ì§€ì •ëœ location @app ë¸”ë¡ìœ¼ë¡œ ìš”ì²­ì„ ë„˜ê¹ë‹ˆë‹¤.

**2. uwsgi_params**

- uwsgi_paramsëŠ” **Nginxì™€ uWSGI ê°„ì˜ í†µì‹ **ì— í•„ìš”í•œ ë‹¤ì–‘í•œ ìš”ì²­ í—¤ë”ì™€ í™˜ê²½ ë³€ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ íŒŒì¼ì—ëŠ” WSGI ê·œê²©ì„ ë”°ë¥´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- ì´ë¯¸ /etc/nginx/uwsgi_paramsê°€ ìˆìŒ
- ì´ íŒŒì¼ì„ í¬í•¨í•˜ì§€ ì•Šìœ¼ë©´ NginxëŠ” uWSGI ì„œë²„ì— í•„ìš”í•œ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ìŒ

**3. unix:/tmp/hello_cju.sock**

- unix:/tmp/hello_cju.sockëŠ” **ìœ ë‹‰ìŠ¤ ì†Œì¼“ì„ í†µí•œ Nginxì™€ uWSGI ê°„ì˜ í†µì‹ **ì„ ì„¤ì •í•©ë‹ˆë‹¤. NginxëŠ” ì´ ì†Œì¼“ì„ í†µí•´ uWSGI ì„œë²„ì™€ í†µì‹ í•˜ê³  ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
- í•´ë‹¹ íŒŒì¼ì€ uWSGI ì„œë²„ì— ì¡´ì¬
- nginxëŠ” í”„ë¡ì‹œ ì—­í• ë§Œ í•˜ê¸° ë•Œë¬¸ì— ê²½ë¡œ ë°‘ì— sock íŒŒì¼ì— ë°ì´í„°ë¥¼ ì”€
- uwsgiê°€ ë°ì´í„° ë³€ê²½ëœ ê²ƒì„ ì½ì–´ì„œ í”„ë¡œê·¸ë¨ ìˆ˜í–‰

ğŸ“Œ **ì†Œì¼“**

- ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ” ë°©ì‹ ì¤‘ í•˜ë‚˜
- ì¢…ë¥˜
  - ë„¤íŠ¸ì›Œí¬(TCP)
  - unix: ì»´í“¨í„°ê°€ ê°™ì€ë° í”„ë¡œì„¸ìŠ¤ ê°„ì˜ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ë•Œ ì‚¬ìš©

ğŸ“ **ì„œë²„íŒŒì¼ ë§í¬**

```
sudo rm /etc/nginx/sites-enabled/default
sudo ln -s /etc/nginx/sites-available/toy.server /etc/nginx/sites-enabled/default
```

ğŸ“ **Nginx ê¸°ë™**

```
sudo nginx -t
sudo systemctl reload nginx
sudo systemctl status nginx
```

### 6. wsgi ì„œë²„ ì„¤ì •

ğŸ“**wsgi.py**

```python
from toy_flask_app import app
if __name__=='__main__':
	app.run(host='0.0.0.0')
```

ğŸ“**nginx-wsgi.ini**

```
which python
/root/.cache/pypoetry/virtualenvs/toy-project-fMs6vUfn-py3.11/bin/python
```

```
find /usr -name "*python3_plugin.so*"
```

- python ê²½ë¡œ í™•ì¸

```ini
# nginx-wsgi.ini
[uwsgi]
module = wsgi
callable = app
socket = /tmp/toy_flask.sock
chmod-socket = 666
vacuum = true
daemonize = ./toy_wsgi.log
die-on-term = true # kill ëª…ë ¹ì–´ë¥¼ í™œìš©í•´ uwsgi ì¢…ë£Œ ê°€ëŠ¥í† ë¡ ì„¤ì •
venv = /root/.cache/pypoetry/virtualenvs/toy-flask-project-5J2JIJPJ-py3.11/bin/python
# --stop ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì¢…ë£Œ ê°€ëŠ¥í•˜ë„ë¡ process ID íŒŒì¼ ìƒì„±
# ì‚¬ìš©ë²•: uwsgi --stop demo.pid -> uwsgi í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ í›„ .pid íŒŒì¼ ìë™ ì‚­ì œë¨
pidfile = ./uwsgi.pid
plugins-dir = /usr/lib/uwsgi/plugins
plugins = python3_plugin.so
processes = 1
```











