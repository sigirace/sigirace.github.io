## ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œê³¼ ì•„í‚¤í…ì²˜



### ì•„í‚¤í…ì²˜

[img>monitoring.architecture]

- `kubectl top`: í´ë¼ì´ì–¸íŠ¸ ëª…ë ¹ì–´
- api serverê°€ í´ë¼ì´ì–¸íŠ¸ ëª…ë ¹ì–´ë¥¼ metric serverì— ì—°ê³„
- kubeletì„ í†µí•´ ë„ì»¤ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì—­ìˆœìœ¼ë¡œ ë‹¤ì‹œ ì „ë‹¬



- HPA controller: ë¦¬ì†ŒìŠ¤ë¥¼ ëª¨ë‹ˆí„°ë§ í•˜ê³  ìˆë˜ í”„ë¡œê·¸ë¨
- Monitoring cluster agentë¡œë¶€í„° ë°ì´í„°ë¥¼ ë°›ê³  ìˆìŒ (prometheus)
  - í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ íŠ¹ì • ì£¼ê¸°ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•¨
  - ë°ì´í„°ëŠ” kubeltì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì €ì¥í•´ë†“ê³ ìˆìŒ
  - ì €ì¥ëœ ë°ì´í„°ëŠ” OSS Infrastoreë¥¼ í†µí•´ ì €ì¥ë¨



### ê·¸ë¼íŒŒë‚˜

**1. í—¬ë¦„ ë ˆíŒŒì§€í† ë¦¬ ì¶”ê°€**

```
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
```

**2. ê·¸ë¼íŒŒë‚˜ì™€ í”„ë¡œë©”í…Œìš°ìŠ¤ íŒŒì¼**

```
mkdir grafana_prometheus
cd grafana_prometheus
```

ğŸ“’ **values-prometheus.yaml**

```
cat <<EOF > values-prometheus.yaml
server:
  enabled: true

  persistentVolume:
    enabled: true
    accessModes:
      - ReadWriteOnce
    mountPath: /data
    size: 100Gi
  replicaCount: 1

  ## Prometheus data retention period (default if not specified is 15 days)
  ##
  retention: "15d"
EOF
```

ğŸ“’ **values-grafana.yaml**

```
cat << EOF > values-grafana.yaml
replicas: 1

service:
  type: LoadBalancer

persistence:
  type: pvc
  enabled: true
  # storageClassName: default
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  # annotations: {}
  finalizers:
    - kubernetes.io/pvc-protection

# Administrator credentials when not using an existing secret (see below)
adminUser: admin
adminPassword: test1234!234
EOF
```

**3. ë°°í¬**

```
kubectl create ns prometheus
helm install prometheus prometheus-community/prometheus -f values-prometheus.yaml -n prometheus
helm install grafana grafana/grafana -f values-grafana.yaml -n prometheus
```

```
kubectl get svc -n prometheus
```

**4. ë°ì´í„° ì—°ê²°**

- Menu > Connections > Data sources > Add > Prometheus
- url: Cluster IP (http://prometheus-server)
- save & test

**5. ëŒ€ì‹œë³´ë“œ ì—°ê²°**

- https://grafana.com/grafana/dashboards/
- create dashboard > import dashboard
- ë²ˆí˜¸ ì…ë ¥ ë° ë°ì´í„° ì†ŒìŠ¤ ì…ë ¥
  - 315 ë˜ëŠ” 13770









