## ì• í”Œë¦¬ì¼€ì´ì…˜ ë³€ìˆ˜ ê´€ë¦¬

- ê¸°ì¡´ ë„ì»¤ ì´ë¯¸ì§€ì˜ ë³€ìˆ˜ê°€ ë³€ê²½ë  ë•Œ, ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ ë§Œë“¤ì–´ì•¼ í•¨
- ë³€ìˆ˜ë¥¼ ìì£¼ ë³€ê²½í•´ì•¼ í•œë‹¤ë©´ ì™¸ë¶€ì—ì„œ ë³€ìˆ˜ë¥¼ ì½ì–´ë“¤ì´ëŠ” ë°©ë²• ì‚¬ìš©



[scheduling.main]

- yaml íŒŒì¼ì—ì„œ ì ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜ í™˜ê²½ ë³€ìˆ˜ê°€ ë°”ë€” ì‹œ ë‹¤ì‹œ ì‘ì„±í•´ì•¼í•¨
- ì™¸ë¶€ë¥¼ ì°¸ì¡°í•˜ê²Œ ë§Œë“œëŠ” ë°©ë²•
  - configmap
  - secert



## ConfigMap

```
echo -n 1234 > test
```

- ì„ì‹œ test íŒŒì¼ ìƒì„±

```
kubectl create configmap map-name --from-file=test
```

- configmap ìƒì„±

```
kubectl get configmap map-name -o yaml
```

```yaml
apiVersion: v1
data:
  test: "1234"
kind: ConfigMap
metadata:
  creationTimestamp: "2024-12-03T22:49:26Z"
  name: map-name
  namespace: default
  resourceVersion: "8500854"
  uid: c68e2928-f462-41ae-89d0-a282155b3ba3
```



## Secret

- ë¹„ë°€ë²ˆí˜¸, OAuth í† í° ë° ssh í‚¤ì™€ ê°™ì€ ë¯¼ê°í•œ ì •ë³´
- envë¥¼ base64ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì„¤ì •
- secert ë°ì´í„°ëŠ” etcdì— ì €ì¥ë¨
- í—ˆê°€ëœ podì—ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•¨

```
echo -n admin > username
echo -n 1234asdqwer > password
kubectl create secret generic db-user-pass --from-file=username --from-file=password
```

- generic: secretì˜ ìœ í˜• ì¤‘ 1ê°œ, ê°€ì¥ ì¼ë°˜ì 

```
kubectl get secret -o yaml db-user-pass
```

```yaml
apiVersion: v1
data:
  password: MTIzNGFzZHF3ZXI=
  username: YWRtaW4=
kind: Secret
metadata:
  creationTimestamp: "2024-12-03T23:07:59Z"
  name: db-user-pass
  namespace: default
  resourceVersion: "8513023"
  uid: 13179d8a-32ce-4465-b561-241c9ef691a1
type: Opaque
```



### ğŸŒˆ mysql ì˜ˆì œ

**1. secret yaml ìƒì„±**

```
kubectl create secret generic db-secret --from-literal='DB_Password=Passw0rd!0' --dry-run -o yaml > secret-mysql.yaml
```

- literal: ëª…ë ¹ì–´ ì•ˆì—ì„œ ì •ì˜

```yaml
apiVersion: v1
data:
  DB_Password: UGFzc3cwcmQhMA==
kind: Secret
metadata:
  creationTimestamp: null
  name: db-secret
```

**2. Pod ìƒì„±**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mysql
  labels:
    app: mysql
spec: 
  containers:
  - name: mysql
    image: mysql:5.6
    ports:
    - container: 3306
    env:
    - name: MYSQL_ROOT_PASSWORD # ì´ë¯¸ì§€ì—ì„œ ì •í•œ name, ë³€ê²½ ë¶ˆê°€
      vlaueFrom:
        secretKeyRef:
          name: db-secret # secret ëª…
          key: DB_Password # ë³€ìˆ˜ ëª…
```



## í•œ íŒŒë“œì— ë©€í‹° ì»¨í…Œì´ë„ˆ

- íŒŒë“œ ë‚´ì— ë‘ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ë„ì›€
- ë³¼ë¥¨ì„ ì—°ê²°í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ì˜ ê°œë…ìœ¼ë¡œ ì‚¬ìš©
- ë’¤ì— í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

ğŸŒˆ **ë©€í‹° ì»¨í…Œì´ë„ˆ ì˜ˆì œ**

**1. yaml íŒŒì¼ ìƒì„±**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-redis-pod
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
  - name: redis
    image: redis
```

**2. pod ìƒì„± ë° í™•ì¸**

```
kubectl create -f nginx-redis-pod.yaml
kubectl get pod -o wide
```

```
NAME                       READY   STATUS    RESTARTS   AGE   IP           NODE                                       NOMINATED NODE   READINESS GATES
nginx-redis-pod            2/2     Running   0          64s   10.20.2.23   gke-cluster-1-default-pool-d71ec015-8z29   <none>           <none>
```

**3. ë…¸ë“œ ë‚´ì—ì„œ í™•ì¸**

```
gke-cluster-1-default-pool-d71ec015-8z29 ~ # sudo crictl ps | grep nginx
ae03b4555c21d       b5e874b32a794       8 minutes ago       Running             redis                                  0                   959d27fc38c96       nginx-redis-pod
a93e847e3af9b       66f8bdd3810c9       9 minutes ago       Running             nginx                                  0                   959d27fc38c96       nginx-redis-pod
286f2885553dc       11b916a025f02       8 days ago          Running             controller                             0                   c7efee9301cca       ingress-nginx-controller-846949fc46-nwnn8
```



## init ì»¨í…Œì´ë„ˆ

- íŒŒë“œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì „ì— ì´ˆê¸°í™” ì—­í• ì„ í•˜ëŠ” ì»¨í…Œì´ë„ˆ
- ì™„ì „íˆ ì´ˆê¸°í™”ê°€ ì§„í–‰ëœ ë‹¤ìŒì—ì•¼ ì£¼ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰
- ì˜ì¡´ì„±ì´ ìˆëŠ” ê²½ìš° ë¨¼ì € ì‹¤í–‰ë  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ê¸° ìœ„í•¨



## ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ìš”êµ¬ì‚¬í•­ê³¼ ì œí•œ ì„¤ì •

- ë¦¬ì†ŒìŠ¤ ìš”ì²­: ìµœì € ìš”êµ¬ ì‚¬í•­
  - í´ëŸ¬ìŠ¤í„° ë‚´ ë¹ˆ ê³µê°„ì´ ì—†ìœ¼ë©´ íŒŒë“œê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
- ë¦¬ì†ŒìŠ¤ ì œí•œ: ìµœëŒ€ í—ˆìš©
- CPUëŠ” ë³´í†µ m ë‹¨ìœ„ë¡œ ìƒì„±



## ìˆ˜ë™ ìŠ¤ì¼€ì¤„ë§

- GPU ê°™ì€ ìì›ì´ í•„ìš”í•œ ê²½ìš° íŠ¹ì • ë…¸ë“œì— íŒŒë“œë¥¼ ë„ì›Œì•¼í•¨



**1. nodeName ì§€ì •**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: http-go
spec:
  containers:
  - name: http-go
    image: gasbugs/http-go
  nodeName: work1
```



**2. ë…¸ë“œ ì…€ë ‰í„° ì§€ì •**

```
kubectl label nodes <node_name> gpu=true
kubectl get nodes --show-labels
kubectl get nodes -L gpu
```

- ë…¸ë“œì— ë ˆì´ë¸” ì§€ì •

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: http-go
spec:
  containers:
  - name: http-go
    image: gasbugs/http-go
  nodeSelector:
    gpu: "true"
```



## ë©€í‹°í”Œ ìŠ¤ì¼€ì¤„ëŸ¬

- ê¸°ì¡´ì— kubesystemì— ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆìŒ
- ì´ëŠ” k8sì—ì„œ ë°°í¬í•œ ìŠ¤ì¼€ì¤„ëŸ¬
- ì»¤ìŠ¤í…€ ìŠ¤ì¼€ì¤„ëŸ¬ë„ ë°°í¬ ê°€ëŠ¥
- ê¶Œí•œ ë¶€ì—¬ í•„ìš”í•¨



## ì˜¤í† ìŠ¤ì¼€ì¼ë§

### ğŸ“Œ í¬ë“œ ìŠ¤ì¼€ì¼ë§ ë°©ë²•

- `HPA`: í¬ë“œ ìì²´ë¥¼ ë³µì œí•˜ì—¬ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” í¬ë“œì˜ ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²•
- `VPA`: ë¦¬ì†ŒìŠ¤ë¥¼ ì¦ê°€ì‹œì¼œ í¬ë“œì˜ ì‚¬ìš© ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²•
- `CA`: í´ëŸ¬ìŠ¤í„° ìì²´ë¥¼ ëŠ˜ë ¤ ë…¸ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ë²•
- VPAì™€ CAëŠ” Cloudì—ì„œ ì„¤ì •í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ëŠ˜ë¦´ ìˆ˜ ìˆìŒ



### ğŸ“Œ HPA ì„¤ì • ë°©ë²•

**1. ëª…ë ¹ì–´**

```
kubectl autoscale deployment my-app --max 6 --min 4 --cpu-percent 50
```

- íŒŒë“œì˜ ê°œìˆ˜ë¥¼ ê°€ì§€ëŠ” replicaset ë˜ëŠ” deploymentì— ì§€ì • ê°€ëŠ¥
- cpu ì‚¬ìš©ëŸ‰ì´ 50ì´ ë„˜ì–´ê°€ë©´ ìˆ˜í–‰í•¨



**2. yaml**

```yaml
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
  namespace: default
spec:
  maxReplicas: 10
  minReplicas: 1
  scaleTargetRef:
    apiVersion: extensions/v1beta1
    kind: Deployment
    name: myapp
  targetgetCPUUtilizationPercentage: 30
```



### ğŸª„ HPA ì‹¤ìŠµ

```
kubectl apply -f https://k8s.io/examples/application/php-apache.yaml
kubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10
kubectl get hpa -w
```

```
NAME         REFERENCE               TARGETS       MINPODS   MAXPODS   REPLICAS   AGE
php-apache   Deployment/php-apache   cpu: 1%/50%   1         10        1          63s
```

- í˜„ì¬ì˜ ë³µì œìˆ˜ 1

```
kubectl run load-generator --image=busybox -it --rm -- /bin/sh
wget -O- -q  php-apache # 1íšŒ
while true; do wget -q -O- http://php-apache.default.svc.cluster.local; done # ë¬´í•œë£¨í”„
```

- ëŠ˜ì–´ë‚˜ëŠ”ê²ƒì€ ì¦‰ê°ì ì´ë‚˜ ì¤„ì–´ë“œëŠ” ê²ƒì€ ìœ ì˜ˆê¸°ê°„ì´ ì•½ 5ë¶„ ìˆìŒ



**1. -q (Quiet Mode)**

- -qëŠ” **Quiet Mode**ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
- ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ wgetì´ ì‹¤í–‰ ì¤‘ ì¶œë ¥í•˜ëŠ” **ì§„í–‰ ìƒíƒœ ë©”ì‹œì§€(progress messages)**ê°€ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ wgetì€ ë‹¤ìš´ë¡œë“œ ìƒíƒœ(ì§„í–‰ë¥ , ë‹¤ìš´ë¡œë“œ ì†ë„ ë“±)ë¥¼ ì¶œë ¥í•˜ì§€ë§Œ, -që¥¼ ì‚¬ìš©í•˜ë©´ ì´ ì •ë³´ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. -O- (Output to Standard Output)**

- -O-ëŠ” ë‹¤ìš´ë¡œë“œí•œ ë‚´ìš©ì„ **íŒŒì¼ë¡œ ì €ì¥í•˜ì§€ ì•Šê³ , í‘œì¤€ ì¶œë ¥(stdout)**ìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ wgetì€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥í•˜ì§€ë§Œ, -O-ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìš´ë¡œë“œëœ ë°ì´í„°ë¥¼ í™”ë©´(í„°ë¯¸ë„)ì— ì¶œë ¥í•©ë‹ˆë‹¤.





ğŸ“’ **php-apache.yaml**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: php-apache
spec:
  selector:
    matchLabels:
      run: php-apache
  template:
    metadata:
      labels:
        run: php-apache
    spec:
      containers:
      - name: php-apache
        image: registry.k8s.io/hpa-example
        ports:
        - containerPort: 80
        resources:
          limits:
            cpu: 500m
          requests:
            cpu: 200m
---
apiVersion: v1
kind: Service
metadata:
  name: php-apache
  labels:
    run: php-apache
spec:
  ports:
  - port: 80
  selector:
    run: php-apache
```

**1. Deployment**

- DeploymentëŠ” php-apacheë¼ëŠ” ì´ë¦„ì˜ Podë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
- Pod ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆëŠ” registry.k8s.io/hpa-example ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë©°, ì»¨í…Œì´ë„ˆëŠ” 80ë²ˆ í¬íŠ¸ë¥¼ ì—½ë‹ˆë‹¤.
- resourcesì—ì„œ CPU ì œí•œ(limits)ê³¼ ìš”ì²­(requests)ì„ ì„¤ì •í•˜ì—¬ Podì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ì œì–´í•©ë‹ˆë‹¤.
- Deploymentì˜ spec.template.metadata.labelsì— ì •ì˜ëœ ë¼ë²¨ì€ ìƒì„±ëœ Podì— ì ìš©ë©ë‹ˆë‹¤.
- ì•„ë˜ì™€ ê°™ì€ labelì´ podì— ì ìš©ë¨

```
labels:
  run: php-apache
```

**2. Service**

- ServiceëŠ” php-apacheë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
- selectorëŠ” run: php-apache ë¼ë²¨ì„ ê°€ì§„ Podë¥¼ ëŒ€ìƒìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
- ServiceëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ DNS ì´ë¦„ php-apache.default.svc.cluster.localë¡œ ë…¸ì¶œë©ë‹ˆë‹¤.
- í¬íŠ¸ ë§¤í•‘ì€ 80ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

**3. DNS ì´ë¦„**

- Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì˜ DNS ì´ë¦„ì„ ê°€ì§‘ë‹ˆë‹¤:

```
<service-name>.<namespace>.svc.cluster.local
```

- ìœ„ YAML íŒŒì¼ì—ì„œëŠ” php-apacheê°€ default ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìƒì„±ë˜ë¯€ë¡œ, í•´ë‹¹ DNS ì´ë¦„ì€ `php-apache.default.svc.cluster.local`

**4. í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œì˜ ì ‘ê·¼**

- ìœ„ URLë¡œ ì ‘ê·¼í•˜ë ¤ë©´ **í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Podë‚˜ ë…¸ë“œ**ì—ì„œ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, wget ë˜ëŠ” curl ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
wget -q -O- http://php-apache.default.svc.cluster.local
```

**5. ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ë ¤ë©´ ì¶”ê°€ ì„¤ì • í•„ìš”**

- ìœ„ ì„¤ì •ì€ Kubernetes **í´ëŸ¬ìŠ¤í„° ë‚´ë¶€**ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ë ¤ë©´ `LoadBalancer`, `NodePort`, ë˜ëŠ” `Ingress`ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸŒˆ **ì˜ˆì‹œ: LoadBalancerë¡œ ë³€ê²½**

```yaml
apiVersion: v1
kind: Service
metadata:
 name: php-apache
 labels:
  run: php-apache
spec:
 type: LoadBalancer
 ports:
  - port: 80
  targetPort: 80
 selector:
  run: php-apache
```









## ğŸª„ DNS ì´ë¦„ì´ë€?

> **DNS ì´ë¦„**ì€ **ë„ë©”ì¸ ë„¤ì„ ì‹œìŠ¤í…œ(Domain Name System)**ì„ í†µí•´ íŠ¹ì • ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤(ì˜ˆ: ì„œë²„, ì„œë¹„ìŠ¤, ì›¹ì‚¬ì´íŠ¸ ë“±)ë¥¼ ì‹ë³„í•˜ê³  ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **ê°€ë…ì„± ìˆëŠ” ì´ë¦„**ì…ë‹ˆë‹¤.

- **IP ì£¼ì†Œ**: 192.168.1.1 â†’ ì‚¬ëŒì´ ê¸°ì–µí•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.
- **DNS ì´ë¦„**: example.com â†’ ì‚¬ëŒì´ ì‰½ê²Œ ì½ê³  ê¸°ì–µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**1. Kubernetesì—ì„œì˜ DNS ì´ë¦„**

> Kubernetesì—ì„œëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ì„œë¹„ìŠ¤ë‚˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ê¸° ìœ„í•´ **ë‚´ë¶€ DNS ì´ë¦„**ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ì´ë¦„ì„ ì‚¬ìš©í•˜ë©´ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ì‰½ê²Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. Kubernetes DNS ì´ë¦„ í˜•ì‹**

- DNS ì´ë¦„ì€ ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤

```
<ì„œë¹„ìŠ¤ ì´ë¦„>.<ë„¤ì„ìŠ¤í˜ì´ìŠ¤>.svc.cluster.local
```

- **ì„œë¹„ìŠ¤ ì´ë¦„**: Kubernetes Serviceì˜ ì´ë¦„.
- **ë„¤ì„ìŠ¤í˜ì´ìŠ¤(namespace)**: Serviceê°€ ë°°í¬ëœ Kubernetes ë„¤ì„ìŠ¤í˜ì´ìŠ¤.
- **svc.cluster.local**: Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë‚´ë¶€ DNS ë„ë©”ì¸.
- ì´ DNS ì´ë¦„ì„ í†µí•´ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
