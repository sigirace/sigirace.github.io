## Static Pod

- kubeletì´ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ì½”ë“œ
  - clientì˜ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ìƒì„±ë˜ëŠ” ê²ƒì´ ì•„ë‹˜
- nodeê°€ static podê°€ ìˆëŠ”ì§€ ì§€ì†ì ìœ¼ë¡œ í™•ì¸í•˜ê³  ì¬ê¸°ë™í•¨
  - ì‚­ì œê°€ ì•ˆë¨



### ğŸŒˆ static pod ìƒì„± ì˜ˆì‹œ

**1. ê¸°ë³¸ê²½ë¡œ**

```
/etc/kubernetes/manifests
```

- í•´ë‹¹ í´ë” ë‚´ì˜ `yaml` íŒŒì¼ë“¤ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ

**2. ë°ëª¬ í™•ì¸**

```
sudo service kubelet status
```

```
â— kubelet.service - kubelet: The Kubernetes Node Agent
     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)
    Drop-In: /usr/lib/systemd/system/kubelet.service.d
             â””â”€10-kubeadm.conf
     Active: active (running) since Mon 2024-11-04 02:39:03 UTC; 1 weeks 0 days ago
       Docs: https://kubernetes.io/docs/
   Main PID: 4048 (kubelet)
      Tasks: 13 (limit: 4558)
     Memory: 44.5M
     CGroup: /system.slice/kubelet.service
             â””â”€4048 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/>
```

- `/usr/lib/systemd/system/kubelet.service.d` : ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ëŠ” íŒŒì¼ì´ ìˆëŠ” í´ë”

ğŸ“’ **/usr/lib/systemd/system/kubelet.service.d**

```
[Service]
Environment="KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"
Environment="KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"
# This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically
EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env
# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use
# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.
EnvironmentFile=-/etc/default/kubelet
ExecStart=
ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
```

- `ExecStart`: kubelet ì‹¤í–‰ ëª…ë ¹
- `/etc/kubernetes/kubelet.conf`: ì¸ì¦ ê´€ë ¨ëœ íŒŒì¼
- `/var/lib/kubelet/config.yaml`: ì—¬ëŸ¬ ì„¤ì •ì— ëŒ€í•œ íŒŒì¼ë¡œ, static pod ì„¤ì •ë„ í¬í•¨

ğŸ“’ **/var/lib/kubelet/config.yaml**

```
apiVersion: kubelet.config.k8s.io/v1beta1
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 0s
    enabled: true
  x509:
    clientCAFile: /etc/kubernetes/pki/ca.crt
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 0s
    cacheUnauthorizedTTL: 0s
cgroupDriver: systemd
clusterDNS:
- 10.96.0.10
clusterDomain: cluster.local
containerRuntimeEndpoint: ""
cpuManagerReconcilePeriod: 0s
evictionPressureTransitionPeriod: 0s
fileCheckFrequency: 0s
healthzBindAddress: 127.0.0.1
healthzPort: 10248
httpCheckFrequency: 0s
imageMaximumGCAge: 0s
imageMinimumGCAge: 0s
kind: KubeletConfiguration
logging:
  flushFrequency: 0
  options:
    json:
      infoBufferSize: "0"
  verbosity: 0
memorySwap: {}
nodeStatusReportFrequency: 0s
nodeStatusUpdateFrequency: 0s
resolvConf: /run/systemd/resolve/resolv.conf
rotateCertificates: true
runtimeRequestTimeout: 0s
shutdownGracePeriod: 0s
shutdownGracePeriodCriticalPods: 0s
staticPodPath: /etc/kubernetes/manifests
streamingConnectionIdleTimeout: 0s
syncFrequency: 0s
volumeStatsAggPeriod: 0s
```

- `staticPodPath`: manifests ê²½ë¡œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŒ

**3. static pod ë“±ë¡**

```cmd
path: /etc/kubernetes/manifests/[static_pod_name].yaml
```

```yaml
apiVersion: v1
kind: Pod
metadata:
	name: static-web
	labels:
		role: myrole
spec:
	containers:
		-	name: web
			image: nginx
			ports:
				-	name: web
					container: 80
					protocol: TCP
```