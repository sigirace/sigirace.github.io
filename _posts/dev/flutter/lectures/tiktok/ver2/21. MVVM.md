## 21.1 MVVM

### 1. ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

- í•˜ë‚˜ì˜ íŒŒì¼ í˜¹ì€ í´ë˜ìŠ¤ëŠ” í•œê°€ì§€ ì‘ì—…ì„ í•´ì•¼ í•¨
- ex) SettingScreen
  - ì„¤ì • í™”ë©´ì˜ UIë¥¼ ë§Œë“œëŠ” ê²ƒì„ ì˜í•´ì•¼í•¨
  - ë°ì´í„°ë¥¼ ê¸°ê¸° ì €ì¥ì†Œì— ì €ì¥í•˜ëŠ” ê²ƒì— ê´€ì—¬í•˜ë©´ ì•ˆë¨
  - ì €ì¥ì†Œì— ê´€ì—¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ë‘ì–´ì•¼í•¨



### 2. MVVM

- View: UI í‘œí˜„, ì´ë²¤íŠ¸ë¥¼ ë°›ëŠ” ë¶€ë¶„
- Model: ë°ì´í„°
- VM: ChangeNotifier
  - Viewê°€ VMì—ê²Œ ì´ë²¤íŠ¸ ì „ë‹¬
  - VMì´ Model ë°ì´í„° ë³€ê²½ í›„ ë³€ê²½ì‚¬í•­ì„ Viewì—ê²Œ ì „ë‹¬
- Repository: ë³„ë„ì˜ íŒŒì¼ ë° í´ë˜ìŠ¤ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì—­í•  ìˆ˜í–‰



## 21.2 VideoPlaybackConfigRepository

### 1. model

ğŸ“’ **model/playback_config_model.dart**

```dart
class PlaybackConfigModel{
  bool muted;
  bool autoplay;
  
  PlaybackConfigModel({
    required this.muted,
    required this.autoplay,
  });
}
```

- ì‚¬ìš©í•  ë°ì´í„°ì˜ í˜•íƒœë¥¼ ì •ì˜í•¨



### 2. VM

ğŸ“’ **view_mode/playback_config_vm.dart**

```dart
class PlaybackConfigViewModel extends ChangeNotifier{
  PlaybackConfigRepository _repository;
  
  late final PlaybackConfigModel _model = PlaybackConfigModel(
    muted: _repository.isMuted(), 
    autoplay: _repository.isAutoPlay(),
  )
  
	PlaybackConfigViewModel(this._repository);
  
  bool get muted => _model.muted;
  
  void setMuted(bool value){
    _repository.setMuted(value);
    _model.muted = value;
    notifyListeners();
  }
	
  bool get autoplay => _model.autoplay;
  
  void setAutoplay(bool value){
    _repository.setAutoplay(value);
    _model.autoplay = value;
    notifyListeners();
  }
}
```

- ë°ì´í„°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆê³ , ìœ„ì ¯ì´ ë°ì´í„°ë¥¼ Listení•˜ê²Œ í•  ìˆ˜ ìˆìŒ
  - ë°ì´í„°ê°€ ë°”ë€” ë•Œ ìœ„ì ¯ì—ê²Œ ì•Œë ¤ì¤Œ
- ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•˜ê¸°ì— repository ì˜ì¡´ì„± ì£¼ì…
- ë°ì´í„°ëŠ” ìƒì„±ë  ë•Œ repositoryë¡œ ë¶€í„° ì ‘ê·¼ê°€ëŠ¥í•˜ê²Œ ë˜ê³ , ì´ë¥¼ í†µí•´ Modelì„ ì´ˆê¸°í™”í•  ìˆ˜ ìˆìŒ (late)







### 3. Repository

ğŸ“’ **repos/video_playback_config_repo.dart**

```dart
class VideoPlaybackConfigRepository {
  
  static const String _autoplay = "autoplay";
  static const String _muted = "muted";
  
  SharedPreferences _preferences;
  VideoPlaybackConfigReposoitory(this._preferences);
  
  Future<void> setMuted(bool value) async {
    _preferences.setBool(_muted, value);
  }
  
  Future<void> setAutoplay(bool value) async {
    _preferences.setBool(_autoplay, value);
  }
  
  bool isMuted(){
    return _preferences.getBool(_muted) ?? false; // ì´ˆê¸°ê°’ì´ ì—†ì„ ìˆ˜ ìˆìŒ
  }
  
  bool isAutoPlay(){
    return _preferences.getBool(_autoplay) ?? false; // ì´ˆê¸°ê°’ì´ ì—†ì„ ìˆ˜ ìˆìŒ
  }
}
```

- ë””ìŠ¤í¬ì— persist í•˜ëŠ” ì—­í•  ë°  ë””ìŠ¤í¬ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• 
  - persist: ë°ì´í„°ë¥¼ í”„ë¡œê·¸ë¨ë³´ë‹¤ ì˜¤ë˜ ì‚´ë¦¬ëŠ” ê²ƒ)
- ì¦‰, ë°ì´í„°ë¥¼ ì½ê³  ì €ì¥í•˜ëŠ” ì—­í• ë§Œ ìˆ˜í–‰
- flutter pub add shared_preferences 
  - ê¸°ê¸° ì €ì¥ì†Œì— ì €ì¥í•˜ê³  ì½ëŠ” ì—­í• ì„ ìˆ˜í–‰



## 21.3 PlaybackConfigViewModel



### 1. ViewModel ì‘ì„±



### 2. Main ìˆ˜ì •

- asyncë¡œ ë³€ê²½
- preference ì ‘ê·¼ ì„¤ì •
- repository ì ‘ê·¼ ì„¤ì •
- runAppì•ˆì˜ widgetì„ MultiProviderë¡œ ê°ìŒˆ
- viewmodelì„ changeNotifierProviderë¡œ ê°ìŒˆ

```dart
void main async{
  ...
  WidgetsFlutterBinding.ensureInitialized();
  final preferences = await SharedPreferences.getInstance();
  final repository = PlaybackConfigRepository(preferences);
  
  runApp(MultiProvider(
  	providers: [
      ChangeNotifierProvider(
      	create: (context) => PlaybackConfigViewModel(repository)
      ),
    ],
    child: const TikTokApp(),
  ));
}
```



### 3. widget todtjd

```dart
...
  SwitchListTile.adaptive(
  	value: context.watch<PlaybackConfigViewModel>().muted,
  	onChanged: (value) => context.read<PlaybackConfigViewModel>().setMuted(value),
	)
```

- watchëŠ” ë³€í™”ê°€ ìˆìœ¼ë©´ build => Stateful
- readëŠ” í•œë²ˆ ì½ê³  ë‹¤ì‹œ ì½ì§€ ì•ŠìŒ => Stateless