---
layout: single
title:  'k8s (2) GCPë¥¼ ì‚¬ìš©í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµ'
toc: true
categories: [K8S]
tags: [GCP, GKE, Onprem Kubernetes]
---

[ë°ë¸Œì˜µìŠ¤(DevOps)ë¥¼ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„°](https://www.inflearn.com/course/%EB%8D%B0%EB%B8%8C%EC%98%B5%EC%8A%A4-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A7%88%EC%8A%A4%ED%84%B0/dashboard) ê°•ì˜ ì •ë¦¬
{: .notice}



## 1. GKE í™˜ê²½ ì‹¤ìŠµ

### 1.1 Project ìƒì„±

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke1.png?raw=true" width="600" height="250"></p>

- ì‹ ê·œ projectë¥¼ ìƒì„±

<br>

### 1.2 Kubernetes Engine API ì„¤ì¹˜

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke2.png?raw=true" width="600" height="250"></p>

- ë©”ë‰´ > Kubernetes Engine
- ìƒì„±í•œ projectì— kubernetes engine api ì„¤ì¹˜
- ì‚¬ìš© ë²„íŠ¼ í´ë¦­
- ë„ˆë¬´ ì˜¤ë˜ ê¸°ë‹¤ë¦¬ë©´ ìƒˆë¡œê³ ì¹¨

<br>

### 1.3 í´ëŸ¬ìŠ¤í„° ìƒì„±

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke3.png?raw=true" width="600" height="250"></p>

- ë§Œë“¤ê¸° ë²„íŠ¼ í´ë¦­

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke4.png?raw=true" width="600" height="400"></p>

- STANDARD í´ëŸ¬ìŠ¤í„°ë¡œ ì „í™˜
- ì „í™˜ í›„ ë§Œë“¤ê¸° ë²„íŠ¼ í´ë¦­

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke5.png?raw=true" width="600" height="100"></p>

- í´ëŸ¬ìŠ¤í„° ìƒì„± ì¤‘

ğŸ“ **Note1. Standard vs Autopilot**

- Standard: ê°€ìƒë¨¸ì‹ (=ë…¸ë“œ) ìƒì„±
- Autopilot: ê°€ìƒë¨¸ì‹ (=ë…¸ë“œ) ì—†ì´ ì»¨í…Œì´ë„ˆë§Œìœ¼ë¡œ ì„œë¹„ìŠ¤ ì œê³µ, ì„œë²„ë¦¬ìŠ¤ ê°œë…

ğŸ“**Note2. ë¦¬ì „ vs ì˜ì—­**

- ë¦¬ì „: ë°ì´í„° ì„¼í„°ê°€ ìˆëŠ” ìœ„ì¹˜

- ì˜ì—­: ë°ì´í„° ì„¼í„°

  â˜ ë¦¬ì „ì€ ì—¬ëŸ¬ ì˜ì—­ì— ë°°ì¹˜í•˜ì—¬ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ë‚˜ ë¹„ìš© ë°œìƒ

ğŸ“ **Note3. ì œì–´ ì˜ì—­ ë²„ì „**

- ë²„ì „ì— ëŒ€í•œ ê´€ë¦¬ë¥¼ êµ¬ê¸€ì´í•˜ëƒ ë‚´ê°€ í•˜ëƒ ì°¨ì´

<br>

### 1.4 í´ëŸ¬ìŠ¤í„° ì‚¬ìš©

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke6.png?raw=true" width="600" height="250"></p>

- í´ë¼ìš°ë“œ ì‰˜ í™œì„±í™”
- í´ë¼ìš°ë“œ ì‰˜ì€ ì¼ì¢…ì˜ ê°€ìƒë¨¸ì‹ ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì— ì›ê²©ì ‘ì†í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- ì‰˜ì€ í´ëŸ¬ìŠ¤í„°ì™€ ê´€ê³„ ì—†ìœ¼ë©° ë³„ë„ì˜ VM

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke7.png?raw=true" width="600" height="200"></p>

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke8.png?raw=true" width="600" height="200"></p>

- ì—°ê²° ëª…ë ¹ì–´ í™•ì¸ ë° ì‹¤í–‰
- gcloud ëª…ë ¹ìœ¼ë¡œ ì ‘ì† ê¶Œí•œ ì¸ì¦

````
kubectl get nodes
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke9.png?raw=true" width="600" height="100"></p>

- kubectl: ë…¸ë“œì— ì ‘ê·¼
- get nodes: node ì •ë³´ ì–»ì–´ì˜´

<br>

### 1.5 ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

````
kubectl create deploy tc --image=consol/tomcat-7.0 --replicas=5
````

- `kubectl`: Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì»¤ë§¨ë“œë¼ì¸ íˆ´
- `create deploy`: ìƒˆë¡œìš´ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ëª…ë ¹ì–´
- `tc`: ìƒì„±ë  ë””í”Œë¡œì´ë¨¼íŠ¸ì˜ ì´ë¦„
- `--image=consol/tomcat-7.0`: ë””í”Œë¡œì´ë¨¼íŠ¸ì— ì‚¬ìš©ë  ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì§€ì •
- `--replicas=5`: ë””í”Œë¡œì´ë¨¼íŠ¸ì— ì˜í•´ ê´€ë¦¬ë  íŒŒë“œ(Pod)ì˜ ìˆ˜ë¥¼ ì§€ì •
- ì¦‰, `consol/tomcat-7.0` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ "tc"ë¼ëŠ” ì´ë¦„ì˜ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ìƒì„±í•˜ê³ , ì´ ë””í”Œë¡œì´ë¨¼íŠ¸ëŠ” 5ê°œì˜ ë³µì œë³¸ì„ ê°€ì§„ íŒŒë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•˜ë„ë¡ Kubernetesì— ìš”ì²­í•¨
- ì´ë¥¼ í†µí•´, Tomcat ì„œë²„ 5ê°œê°€ ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì„ êµ¬ì¶•

````
kubectl expose deploy tc --type=LoadBalancer --port=80 --target-port=8080
````

- ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“  ë‹¤ìŒ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¤ëŠ” ëª…ë ¹ì–´
- ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬ ë˜ì—ˆë”ë¼ë„ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•ŠìŒ

````
kubectl get pods,svc
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke10.png?raw=true" width="600" height="140"></p>

- svc: ì„œë¹„ìŠ¤ë¡œ í¬íŠ¸ë¥¼ ì™¸ë¶€ë¡œ ë…¸ì¶œì‹œí‚¤ëŠ” ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆìŒ
- 5ëŒ€ì˜ podê°€ ë„ì›Œì ¸ ìˆìŒ
- GCPì˜ LoadBalancerê°€ ê³µì¸ IPë¥¼ ìë™ìœ¼ë¡œ ë°›ì•„ì˜´
- ê³µì¸ IPì— ì ‘ì†í•˜ë©´ LoadBalancerê°€ íŠ¸ë˜í”½ì„ ë¶„ì‚°í•´ì¤Œ

````
kubectl get pods -owide
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke11.png?raw=true" width="800" height="130"></p>

- podë“¤ì´ ë°°í¬ëœ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆìŒ
- dq8w-2ëŒ€, f6v9-2ëŒ€, ntl9-1ëŒ€

<br>

### 1.6 ì‚­ì œ

- ë¹„ìš© ë¶€ê³¼ ë˜ì§€ ì•Šê²Œ ì‚­ì œ

<br>

## 2. VM í™˜ê²½ ì„¤ì¹˜ ê°€ì´ë“œ



### 2.0 ì²´í¬ë¦¬ìŠ¤íŠ¸

- í˜¸í™˜ë˜ëŠ” ë¦¬ëˆ…ìŠ¤ ë¨¸ì‹ : ë°ë¹„ì•ˆ, ë ˆë“œí–‡ ê¸°ë°˜
- í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë¨¸ì‹ ì— ê±¸ì¹œ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ì—°ê²°
- ëª¨ë“  ë…¸ë“œì— ëŒ€í•œ ê³ ìœ í•œ í˜¸ìŠ¤íŠ¸ ì´ë¦„, MAC ì£¼ì†Œ ë° product_uuid
- íŠ¹ì • í¬íŠ¸ ê°œë°©

<br>

### 2.1 VM ìƒì„±

- ë§ˆìŠ¤í„° ë…¸ë“œ 1ëŒ€/ ì›Œì»¤ ë…¸ë“œ 2ëŒ€
- ê°€ìƒë¨¸ì‹ ì€ 2CPU, 4GB ë©”ëª¨ë¦¬ ì‚¬ìš© í•„ìš” (ìµœì†Œì‚¬ì–‘)
- kubeletì´ ì œëŒ€ë¡œ ì‘ë™í•˜ê¸° ìœ„í•œ ìŠ¤ì™‘ì˜ ë¹„í™œì„±í™”

ğŸ“ **ìŠ¤ì™‘ì˜ ë¹„í™œì„±í™”**

- ìŠ¤ì™‘: ë©”ëª¨ë¦¬ì— ìˆëŠ” ì •ë³´ë¥¼ ì˜¤ë«ë™ì•ˆ ì“°ì§€ ì•Šì€ ê²½ìš° ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ ìœ„í•´ ë””ìŠ¤í¬ë¡œ ë³´ëƒ„
- ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì…ì¥ì—ì„œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê´€ë¦¬ê°€ íš¨ìœ¨ì ìœ¼ë¡œ ë˜ì§€ ì•ŠìŒ
- ë©”ëª¨ë¦¬ê°€ ì•ˆë‚¨ì•„ìˆëŠ”ë° ë©”ëª¨ë¦¬ê°€ ë‚¨ì•„ìˆëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì—¬ì§
- ë””ìŠ¤í¬ë¡œ ë‚´ë ¤ë„ ì‚¬ì‹¤ ë©”ëª¨ë¦¬ì—ëŠ” ìˆë‹¤ê³  ë´ì•¼í•¨

âœï¸ **ëª¨ë“  ë…¸ë“œì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰**

```
sudo swapoff -a # í˜„ì¬ ì‹œìŠ¤í…œì— ì ìš©
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab # ë¦¬ë¶€íŒ… í•„ìˆ˜
```

<br>

### 2.2 ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ì„¤ì¹˜

- [ì„¤ì¹˜ ìë£Œ ì°¸ê³ ](https://www.itzgeek.com/how-tos/linux/ubuntu-how-tos/install-containerd-on-ubuntu-22-04.html)
- kubelet: ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜ì‹œ ê°™ì´ ì„¤ì¹˜ë˜ëŠ” ë°ëª¬ìœ¼ë¡œ containerdë¥¼ ì œì–´í•¨
  - ì´ì „ì—ëŠ” dockerë¡œ containerdë¥¼ ì œì–´í–ˆìŒ
- v 1.26 ë¶€í„°ëŠ” í˜¸í™˜ì„± ë¬¸ì œê°€ ìˆì–´ kubeletê³¼ containerdë¥¼ ë”°ë¡œ ì„¤ì¹˜

```
sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list
```

- Using Docker Repository

```
sudo apt update
sudo apt install -y containerd.io
```

- Install Containerd

```
sudo systemctl status containerd # Ctrl + cë¥¼ ëˆŒëŸ¬ì„œ ë‚˜ê°„ë‹¤.
```

- ì„¤ì¹˜ í™•ì¸

```
cat <<EOF | sudo tee -a /etc/containerd/config.toml
[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
SystemdCgroup = true
EOF
```

- Containerd configuration for Kubernetes

```
sudo sed -i 's/^disabled_plugins \=/\#disabled_plugins \=/g' /etc/containerd/config.toml
sudo systemctl restart containerd
```

- containerd ì‹¤í–‰

```
ls /var/run/containerd/containerd.sock
```

- ì†Œì¼“ì´ ìˆëŠ”ì§€ í™•ì¸

<br>

### 2.3 ì¿ ë²„ë„¤í‹°ìŠ¤

- [ì„¤ì¹˜ ìë£Œ ì°¸ê³ ](https://kubernetes.io/ko/docs/setup/production-environment/tools/kubeadm/install-kubeadm/)
- ìœ„ ì‚¬ì´íŠ¸ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¤í–‰

```
cat <<EOF > kube_install.sh
# /etc/apt/keyrings í´ë” ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬
sudo mkdir -p -m 755 /etc/apt/keyrings

# 1. apt íŒ¨í‚¤ì§€ ìƒ‰ì¸ì„ ì—…ë°ì´íŠ¸í•˜ê³ , ì¿ ë²„ë„¤í‹°ìŠ¤ apt ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë° í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl gpg

# 2. êµ¬ê¸€ í´ë¼ìš°ë“œì˜ ê³µê°œ ì‚¬ì´ë‹ í‚¤ë¥¼ ë‹¤ìš´ë¡œë“œ í•œë‹¤.
sudo curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

# 3. ì¿ ë²„ë„¤í‹°ìŠ¤ apt ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

# 4. apt íŒ¨í‚¤ì§€ ìƒ‰ì¸ì„ ì—…ë°ì´íŠ¸í•˜ê³ , kubelet, kubeadm, kubectlì„ ì„¤ì¹˜í•˜ê³  í•´ë‹¹ ë²„ì „ì„ ê³ ì •í•œë‹¤.
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
EOF
```

- kubernetes ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

```
sudo bash kube_install.sh
kubeadm version # ë²„ì „ í™•ì¸
```

- kubenetes ì„¤ì¹˜



ğŸ“ **kubectl**

- **kubectl**ì€ Kubernetes í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•œ ì»¤ë§¨ë“œ ë¼ì¸ ì¸í„°í˜ì´ìŠ¤(CLI) ë„êµ¬ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” kubectlì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•˜ê³ , í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°íšŒí•˜ë©°, í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. kubectl ëª…ë ¹ì€ Kubernetes API ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ì´ëŸ¬í•œ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- ì˜ˆ: íŒŒë“œ ìƒì„±, ì„œë¹„ìŠ¤ ì¡°íšŒ, ë¡œê·¸ í™•ì¸ ë“±ì˜ ì‘ì—…ì„ kubectlì„ í†µí•´ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“ **kubeadm**

- **kubeadm**ì€ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ ì‰½ê²Œ ë¶€íŠ¸ìŠ¤íŠ¸ë©(ì´ˆê¸° ì„¤ì •)í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. kubeadm initê³¼ kubeadm join ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ê±°ë‚˜, ê¸°ì¡´ í´ëŸ¬ìŠ¤í„°ì— ë…¸ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. kubeadmì€ í´ëŸ¬ìŠ¤í„°ì˜ ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ êµ¬ì„±, ì¸ì¦ì„œ ìƒì„± ë° ë°°í¬, kubeconfig íŒŒì¼ ì„¤ì •, ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì˜ ì„¤ì¹˜ ë“± í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì— í•„ìš”í•œ ë‹¤ì–‘í•œ ì‘ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- ì˜ˆ: kubeadm initìœ¼ë¡œ ìƒˆ í´ëŸ¬ìŠ¤í„°ì˜ ë§ˆìŠ¤í„° ë…¸ë“œë¥¼ ì„¤ì •í•˜ê³ , kubeadm joinìœ¼ë¡œ ì›Œì»¤ ë…¸ë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ì¶”ê°€í•©ë‹ˆë‹¤.

ğŸ“ **kubelet**

- **kubelet**ì€ ëª¨ë“  Kubernetes ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤. kubeletì€ ê° ë…¸ë“œì— í• ë‹¹ëœ íŒŒë“œ(Pods)ë¥¼ ê´€ë¦¬í•˜ë©°, ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ê³¼ í†µì‹ í•˜ì—¬ íŒŒë“œì˜ ì»¨í…Œì´ë„ˆê°€ ì˜¬ë°”ë¥´ê²Œ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. kubeletì€ ì£¼ê¸°ì ìœ¼ë¡œ Kubernetes API ì„œë²„ë¡œë¶€í„° ê° ë…¸ë“œì— í• ë‹¹ëœ íŒŒë“œì— ëŒ€í•œ ì •ë³´ë¥¼ ë°›ì•„, íŒŒë“œì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ ì¤‘ì§€í•˜ê³ , íŒŒë“œ ìƒíƒœë¥¼ API ì„œë²„ì— ë³´ê³ í•©ë‹ˆë‹¤.
- ì˜ˆ: íŒŒë“œ ìŠ¤í™(PodSpec)ì— ë”°ë¼ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ê³ , íŒŒë“œì˜ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

<br>

### 2.4 ë„·í•„í„° ë¸Œë¦¿ì§€ ì„¤ì •

- ë„·í•„í„° ë¸Œë¦¿ì§€ê°€ ì»¨í…Œì´ë„ˆê°„ ë„¤íŠ¸ì›Œí¬ í†µì‹  ìˆ˜í–‰ â˜ í™œì„±í™” ì‹œì¼œì•¼í•¨
- docker.ioëŠ” ìë™ìœ¼ë¡œ í™œì„±í™”ë˜ë‚˜ containerdë¥¼ ì§ì ‘ ì„¤ì¹˜í•˜ê¸° ë•Œë¬¸ì— í™œì„±í™” ì‹œì¼œì•¼í•¨

```
sudo -i
modprobe br_netfilter
echo 1 > /proc/sys/net/ipv4/ip_forward
echo 1 > /proc/sys/net/bridge/bridge-nf-call-iptables
exit
```

- ìœ„ ëª…ë ¹ì–´ëŠ” Linux ì‹œìŠ¤í…œì—ì„œ NAT(ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜)ë¥¼ ì„¤ì •í•˜ëŠ”ë° ì‚¬ìš©

ğŸ“**NAT**

- ë‹¨ì¼ ê³µìš© IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•´ ì—¬ëŸ¬ ì¥ì¹˜ë¥¼ ì¸í„°ë„·ì— ì—°ê²°
- modprobe: ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒê³¼ Linux ë¸Œë¦¬ì§€ ê°„ì— íŒ¨í‚·ì„ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ì»¤ë„ ëª¨ë“ˆ ë¡œë“œ

<br>

### 2.5 ë§ˆìŠ¤í„° ë…¸ë“œ ì´ˆê¸°í™”

- ë‹¤ë¥¸ ë…¸ë“œë“¤ì´ í´ëŸ¬ìŠ¤í„°ì— ì°¸ì—¬í•  ìˆ˜ ìˆë„ë¡ ì œì•ˆí•  ìˆ˜ ìˆìŒ
- initì‹œì— tokenì´ ë°œí–‰ë˜ê³ , ì´ë¥¼ ë‹¤ë¥¸ ë…¸ë“œë“¤ì—ê²Œ ì „ë‹¬ ê°€ëŠ¥
- tokenì„ ë°›ì€ ë…¸ë“œëŠ” í´ëŸ¬ìŠ¤í„°ì— join í•  ìˆ˜ ìˆìŒ
- tokenì— ë”°ë¼ master/worker ë“± ì°¨ì´ê°€ ìˆìŒ

````
sudo kubeadm init
````

<br>

### 2.6 í´ëŸ¬ìŠ¤í„° ì‚¬ìš© ì´ˆê¸° ì„¸íŒ… (ë§ˆìŠ¤í„° ë…¸ë“œ)

```
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

- ë§ˆìŠ¤í„° ë…¸ë“œ ì´ˆê¸°í™”ì‹œ ì‚¬ìš©ì ì„¸íŒ… ëª…ë ¹ì–´ ì‚¬ìš©

<br>

### 2.7 ì›Œì»¤ ë…¸ë“œ ì¶”ê°€

```
sudo kubeadm join [ip:port] --token [token] --discovery-token-ca-cert-hash sha256:[sha256]
```

- ë§ˆìŠ¤í„° ë…¸ë“œ ì´ˆê¸°í™”ì‹œ join ëª…ë ¹ì–´ ë³µë¶™í•˜ì—¬ ì›Œì»¤ ë…¸ë“œì—ì„œ ì‹¤í–‰



ğŸ“**ë…¸ë“œ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì ê²€**

```
sudo kubeadm reset
```

- initì´ë‚˜ joinì„ ì˜ëª» ìˆ˜í–‰í•œ ê²½ìš° ì´ˆê¸° ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°

```
sudo kubeadm token list
sudo kubeadm token create --print-join-command
```

- token list í™•ì¸ ë°  ì¬ë°œê¸‰ (ë§ˆìŠ¤í„° ë…¸ë“œ ì‹¤í–‰)

<br>

### 2.8 ì—°ê²°ëœ ë…¸ë“œë“¤ì˜ ìƒíƒœ í™•ì¸

```
kubectl get nodes
```

- ì²˜ìŒì—ëŠ” NotReady ìƒíƒœ
- ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ êµ¬ë™ë˜ê¸° ìœ„í•´ì„œëŠ” ì»¨í…Œì´ë„ˆë¼ë¦¬ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•˜ëŠ” plug-inì´ í•„ìš”

<br>

### 2.9 Pod ë„¤íŠ¸ì›Œí¬ ë°°í¬

- ì•ì„œ êµ¬ì„±í•œ ìœ ì € ì„¤ì •ì„ í†µí•´ í´ëŸ¬ìŠ¤í„°ì— cilium ì„¤ì¹˜
- [ì„¤ì¹˜ ì°¸ê³  ìë£Œ](https://kubernetes.io/docs/tasks/administer-cluster/network-policy-provider/cilium-network-policy/)
- ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ì‹¤í–‰

```
curl -LO https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz
sudo tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin
rm cilium-linux-amd64.tar.gz
cilium install
```

- ëª¨ë“  ë…¸ë“œë“¤ ìƒíƒœê°€ Readyë¡œ ë³€ê²½



ğŸ“**Cilium**

Ciliumì€ CNIë¡œ Linux ì»¨í…Œì´ë„ˆ ê´€ë¦¬ í”Œë«í¼ì„(Docker, Kubernetes) ì‚¬ìš©í•˜ì—¬ ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ê°„ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ë³´í˜¸í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì…ë‹ˆë‹¤. 



ğŸ“ **CNI**

[CNI](https://github.com/containernetworking/cni)ëŠ” ì»¨í…Œì´ë„ˆê°„ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ëœ»í•©ë‹ˆë‹¤. ìš”ì•½í•˜ìë©´, ë¬¼ë¦¬ í™˜ê²½ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬, Container Runtimeì—ì„œ Containerê°„ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ê²Œ ë„ì™€ì£¼ëŠ” ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤. 



<br>

## 3. On-prem ë°°í¬ ì‹¤ìŠµ

### 3.1 VM ìƒì„±

[Image vm2]

- ì´ë¦„: master-1, worker-1, worker-2
- ë¦¬ì „: us-west1
- ì˜ì—­: us-west1-b

[Image vm3]

- ë¶€íŒ… ë””ìŠ¤í¬ ì„¤ì •

### 3.2 ë…¸ë“œ ì ‘ì†

- SSHë¥¼ ì‚¬ìš©í•œ ì ‘ì†

### 3.3 ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸

- pingì„ í†µí•´ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸
- ë‚´ë¶€ IPë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
- ì™¸ë¶€ IPëŠ” ë°©í™”ë²½ìœ¼ë¡œ ì ‘ê·¼ ë¶ˆê°€

### 3.4 VM í™˜ê²½ ì„¤ì •

### 3.5 ë°°í¬ í…ŒìŠ¤íŠ¸

```
kubectl create deploy tc --image=consol/tomcat-7.0 --replicas=5
```

- ìœ„ì™€ ë™ì¼

```
kubectl expose deploy tc --type=NodePort --port=80 --target-port=8080
```

- typeì„ NodePortë¡œ ì§€ì •
- LoadBalancer ê¸°ëŠ¥ì€ ì—†ìŒ

```
kubectl get pod,svc
```

- í¬íŠ¸ í™•ì¸ í›„ ê° ë…¸ë“œë“¤ì— ëŒ€í•´ ì ‘ì†







