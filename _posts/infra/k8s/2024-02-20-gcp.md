---
layout: single
title:  'k8s (2) GCP를 사용한 쿠버네티스 실습'
toc: true
categories: [K8S]
tags: [GCP, GKE, Onprem Kubernetes]
---

## 1. GKE 환경 실습

### 1.1 Project 생성

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke1.png?raw=true" width="600" height="250"></p>

- 신규 project를 생성

<br>

### 1.2 Kubernetes Engine API 설치

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke2.png?raw=true" width="600" height="250"></p>

- 메뉴 > Kubernetes Engine
- 생성한 project에 kubernetes engine api 설치
- 사용 버튼 클릭
- 너무 오래 기다리면 새로고침

<br>

### 1.3 클러스터 생성

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke3.png?raw=true" width="600" height="250"></p>

- 만들기 버튼 클릭

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke4.png?raw=true" width="600" height="400"></p>

- STANDARD 클러스터로 전환
- 전환 후 만들기 버튼 클릭

📍 **Standard vs Autopilot**

- Standard: 가상머신(=노드) 생성
- Autopilot: 가상머신(=노드) 없이 컨테이너만으로 서비스 제공, 서버리스 개념

📍**리전 vs 영역**

- 리전: 데이터 센터가 있는 위치

- 영역: 데이터 센터

  ☞ 리전은 여러 영역에 배치하여 가용성을 보장하나 비용 발생

📍 **제어 영역 버전**

- 버전에 대한 관리를 구글이하냐 내가 하냐 차이

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke5.png?raw=true" width="600" height="100"></p>

- 클러스터 생성 중

<br>

### 1.4 클러스터 사용

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke6.png?raw=true" width="600" height="250"></p>

- 클라우드 쉘 활성화
- 클라우드 쉘은 일종의 가상머신으로 클러스터에 원격접속하기 위해 사용
- 쉘은 클러스터와 관계 없으며 별도의 VM

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke7.png?raw=true" width="600" height="200"></p>

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke8.png?raw=true" width="600" height="200"></p>

- 연결 명령어 확인 및 실행
- gcloud 명령으로 접속 권한 인증

````
kubectl get nodes
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke9.png?raw=true" width="600" height="100"></p>

- kubectl: 노드에 접근
- get nodes: node 정보 얻어옴

<br>

### 1.5 애플리케이션 배포

````
kubectl create deploy tc --image=consol/tomcat-7.0 --replicas=5
````

- 배포 명령어

````
kubectl expose deploy tc --type=LoadBalancer --port=80 --target-port=8080
````

- 컨테이너를 만든 다음 외부에 노출시키는 명령어
- 쿠버네티스에 배포 되었더라도 외부에 노출되지 않음

````
kubectl get pods,svc
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke10.png?raw=true" width="600" height="140"></p>

- svc: 서비스로 포트를 외부로 노출시키는 기능을 가지고 있음
- 5대의 pod가 띄워져 있음
- GCP의 LoadBalancer가 공인 IP를 자동으로 받아옴
- 공인 IP에 접속하면 LoadBalancer가 트래픽을 분산해줌

````
kubectl get pods -owide
````

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/gcp_practice/gke11.png?raw=true" width="800" height="110"></p>

- pod들이 배포된 정보를 알 수 있음
- dq8w-2대, f6v9-2대, ntl9-1대

<br>

### 1.6 삭제

- 비용 부과 되지 않게 삭제

<br>

## 2. OnPrem 환경 실습



