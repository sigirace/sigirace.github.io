---
layout: single
title:  'k8s (3) Pod ì •ë¦¬'
toc: true
categories: [K8S]
tags: [Pod]

---

[ë°ë¸Œì˜µìŠ¤(DevOps)ë¥¼ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§ˆìŠ¤í„°](https://www.inflearn.com/course/%EB%8D%B0%EB%B8%8C%EC%98%B5%EC%8A%A4-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A7%88%EC%8A%A4%ED%84%B0/dashboard) ê°•ì˜ ì •ë¦¬
{: .notice}



## 1. Pod

### 1.1 ì†ì„±

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/pod/pod1.png?raw=true" width="600" height="200"></p>

- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ê°œë³„ì ìœ¼ë¡œ ë°°í¬í•˜ì§€ ì•Šê³  ì»¨í…Œì´ë„ˆì˜ í¬ë“œë¥¼ ë°°í¬ ë° ìš´ì˜
- ì¼ë°˜ì ìœ¼ë¡œ í¬ë“œëŠ” ë‹¨ì¼ ì»¨í…Œì´ë„ˆë§Œ í¬í•¨í•˜ì§€ë§Œ ë‹¤ìˆ˜ì˜ ì»¨í…Œì´ë„ˆ í¬í•¨ ê°€ëŠ¥
  - ìŠ¤ì¼€ì¼ë§ì„ ìœ„í•´ ë‹¨ì¼ ì»¨í…Œì´ë„ˆë¥¼ ê¶Œì¥
  - ë‘ê°€ì§€ì˜ ì»¨í…Œì´ë„ˆê°€ ë°€ì ‘í•œ ê´€ê³„ì¼ ê²½ìš°ì—ë§Œ í•œ í¬ë“œì— ë„£ìŒ

- ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì³ì„œ ìƒì„±ë˜ì§€ ì•Šê³  ë‹¨ì¼ ë…¸ë“œì—ì„œë§Œ ìƒì„± ë° ì‹¤í–‰
- ë‹¤ìˆ˜ ì»¨í…Œì´ë„ˆì¼ ê²½ìš° ì»¨í…Œì´ë„ˆê°„ ìì› ê³µìœ  ê°€ëŠ¥

<br>

### 1.2 ì¥ì 

- ì—°ê´€ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ í•˜ë‚˜ì˜ í™˜ê²½ì—ì„œ ë™ì‘í•˜ëŠ” ê²ƒì²˜ëŸ¼ í•¨ê»˜ ì‹¤í–‰
- ê·¸ëŸ¬ë‚˜ ë‹¤ì†Œ ê²©ë¦¬ëœ ìƒíƒœë¡œ ìœ ì§€

<br>

### 1.3 ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/pod/pod2.png?raw=true" width="600" height="200"></p>

- podê°€ í• ë‹¹ë°›ì€ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ëŒ€ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” í˜•íƒœ
  - í´ëŸ¬ìŠ¤í„°ì—ì„œ ê° podëŠ” ê³ ìœ í•œ IPë¥¼ í• ë‹¹ ë°›ìŒ
  - pod IP ì£¼ì†ŒëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ ì‚¬ì „ ì •ì˜ëœ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ëŒ€ì—ì„œ í• ë‹¹ ë¨

- NAT ê²Œì´íŠ¸ì›¨ì´ê°€ ë”°ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
  - k8s ë„¤íŠ¸ì›Œí¬ í•µì‹¬ ì›ì¹™ ì¤‘ í•˜ë‚˜ëŠ” ëª¨ë“  podê°€ ì„œë¡œë¥¼ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ëŠ” ê²ƒ
  - ë”°ë¼ì„œ VMì´ë‚˜ ë¬¼ë¦¬ì  ë„¤íŠ¸ì›Œí¬ì—ì„œ í”íˆ ë³¼ ìˆ˜ ìˆëŠ” NAT ê²Œì´íŠ¸ì›¨ì´ê°€ í•„ìš”í•˜ì§€ ì•ŠìŒ

- ì™¸ë¶€ì—ì„œ í•´ë‹¹ IPë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë©° ì„œë¹„ìŠ¤ë¼ëŠ” ê°ì²´ë¥¼ ìƒì„±í•´ì•¼í•¨
  - podëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ë¼ìš°íŒ… ë  ìˆ˜ ìˆìŒ
  - í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ

<br>


### 1.4 Yaml íŒŒì¼ êµ¬ì„±ìš”ì†Œ

- apiVersion: ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ api ê°€ ì¼ì¹˜í•´ì•¼ í†µì‹  ê°€ëŠ¥ ì¼ì¢…ì˜ í”„ë¡œí† ì½œ
<<<<<<< HEAD:_posts/infra/k8s/pod.md
- kind: ë¦¬ì†ŒìŠ¤ì˜ ìœ í˜• ê²°ì • (pod, replica, service ...) 
- ë©”íƒ€ë°ì´í„°: apiversionê³¼ kindë¥¼ ë§Œë“¤ ë•Œ, ì–´ë–¤ ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìƒì„±í•  ê²ƒì¸ì§€ ì •ì˜
- ìŠ¤í™: ì–´ë–¤ ì»¨í…Œì´ë„ˆë¥¼ ë°°ì¹˜í•˜ê³  ë³¼ë¥¨ì„ ì„¤ì •í•˜ê³  ë“±ë“± ìì„¸í•œ ì •ë³´
- ìŠ¤í…Œì´í„°ìŠ¤: í¬ë“œì˜ ì¼ë°˜ì ì¸ ìƒíƒœ ì™¸ì— ê¸°ë³¸ì •ë³´ ê°™ì€ ê²ƒì´ ë“¤ì–´ê°€ ìˆìŒ, ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ í•´ì£¼ëŠ” ê²ƒ

=======
- kind: ë¦¬ì†ŒìŠ¤ì˜ ìœ í˜• ê²°ì • (pod, replica, service ...)
- metadata: apiversionê³¼ kindë¥¼ ë§Œë“¤ ë•Œ, ì–´ë–¤ ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìƒì„±í•  ê²ƒì¸ì§€ ì •ì˜
- spec: ì–´ë–¤ ì»¨í…Œì´ë„ˆë¥¼ ë°°ì¹˜í•˜ê³  ë³¼ë¥¨ì„ ì„¤ì •í•˜ê³  ë“±ë“± ìì„¸í•œ ì •ë³´
- status: í¬ë“œì˜ ì¼ë°˜ì ì¸ ìƒíƒœ ì™¸ì— ê¸°ë³¸ì •ë³´ ê°™ì€ ê²ƒì´ ë“¤ì–´ê°€ ìˆìŒ, ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ í•´ì£¼ëŠ” ê²ƒ
>>>>>>> refs/remotes/origin/master:_posts/infra/k8s/2024-03-07-pod.md

<br>

ğŸ“ **ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜**

- **Pod (íŒŒë“œ)**: ì¿ ë²„ë„¤í‹°ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ì ì¸ ë¹Œë”© ë¸”ë¡ìœ¼ë¡œ, í•˜ë‚˜ ì´ìƒì˜ ì»¨í…Œì´ë„ˆê°€ í¬í•¨ëœ ê·¸ë£¹ì…ë‹ˆë‹¤. íŒŒë“œëŠ” ìŠ¤ì¼€ì¼ë§, ë„¤íŠ¸ì›Œí‚¹, ìŠ¤í† ë¦¬ì§€ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.
- **Service (ì„œë¹„ìŠ¤)**: íŒŒë“œ ì§‘í•©ì— ëŒ€í•œ ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ëŠ” íŒŒë“œì— ë„ë‹¬í•˜ê¸° ìœ„í•œ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œì˜ ê³ ì • IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ì •ì˜í•˜ë©°, ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ì œê³µí•©ë‹ˆë‹¤.
- **ReplicaSet (ë ˆí”Œë¦¬ì¹´ì…‹)**: ì§€ì •ëœ ìˆ˜ì˜ íŒŒë“œ ë³µì œë³¸ì´ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ReplicaSetì€ íŒŒë“œì˜ ìŠ¤ì¼€ì¼ë§ê³¼ ì¥ì•  ë³µêµ¬ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
- **Deployment (ë””í”Œë¡œì´ë¨¼íŠ¸)**: íŒŒë“œì™€ ReplicaSetì˜ ì„ ì–¸ì  ì—…ë°ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°°í¬, ë¡¤ë°±, ì—…ë°ì´íŠ¸ë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

ğŸ“ **ì„œë¹„ìŠ¤ ìœ í˜•**

- **ClusterIP**: ê¸°ë³¸ ì„œë¹„ìŠ¤ ìœ í˜•ìœ¼ë¡œ, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë‚´ë¶€ IPë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- **NodePort**: í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì— íŠ¹ì • í¬íŠ¸ë¥¼ ê°œë°©í•˜ê³ , ì´ í¬íŠ¸ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œë„ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **LoadBalancer**: í´ë¼ìš°ë“œ ì œê³µì—…ì²´ì˜ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ì— ì™¸ë¶€ IP ì£¼ì†Œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì—ì„œ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¸ë˜í”½ì„ ìë™ìœ¼ë¡œ íŒŒë“œì— ë¶„ì‚°ì‹œí‚µë‹ˆë‹¤.

<br>

### 1.5 Pod ì‹¤ìŠµ

```
cd ~
mkdir yaml
cd yaml
```

- YAML íŒŒì¼ ì €ì¥ì†Œ ì„¤ì •

```
vi go-http-pod.yaml
```

- yaml íŒŒì¼ ìƒì„±

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: http-go
  labels:
    app: http-go
spec:
  containers:
  - name: http-go
    image: gasbugs/http-go
    ports:
    - containerPort: 8080
```

- pod yaml descriptor

```
kubectl create -f go-http-pod.yaml
```

- íŒŒì¼ì— ì •ì˜ëœ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±

```
kubectl get pod http-go
kubectl get pod http-go -o wide
```

- ìƒì„± í™•ì¸

```
kubectl annotate pod http-go test1234=test1234
```

- ì£¼ì„ìƒì„±

```
kubectl delete -f go-http-pod.yaml
```

- ì‚­ì œ

```
kubectl delete pod --all
```

- ëª¨ë‘ì‚­ì œ

<br>

## 2. Probe

### 2.1 ì†ì„±

- ê°ê°ì˜ ê¸°ëŠ¥ë“¤ì´ í¬ë“œë¥¼ ë³´ì¡°í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰
- í¬ë“œ ë‚´ë¶€ì— ì„¤ì •íŒŒì¼ ì‘ì„±

<br>

### 2.2 Liveness Probe

- ì‚´ì•„ìˆëŠ”ì§€ íŒë‹¨í•˜ê³  ì‚´ì•„ìˆì§€ ì•Šë‹¤ë©´ ë‹¤ì‹œ ì‹œì‘ â˜ ê°€ìš©ì„±

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: liveness
  name: liveness-exec
spec:
  containers:
  - name: liveness
    image: registry.k8s.io/busybox
    args:
    - /bin/sh
    - -c
    - touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600
    livenessProbe:
      exec:
        command:
        - cat
        - /tmp/healthy
      initialDelaySeconds: 5
      periodSeconds: 5
```

<br>

### 2.3 Readiness Probe

- í¬ë“œê°€ ì¤€ë¹„ëœ ìƒíƒœì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì •ìƒ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘
- í¬ë“œê°€ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œë“œë°¸ëŸ°ì‹±ì„ í•˜ì§€ ì•ŠìŒ
  - ì„œë¹„ìŠ¤ê°€ í¬ë“œë¡œ ë¡œë“œë°¸ëŸ°ì‹±ì„ í• í…ë° ë ˆë””ë‹ˆìŠ¤ ì²´í¬ í›„ ë¡œë“œë°¸ëŸ°ì‹± ë¦¬ìŠ¤íŠ¸ ìƒì„±

```yaml
readinessProbe:
  exec:
    command:
    - cat
    - /tmp/healthy
  initialDelaySeconds: 5
  periodSeconds: 5
```

<br>

### 2.4 Startup Probe

- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œê¸°ë¥¼ í™•ì¸í•´ì„œ ê°€ìš©ì„±ì„ ë†’ì„
- Livenessì™€ Readinessë¥¼ ë¹„í™œì„±í™”í•˜ê³  ì»¨í…Œì´ë„ˆê°€ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ì‹œê°„ì„ ë²Œì–´ì¤Œ

<br>

### 2.5 ì°¸ê³  ì‚¬ì´íŠ¸

- [ì˜ë¬¸ ê°€ì´ë“œ](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
- [Pod ë¼ì´í”„ì‚¬ì´í´](https://kubernetes.io/ko/docs/concepts/workloads/pods/pod-lifecycle/)

<br>

## 3. ë ˆì´ë¸”ê³¼ ì…€ë ‰í„°

- ëª¨ë“  ì„œë¹„ìŠ¤ì— ë ˆì´ë¸”ê³¼ ì…€ë ‰í„° ì—†ì´ëŠ” ëŒì•„ê°ˆ ìˆ˜ ì—†ìŒ

<br>

### 3.1 ë ˆì´ë¸”

- ë¦¬ì†ŒìŠ¤ì˜ ëª©ì ì— ë”°ë¼ ê²€ìƒ‰ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ ë¨
  - ë‹¤ìˆ˜ì˜ ë ˆì´ë¸”ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ
  - ë§Œë“œëŠ” ì‹œì ì— ë ˆì´ë¸”ì„ ì²¨ë¶€í•˜ë‚˜ ìˆ˜ì •, ì¶”ê°€ ê°€ëŠ¥
- ë¦¬ì†ŒìŠ¤ì— í‚¤/ê°’ ìŒìœ¼ë¡œ ì²¨ë¶€í•˜ì—¬ ì‚¬ìš© ex) app:test
- ì²´ê³„ì ì¸ ì‹œìŠ¤í…œ êµ¬ì¶•
  - app: ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±ìš”ì†Œ, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ìœ í˜• ì§€ì •
  - rel: ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ ì§€ì • (release, ë²„ì „)

<br>

ğŸ“ **í¬ë“œ ìƒì„± ì‹œ ë ˆì´ë¸” ì§€ì • ì˜ˆì‹œ**

- metadataì˜ labelsì— ì§€ì • > ì—¬ëŸ¬ê°œ ê°€ëŠ¥

```
metadata:
	name: app_name
	labels:
		key1: value1
		key2: value2
```

<br>

### 3.2 ë ˆì´ë¸” ë° ì…€ë ‰í„° ëª…ë ¹ì–´

```
kubectl label pod [name] [key]=[value]
```

- ë ˆì´ë¸”ì„ ì¶”ê°€ ë° ìˆ˜ì •

```
kubectl label pod [name] [key]=[value] --overite
```

- ê¸°ì¡´ ë ˆì´ë¸” ìˆ˜ì •

```
kubectl label pod [name] [key]-
```

- ë ˆì´ë¸” ì‚­ì œ

```
kubectl get pod --show-lables
```

- ë ˆì´ë¸” í™•ì¸

```
kubectl get pod -L [key1],[key2]
```

- íŠ¹ì • ë ˆì´ë¸” ì»¬ëŸ¼ìœ¼ë¡œ í™•ì¸

```
kubectl get pod --show-lables -l ['key']
kubectl get pod --show-lables -l ['key' = or != 'value']
```

- í•„í„°ë§í•˜ì—¬ ê²€ìƒ‰

<br>

### 3.3 ì°¸ê³  ì‚¬ì´íŠ¸

- [ë ˆì´ë¸” ë°°ì¹˜ ì „ëµ](https://cast.ai/blog/kubernetes-labels-expert-guide-with-10-best-practices/)

<br>

## 4. Replication Controller

### 4.1 ì†ì„±

- replicasetì˜ êµ¬ë²„ì „ (v1.8 ì´ì „)
- í¬ë“œê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ ê°ì‹œí•˜ê³ , ì¥ì• ê°€ ë‚¬ë‹¤ë©´ ì¬ìƒì„±
- ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ì‹¤ì œ í¬ë“œìˆ˜ê°€ ì›í•˜ëŠ” í¬ë“œìˆ˜ì™€ ë§ëŠ”ì§€ ì²´í¬

<br>

ğŸ“ **Controller**

- ì»¨í…Œì´ë„ˆë¥¼ ê°ì‹œí•˜ê³  Podì˜ ìˆ˜ë¥¼ ë³´ì¥í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰
- Replication Controller, Replica Set, Deployment

<br>

ğŸ“**Controller ì—­í• **

- Auto Healing: Pod ë˜ëŠ” Nodeì— ë¬¸ì œê°€ ìƒê²¼ì„ ëŒ€ ìë™ ë³µêµ¬
- Software Update: Podë¥¼ ì—…ë°ì´íŠ¸ ë° ë¡¤ë°±í•˜ëŠ” ê¸°ëŠ¥ â˜ Deploymentë§Œ ì§€ì›
- Auto Scaling: Podì˜ ë¦¬ì†ŒìŠ¤ê°€ ë¶€ì¡±í•  ë•Œ, Podë¥¼ ì¶”ê°€ ìƒì„±
- Job: ì¼ì‹œì ì¸ ì‘ì—…ì„ ìœ„í•´ í•„ìš”í•œ ìˆœê°„ì—ë§Œ Podë¥¼ ë§Œë“¤ì—ˆë‹¤ê°€ ì‚­ì œ ex) cron job

<br>

### 4.2 êµ¬ì„± ìš”ì†Œ

- ë ˆì´ë¸” ì…€ë ‰í„°: í¬ë“œì˜ ë²”ìœ„ë¥¼ ê²°ì • â˜ ì–´ë–¤ ë ˆì´ë¸”ì„ ê°€ì§„ podë¥¼ ë³µì œí•  ê²ƒì¸ê°€
- ë³µì œë³¸ ìˆ˜: í¬ë“œì˜ ë³µì œ ìˆ˜ë¥¼ ê²°ì •
- í¬ë“œ í…œí”Œë¦¿: í¬ë“œì˜ ëª¨ì–‘ì„ ì„¤ëª…, í¬ë“œì˜ ì •ë³´

<br>

### 4.3 ì¥ì 

- í¬ë“œê°€ ì—†ëŠ” ê²½ìš° ìƒˆ í¬ë“œë¥¼ ì‹¤í–‰
- ë…¸ë“œ ì¥ì•  ë°œìƒì‹œ ë‹¤ë¥¸ ë…¸ë“œì— ë³µì œë³¸ ìƒì„±
- ìˆ˜ë™, ìë™ìœ¼ë¡œ ìˆ˜í‰ ìŠ¤ì¼€ì¼ë§

<br>

### 4.4 Replication Controller ì‹¤ìŠµ

```yaml
# replication.yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    app: nginx
  template:
    metadata:
      name: nginx
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
```

- podì˜ í…œí”Œë¦¿ì´ ê°€ì§€ê³  ìˆëŠ” labelê³¼ ì…€ë ‰í„° ë¶€ë¶„ì˜ labelì´ ë™ì¼í•´ì•¼í•¨

```
kubectl create -f replication.yaml
```

- replication controller ìƒì„±

```
kubectl get pod
```

- ìƒì„± í™•ì¸

```
kubectl delete pod [pod_name]
kubectl get pod
```

- ì‚­ì œ í›„ rcì— ì˜í•´ ì‹ ê·œ íŒŒë“œ ìƒì„± í™•ì¸

```
kubectl label pod [pod_name] app-
kubectl get pod
```

- ë¼ë²¨ ì‚­ì œ ë° rcì— ì˜í•´ ì‹ ê·œ íŒŒë“œ ìƒì„± í™•ì¸

```
kubectl get pod -o wide
```

- Node í™•ì¸

```
kubectl get nodes -w
```

- ğŸ˜— worker2ë¥¼ ì •ì§€ ì‹œì¼œë³´ì
- ë…¸ë“œì˜ ìƒíƒœê°€ Readyë¡œ ë³€ê²½

```
kubectl get pod -w
```

- 5ë¶„ í›„ì— ë³€ê²½ì‚¬í•­ ë°˜ì˜ë¨
- ì»¨í…Œì´ë„ˆë¥¼ ë¹ ë¥´ê²Œ ë°˜ì‘í•˜ë©´ ìì› ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸°ì— ì‹œê°„ í…€ì„ ë‘ 
- 5ë¶„ ë’¤ì— terminating > pending ìƒíƒœë¥¼ ê±°ì³ worker1ì— ìƒì„±ë¨

```
kubectl get nodes -w
```

- ğŸ˜— worker2ë¥¼ ì‹œì‘ ì‹œì¼œë³´ì
- worker2ê°€ readyë¡œ ë³€ê²½

```
kubectl get pod -o wide
```

- ì¥ì• ê°€ ë‚¬ì„ë•Œ ë§Œë“¤ì–´ì¡Œë˜ íŒŒë“œë“¤ì€ ì‚­ì œë¨
- ì¿ ë²„ë„¤í‹°ìŠ¤ ìì²´ ë¦¬ì†ŒìŠ¤ê°€ ì¶©ë¶„í•˜ê¸°ì— worker1ì—ë§Œ ë°°ì¹˜ë¨
  - ë¦¬ì†ŒìŠ¤ê°€ ë¶€ì¡±í•˜ë©´ ë¶„ì‚°ë°°ì¹˜í•¨

<br>

ğŸ“ **ë ˆí”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì •**

```
kubectl scale rc [name] --replicas=[num]
kubectl edit rc [name]
```

- ì§ì ‘ ìˆ˜ì •

```
cp [old_yaml] [new_yaml]
kubectl apply -f [new_yaml]
```

- yaml íŒŒì¼ ì‹ ê·œ ìƒì„± ë° ìˆ˜ì • í›„ configure

<br>

ğŸ“ **ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì‚­ì œ**

```
kubectl delete rc [name]
```

<br>

## 5. ReplicaSet

### 5.1 ì†ì„±

- ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ê±°ì˜ ë™ì¼í•˜ê²Œ ë™ì‘
- ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë ˆì´ë¸”ì„ ìœ ì—°í•˜ê²Œ ì„ íƒí•˜ê¸° ì–´ë ¤ìš´ ë‹¨ì ì´ ìˆìŒ
- ë ˆí”Œë¦¬ì¹´ì…‹ì€ ì´ë¥¼ ê·¹ë³µ

<br>

ğŸ“**Replication Controller vs ReplicaSet**

- Replication ControllerëŠ” templateì— Pod selectorë¥¼ ì§€ì •í•˜ì—¬ íŠ¹ì • labelì— ì†í•œ Podë§Œ ê´€ë¦¬
- Replica Setì€ íŠ¹ì • labelì„ ì¡°ê±´ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë‹¤ì–‘í•œ êµ°ì§‘ìœ¼ë¡œ Podë“¤ì„ ê´€ë¦¬

```yaml
# replicaset.yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: replicaset-2
spec:
  replicas: 2
  selector:
    matchExpressions:
      - key: app
        operator: In
        values: 
          - blue
          - yellow
  template:
    metadata:
      labels:
        app: yellow
    spec:
      containers:
      - name: nginx
        image: nginx
```

- Replica Set ì˜ˆì‹œ
- matchExpressionì„ í†µí•´ ë‹¤ì–‘í•œ í‘œí˜„ ìƒì„±

<br>

### 5.2 Replica Set ìƒì„± ë° ëª…ë ¹ì–´

```
kubectl create -f replicaset.yaml
kubectl get rs
kubectl describe rs [name]
kubectl delete rs [name]
```

<br>

## 6. Deployment

### 6.1 ì†ì„±

- ë°°í¬ë¥¼ ìœ„í•œ ë¦¬ì†ŒìŠ¤
- ë ˆí”Œë¦¬ì¹´ì…‹ì„ ë‹¤ë£° ìˆ˜ ìˆëŠ” ê°ì²´
  - ë‹¤ìˆ˜ì˜ ë ˆí”Œë¦¬ì¹´ ì…‹ì„ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆìŒ
- ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ì—…ë°ì´íŠ¸ë¥¼ ì¢€ ë” ì›í™œí•˜ê²Œ ë„ì™€ì¤Œ

<br>

ğŸ“ **vs Replica Set**

- Podë¥¼ ë°°í¬í•¨ì— ìˆì–´ Replica Setì€ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì œê³µí•˜ì§€ ì•ŠìŒ

<br>

### 6.2 Pod ì—…ë°ì´íŠ¸ ë°©ë²•

- recreate: ì ê¹ì˜ ë‹¤ìš´ íƒ€ì„ ë°œìƒ, í¬ë“œê°€ ì‚­ì œë˜ê³  ì˜¬ë¼ì˜´
- rolling update: í¬ë“œ ì—¬ëŸ¬ê°œ ì¤‘ì— ë‚®ì€ ë²„ì „ì„ ì‚­ì œí•˜ê³  ë†’ì€ ë²„ì „ì„ í•˜ë‚˜ì”© êµì²´í•˜ë©° ì˜¬ë¦¼

<br>

ğŸ“ **Rolling Update**

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/pod/pod3.png?raw=true" width="600" height="300"></p>

- ì¥ì : ë¬´ì¤‘ë‹¨ ë°°í¬ê°€ ê°€ëŠ¥
- ë‹¨ì : V1ê³¼ V2ì˜ Podê°€ ê³µì¡´í•˜ëŠ” ìˆœê°„ì´ ìˆìŒ

<br>

ğŸ“ **Recreate**

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/pod/pod4.png?raw=true" width="600" height="300"></p>

- ë‹¨ì : Podê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìˆœê°„ì´ ì¡´ì¬í•¨

<br>

ğŸ“ **Blue/Green**

<p align="center"><img src="https://github.com/sigirace/page-images/blob/main/k8s/pod/pod5.png?raw=true" width="600" height="300"></p>

- ì¥ì : V1, V2ê°€ ê³µì¡´í•˜ëŠ” ìˆœê°„ì´ ì—†ìŒ
- ë‹¨ì : ìì›ì„ 2ë°°ë¡œ ì‚¬ìš©

<br>

ğŸ“ **Rolling ì—…ë°ì´íŠ¸ ì „ëµ ì„¸ë¶€ ì„¤ì •**

- maxSurge
  - ìµœëŒ€ ëª‡ê°œê¹Œì§€ì˜ podë¥¼ ë°°í¬í•  ìˆ˜ ìˆê²Œ í•  ê²ƒì´ëƒ
  - ê¸°ë³¸ê°’ì€ 25% ex) 10ê°œ ìƒì„±ì‹œ 2~3 ë” ë§Œë“¤ì–´ì§
- maxUnavailable
  - ìµœì†Œ ëª‡ê°œì˜ podë¥¼ ìœ ì§€í•  ê²ƒì¸ê°€
  - ê¸°ë³¸ê°’ì€ 25% ex) 10ê°œ ìƒì„±ì‹œ 7~8ê°œëŠ” ìœ ì§€ë¨

- ê°’ì´ í´ ìˆ˜ë¡ ë¹ ë¥´ê²Œ ë°°í¬ë  ìˆ˜ ìˆìœ¼ë‚˜ ìì› ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŒ

<br>

### 6.3 Deployment Scaling

```
kubectl edit deploy [name]
kubectl scale deploy [name] --replicas=[num]
```

<br>

### 6.4 Deployment ì‹¤ìŠµ

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy-jenkins
  labels:
    app: jenkins-test
spec:
  replicas: 3
  selector:
    matchLabels:
      app: jenkins-test
  template:
    metadata:
      labels:
        app: jenkins-test
    spec:
      containers:
      - name: jenkins
        image: jenkins/jenkins
        ports:
        - containerPort: 8080
```

```
kubectl create -f http-go-deployment.yaml --record=true
```

- recordë¥¼ í†µí•´ historyì— ëª…ë ¹ì–´ë¥¼ ê¸°ë¡

```
kubectl get all
```

- deployment > replicates > pod ìˆœìœ¼ë¡œ ëœë¤ ìŠ¤íŠ¸ë§ì´ ë’¤ì— ë¶™ìŒì„ ì•Œ ìˆ˜ ìˆìŒ

```
kubectl rollout history deployment [name]
```

- historyê°€ ìµœëŒ€ 10ê°œê¹Œì§€ ì €ì¥ â˜ ë ˆí”Œë¦¬ì¹´ì…‹ì´ 10ê°œê¹Œì§€ ê°€ëŠ¥

```
kubectl get all
```

- deployment > replicates > pod ìˆœìœ¼ë¡œ ëœë¤ ìŠ¤íŠ¸ë§ì´ ë’¤ì— ë¶™ìŒì„ ì•Œ ìˆ˜ ìˆìŒ

```
kubectl delete pod [pod_name]
kubectl describe rs [replicaset_name]
```

- ì‚­ì œ, ìƒì„±ì— ëŒ€í•œ ë‚´ìš© í™•ì¸

<br>

ğŸ“ **ë°°í¬ ê´€ë ¨ ëª…ë ¹ì–´**

```
kubectl patch deployment [name] -p '{"spec": {"mainReadySeconds": [sec]}}'
```

- ì—…ë°ì´íŠ¸ ì†ë„ ì¡°ì ˆ

```
kubectl rollout pause deployment [name]
```

- ì—…ë°ì´íŠ¸ ì¤‘ì— ì¼ì‹œì •ì§€

```
kubectl rollout undo deployment [name]
```

- ì—…ë°ì´íŠ¸ ì¼ì‹œì¤‘ì§€ ì¤‘ ì·¨ì†Œ

```
kubectl rollout resume deployment [name]
```

- ì—…ë°ì´íŠ¸ ì¬ì‹œì‘

<br>

### 6.5 Rolling update ì‹¤ìŠµ

```yaml
# http-go-deploy-v1.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: http-go
  labels:
    app: http-go
spec:
  replicas: 3
  selector:
    matchLabels:
      app: http-go
  template:
    metadata:
      labels:
        app: http-go
    spec:
      containers:
      - name: http-go
        image: gasbugs/http-go:v1
        ports:
        - containerPort: 8080
```

```
kubectl create -f http-go-deploy-v1.yaml --record=true
```

- ë°°í¬

```
kubectl rollout status deploy http-go
```

- ìƒíƒœ í™•ì¸

```
kubectl rollout history deploy http-go
```

- history í™•ì¸

```
kubectl patch deploy http-go -p '{"spec":{"minReadySeconds":10}}'
```

- 10ì´ˆ ê°„ê²©ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ìˆ˜í–‰
- ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ëª…ë ¹ì–´

```
kubectl expose deploy http-go
```

- ë¡œë“œë°¸ëŸ°ì‹±ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ìƒì„±

```
kubectl get svc
```

- ì„œë¹„ìŠ¤ ip í™•ì¸

```
kubectl run -it --rm --image busybox -- bash
```

- busyboxë¼ëŠ” ì´ë¯¸ì§€ë¡œ bashë¥¼ ì‹¤í–‰ì‹œí‚´ like docker

```
while true; do wget -O- -q 10.106.1.87:8080; sleep 1; done
```

- ì‰˜ ëª…ë ¹ì–´
- ì‹ ê·œ í„°ë¯¸ë„ ìƒì„±

```
kubectl set image deploy [deployment_name] [container_name]=[new_image] --record=true
```

- ì—…ë°ì´íŠ¸ ìˆ˜í–‰

```
kubectl rollout history deploy [deployment_name]
```

- history í™•ì¸ ê°€ëŠ¥
- replicasetì˜ ë‚´ìš©ì´ ë°”ë€Œì§€ ì•Šìœ¼ë©´ ë®ì–´ì”Œì›Œì§

```
kubectl rollout undo deploy http-go
```

- ì´ì „ ë²„ì „ìœ¼ë¡œ rollback

```
kubectl rollout undo deploy http-go --to-revision=1
```

- íŠ¹ì • revisionìœ¼ë¡œ ë³€ê²½

<br>

## 7. Namespaces

### 7.1 ì†ì„±

- í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ ê¶Œí•œì„ ë‚˜ëˆ„ì–´ ìì‹ ë§Œì˜ ê³µê°„ì— ì›í•˜ëŠ” í¬ë“œë‚˜ ìì›ë“¤ì„ ë°°ì¹˜í•˜ê³  í†µì‹ ì„ í•  ìˆ˜ ìˆê²Œí•¨
- ìì›ì„ í•œì •ë˜ê²Œ í•˜ì—¬ ì•ˆì •ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê²Œ ë§Œë“¤ì–´ì¤Œ

- ë¦¬ì†ŒìŠ¤ë¥¼ ê°ê°ì˜ ë¶„ë¦¬ëœ ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ê¸°ì¢‹ì€ ë°©ë²•
- ì—¬ëŸ¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œìŠ¤í…œì„ ë” ì‘ì€ ê·¸ë£¹ìœ¼ë¡œ ë¶„í• 
- ë©€í‹° í…Œë„ŒíŠ¸ í™˜ê²½ì„ ë¶„ë¦¬í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì‚°, ê°œë°œ, QA í™˜ê²½ ë“±ìœ¼ë¡œ ì‚¬ìš©
- ë¦¬ì†ŒìŠ¤ ì´ë¦„ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œë§Œ ê³ ìœ  ëª…ì¹­ ì‚¬ìš©
  - ì•„ì´ë””ëŠ” ê²Œì„ ì„œë²„ ë‚´ì—ì„œë§Œ ìœ ì¼í•œ ê°œë…

<br>

### 7.2 Namespace í™•ì¸ ì‹¤ìŠµ

```
kubectl get ns
```

- í˜„ì¬ í´ëŸ¬ìŠ¤í„°ì˜ ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸
- ê¸°ì¡´ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì€ default
- kubectl getì‹œì— ì˜µì…˜ ì—†ì´ ì‚¬ìš©í•˜ë©´ default ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì§ˆì˜

```
kubectl get po --namespace [namespace_name]
```

- íŠ¹ì • namespaceì— ì§ˆì˜

```
kubectl get [resource] --all-namespaces
```

- ì „ì²´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ëŒ€ìƒìœ¼ë¡œ ì§ˆì˜

<br>

### 7.3 Namespace ìƒì„± ì‹¤ìŠµ

```
kubectl create ns [ns_name]
```

- namespae ìƒì„± ë°©ì‹ 1

```
kubectl create ns [ns_name] --dry-run=client -o yaml > [ns_name.yaml]
```

- namespae ìƒì„± ë°©ì‹ 2
- --dry-run: ë¬¸ë²• ê²€ì‚¬
- -o yaml: yaml íŒŒì¼ ìƒì„±
- yaml íŒŒì¼ë¡œ ì €ì¥

```
kubectl create -f [ns_name.yaml]
kubectl get ns
```

- ìƒì„± ë° í™•ì¸

```
kubectl create deploy nginx --image nginx --port 80 -n [ns_name]
```

- nginx ë°°í¬

```
kubectl get pod -n office
```

- ì¡°íšŒ

```
kubectl delete ns [ns_name]
```

- ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‚­ì œí•œ ëª¨ë“  ê²ƒë“¤ì´ ì‚­ì œë¨

<br>

ğŸ“ **default ìˆ˜ì •**

```
vim ~/.kube/config
```

- kubernetes config file

```
# ìˆ˜ì •ì „
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
    
# ìˆ˜ì •í›„
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
    namespace: [ns_name]
```









